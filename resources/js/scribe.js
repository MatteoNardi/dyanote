/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * Lo-Dash 2.4.1 (Custom Build) <http://lodash.com/>
 * Build: `lodash modularize modern exports="amd" -o ./modern/`
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <http://lodash.com/license>
 */

/**
 *  Copyright (c) 2014, Facebook, Inc.
 *  All rights reserved.
 *
 *  This source code is licensed under the BSD-style license found in the
 *  LICENSE file in the root directory of this source tree. An additional grant
 *  of patent rights can be found in the PATENTS file in the same directory.
 */

function universalModule(){function t(t,n,r,i){var s;if(i){var o=i.prototype;s=e.create(o)}else s=t.prototype;return e.keys(n).forEach(function(e){s[e]=n[e]}),e.keys(r).forEach(function(e){t[e]=r[e]}),s.constructor=t,t.prototype=s,t}function n(t,n,r,i){return e.getPrototypeOf(n)[r].apply(t,i)}function r(e,t,r){n(e,t,"constructor",r)}function s(e,t){return e===t?e!==0||t!==0||1/e===1/t:e!==e?t!==t:e&&typeof e.equals=="function"?e.equals(t):!1}function o(e,t){if(!e)throw new Error(t)}function d(e){return e.value=!1,e}function v(e){e&&(e.value=!0)}function m(){}function g(e,t){t=t||0;var n=Math.max(0,e.length-t),r=new Array(n);for(var i=0;i<n;i++)r[i]=e[i+t];return r}function y(e){o(e!==Infinity,"Cannot perform this action with an infinite size.")}function b(e){return e.size===undefined&&(e.size=e.__iterate(E)),e.size}function w(e,t){return t>=0?+t:b(e)+ +t}function E(){return!0}function S(e,t,n){return(e===0||n!==undefined&&e<=-n)&&(t===undefined||n!==undefined&&t>=n)}function x(e,t){return N(e,t,0)}function T(e,t){return N(e,t,t)}function N(e,t,n){return e===undefined?n:e<0?Math.max(0,t+e):t===undefined?e:Math.min(t,e)}function C(e){if(!e)return 0;if(e===!0)return 1;var t=typeof e;if(t==="number"){if((e|0)===e)return e&D;e=""+e,t="string"}return t==="string"?e.length>B?k(e):L(e):e.hashCode?C(typeof e.hashCode=="function"?e.hashCode():e.hashCode):A(e)}function k(e){var t=I[e];return t===undefined&&(t=L(e),F===j&&(F=0,I={}),F++,I[e]=t),t}function L(e){var t=0;for(var n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)&D;return t}function A(e){var t=_&&_.get(e);if(t)return t;t=e[H];if(t)return t;if(!O){t=e.propertyIsEnumerable&&e.propertyIsEnumerable[H];if(t)return t;t=M(e);if(t)return t}if(Object.isExtensible&&!Object.isExtensible(e))throw new Error("Non-extensible objects are not allowed as keys.");t=++P&D;if(_)_.set(e,t);else if(O)Object.defineProperty(e,H,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[H]=t;else{if(!e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[H]=t}return t}function M(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function J(e,t,n,r){var i=e===0?t:e===1?n:[t,n];return r?r.value=i:r={value:i,done:!1},r}function K(){return{value:undefined,done:!0}}function Q(e){return!!Z(e)}function G(e){return e&&typeof e.next=="function"}function Y(e){var t=Z(e);return t&&t.call(e)}function Z(e){var t=e&&(W&&e[W]||e[z]);if(typeof t=="function")return t}function ct(e){return!!e&&!!e[nt]}function ht(e){return!!e&&!!e[rt]}function pt(e){return!!e&&!!e[it]}function dt(e){return ht(e)||pt(e)}function vt(e){return!!e&&!!e[st]}function mt(e,t){return t}function gt(e,t){return[t,e]}function yt(e){return function(){return!e.apply(this,arguments)}}function bt(e){return function(){return-e.apply(this,arguments)}}function wt(e){return typeof e=="string"?JSON.stringify(e):e}function Et(e,t){return e>t?-1:e<t?1:0}function St(e,t){var n=!dt(e)&&!dt(t);if(vt(e)){if(!vt(t))return!1;var r=e.entries();return t.every(function(e,t){var i=r.next().value;return i&&s(i[1],e)&&(n||s(i[0],t))})&&r.next().done}var i=!1;if(e.size===undefined)if(t.size===undefined)e.cacheResult();else{i=!0;var o=e;e=t,t=o}var u=!0,a=t.__iterate(function(t,r){if(n?!e.has(t):i?!s(t,e.get(r,c)):!s(e.get(r,c),t))return u=!1,!1});return u&&e.size===a}function xt(e,t){var n=e.prototype,r=function(e){n[e]=t[e]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}function jt(e){return!!e&&!!e[_t]}function It(){return Ft||(Ft=new Dt([]))}function qt(e){var t=Array.isArray(e)?(new Dt(e)).fromEntrySeq():G(e)?(new Bt(e)).fromEntrySeq():Q(e)?(new Ht(e)).fromEntrySeq():typeof e=="object"?new Pt(e):undefined;if(!t)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+e);return t}function Rt(e){var t=zt(e);if(!t)throw new TypeError("Expected Array or iterable object of values: "+e);return t}function Ut(e){var t=zt(e)||typeof e=="object"&&new Pt(e);if(!t)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+e);return t}function zt(e){return Wt(e)?new Dt(e):G(e)?new Bt(e):Q(e)?new Ht(e):undefined}function Wt(e){return e&&typeof e.length=="number"}function Xt(e,t,n,r){y(e.size);var i=e._cache;if(i){var s=i.length-1;for(var o=0;o<=s;o++){var u=i[n?s-o:o];if(t(u[1],r?u[0]:o,e)===!1)return o+1}return o}return e.__iterateUncached(t,n)}function Vt(e,t,n,r){var i=e._cache;if(i){var s=i.length-1,o=0;return new V(function(){var e=i[n?s-o:o];return o++>s?K():J(t,r?e[0]:o-1,e[1])})}return e.__iteratorUncached(t,n)}function $t(e,t){return t?Jt(t,e,"",{"":e}):Kt(e)}function Jt(e,t,n,r){return Array.isArray(t)?e.call(r,n,Lt(t).map(function(n,r){return Jt(e,n,r,t)})):Qt(t)?e.call(r,n,Ct(t).map(function(n,r){return Jt(e,n,r,t)})):t}function Kt(e){return Array.isArray(e)?Lt(e).map(Kt).toList():Qt(e)?Ct(e).map(Kt).toMap():e}function Qt(e){return e&&e.constructor===Object}function on(e){return!!e&&!!e[un]}function wn(e,t){return J(e,t[0],t[1])}function En(e,t){return{node:e,index:0,__prev:t}}function Sn(e,t,n,r){var i=Object.create(an);return i.size=e,i._root=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function Tn(){return xn||(xn=Sn(0))}function Nn(e,t,n){var r,i;if(!e._root){if(n===c)return e;i=1,r=new fn(e.__ownerID,[[t,n]])}else{var s=d(h),o=d(p);r=Cn(e._root,e.__ownerID,0,undefined,t,n,s,o);if(!o.value)return e;i=e.size+(s.value?n===c?-1:1:0)}return e.__ownerID?(e.size=i,e._root=r,e.__hash=undefined,e.__altered=!0,e):r?Sn(i,r):Tn()}function Cn(e,t,n,r,i,s,o,u){return e?e.update(t,n,r,i,s,o,u):s===c?e:(v(u),v(o),new gn(t,r,[i,s]))}function kn(e){return e.constructor===gn||e.constructor===vn}function Ln(e,t,n,r,i){if(e.keyHash===r)return new vn(t,r,[e.entry,i]);var s=(n===0?e.keyHash:e.keyHash>>>n)&l,o=(n===0?r:r>>>n)&l,u,f=s===o?[Ln(e,t,n+a,r,i)]:(u=new gn(t,r,i),s<o?[e,u]:[u,e]);return new cn(t,1<<s|1<<o,f)}function An(e,t,n,r){e||(e=new m);var i=new gn(e,C(n),[n,r]);for(var s=0;s<t.length;s++){var o=t[s];i=i.update(e,0,undefined,o[0],o[1])}return i}function On(e,t,n,r){var i=0,s=0,o=new Array(n);for(var u=0,a=1,f=t.length;u<f;u++,a<<=1){var l=t[u];l!==undefined&&u!==r&&(i|=a,o[s++]=l)}return new cn(e,i,o)}function Mn(e,t,n,r,i){var s=0,o=new Array(f);for(var u=0;n!==0;u++,n>>>=1)o[u]=n&1?t[s++]:undefined;return o[r]=i,new pn(e,s+1,o)}function _n(e,t,n){var r=[];for(var i=0;i<n.length;i++){var s=n[i],o=ut(s);ct(s)||(o=o.map(function(e){return $t(e)})),r.push(o)}return Pn(e,t,r)}function Dn(e){return function(t,n){return t&&t.mergeDeepWith&&ct(n)?t.mergeDeepWith(e,n):e?e(t,n):n}}function Pn(e,t,n){return n.length===0?e:e.withMutations(function(e){var r=t?function(n,r){e.update(r,c,function(e){return e===c?n:t(e,n)})}:function(t,n){e.set(n,t)};for(var i=0;i<n.length;i++)n[i].forEach(r)})}function Hn(e,t,n,r,i){o(!e||e.set,"updateIn with invalid keyPath");var s=t[i],u=e?e.get(s,c):c,a=u===c?undefined:u,f=i===t.length-1?r(u===c?n:u):Hn(a,t,n,r,i+1);return f===a?e:f===c?e&&e.remove(s):(e||Tn()).set(s,f)}function Bn(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function jn(e,t,n,r){var i=r?e:g(e);return i[t]=n,i}function Fn(e,t,n,r){var i=e.length+1;if(r&&t+1===i)return e[t]=n,e;var s=new Array(i),o=0;for(var u=0;u<i;u++)u===t?(s[u]=n,o=-1):s[u]=e[u+o];return s}function In(e,t,n){var r=e.length-1;if(n&&t===r)return e.pop(),e;var i=new Array(r),s=0;for(var o=0;o<r;o++)o===t&&(s=1),i[o]=e[o+s];return i}function $n(e){var t=pr(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.contains(t)},t.contains=function(t){return e.has(t)},t.cacheResult=dr,t.__iterateUncached=function(t,n){var r=this;return e.__iterate(function(e,n){return t(n,e,r)!==!1},n)},t.__iteratorUncached=function(t,n){if(t===U){var r=e.__iterator(t,n);return new V(function(){var e=r.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e})}return e.__iterator(t===R?q:R,n)},t}function Jn(e,t,n){var r=pr(e);return r.size=e.size,r.has=function(t){return e.has(t)},r.get=function(r,i){var s=e.get(r,c);return s===c?i:t.call(n,s,r,e)},r.__iterateUncached=function(r,i){var s=this;return e.__iterate(function(e,i,o){return r(t.call(n,e,i,o),i,s)!==!1},i)},r.__iteratorUncached=function(r,i){var s=e.__iterator(U,i);return new V(function(){var i=s.next();if(i.done)return i;var o=i.value,u=o[0];return J(r,u,t.call(n,o[1],u,e),i)})},r}function Kn(e,t){var n=pr(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var t=$n(e);return t.reverse=function(){return e.flip()},t}),n.get=function(n,r){return e.get(t?n:-1-n,r)},n.has=function(n){return e.has(t?n:-1-n)},n.contains=function(t){return e.contains(t)},n.cacheResult=dr,n.__iterate=function(t,n){var r=this;return e.__iterate(function(e,n){return t(e,n,r)},!n)},n.__iterator=function(t,n){return e.__iterator(t,!n)},n}function Qn(e,t,n,r){var i=pr(e);return r&&(i.has=function(r){var i=e.get(r,c);return i!==c&&!!t.call(n,i,r,e)},i.get=function(r,i){var s=e.get(r,c);return s!==c&&t.call(n,s,r,e)?s:i}),i.__iterateUncached=function(i,s){var o=this,u=0;return e.__iterate(function(e,s,a){if(t.call(n,e,s,a))return u++,i(e,r?s:u-1,o)},s),u},i.__iteratorUncached=function(i,s){var o=e.__iterator(U,s),u=0;return new V(function(){for(;;){var s=o.next();if(s.done)return s;var a=s.value,f=a[0],l=a[1];if(t.call(n,l,f,e))return J(i,r?f:u++,l,s)}})},i}function Gn(e,t,n){var r=sn().asMutable();return e.__iterate(function(i,s){r.update(t.call(n,i,s,e),0,function(e){return e+1})}),r.asImmutable()}function Yn(e,t,n){var r=ht(e),i=sn().asMutable();e.__iterate(function(s,o){i.update(t.call(n,s,o,e),[],function(e){return e.push(r?[o,s]:s),e})});var s=hr(e);return i.map(function(t){return fr(e,s(t))})}function Zn(e,t){if(t>e.size)return e;t<0&&(t=0);var n=pr(e);return n.size=e.size&&Math.min(e.size,t),n.__iterateUncached=function(n,r){var i=this;if(t===0)return 0;if(r)return this.cacheResult().__iterate(n,r);var s=0;return e.__iterate(function(e,r){return++s&&n(e,r,i)!==!1&&s<t}),s},n.__iteratorUncached=function(n,r){if(r)return this.cacheResult().__iterator(n,r);var i=t&&e.__iterator(n,r),s=0;return new V(function(){return s++>t?K():i.next()})},n}function er(e,t,n){var r=pr(e);return r.__iterateUncached=function(r,i){var s=this;if(i)return this.cacheResult().__iterate(r,i);var o=0;return e.__iterate(function(e,i,u){return t.call(n,e,i,u)&&++o&&r(e,i,s)}),o},r.__iteratorUncached=function(r,i){var s=this;if(i)return this.cacheResult().__iterator(r,i);var o=e.__iterator(U,i),u=!0;return new V(function(){if(!u)return K();var e=o.next();if(e.done)return e;var i=e.value,a=i[0],f=i[1];return t.call(n,f,a,s)?r===U?e:J(r,a,f,e):(u=!1,K())})},r}function tr(e,t,n){if(t<=0)return e;var r=pr(e);return r.size=e.size&&Math.max(0,e.size-t),r.__iterateUncached=function(r,i){var s=this;if(i)return this.cacheResult().__iterate(r,i);var o=0,u=!0,a=0;return e.__iterate(function(e,i){if(!u||!(u=o++<t))return a++,r(e,n?i:a-1,s)}),a},r.__iteratorUncached=function(r,i){if(i)return this.cacheResult().__iterator(r,i);var s=t&&e.__iterator(r,i),o=0,u=0;return new V(function(){while(o<t)o++,s.next();var e=s.next();return n||r===R?e:r===q?J(r,u++,undefined,e):J(r,u++,e.value[1],e)})},r}function nr(e,t,n,r){var i=pr(e);return i.__iterateUncached=function(i,s){var o=this;if(s)return this.cacheResult().__iterate(i,s);var u=!0,a=0;return e.__iterate(function(e,s,f){if(!u||!(u=t.call(n,e,s,f)))return a++,i(e,r?s:a-1,o)}),a},i.__iteratorUncached=function(i,s){var o=this;if(s)return this.cacheResult().__iterator(i,s);var u=e.__iterator(U,s),a=!0,f=0;return new V(function(){var e,s,l;do{e=u.next();if(e.done)return r||i===R?e:i===q?J(i,f++,undefined,e):J(i,f++,e.value[1],e);var c=e.value;s=c[0],l=c[1],a&&(a=t.call(n,l,s,o))}while(a);return i===U?e:J(i,s,l,e)})},i}function rr(e,t){var n=ht(e),r=(new Dt([e].concat(t))).map(function(e){return ct(e)?n&&(e=ut(e)):e=n?qt(e):Rt(Array.isArray(e)?e:[e]),e});n?r=r.toKeyedSeq():pt(e)||(r=r.toSetSeq());var i=r.flatten(!0);return i.size=r.reduce(function(e,t){if(e!==undefined){var n=t.size;if(n!==undefined)return e+n}},0),i}function ir(e,t,n){var r=pr(e);return r.__iterateUncached=function(r,i){function u(e,a){var f=this;e.__iterate(function(e,i){return(!t||a<t)&&ct(e)?u(e,a+1):r(e,n?i:s++,f)===!1&&(o=!0),!o},i)}var s=0,o=!1;return u(e,0),s},r.__iteratorUncached=function(r,i){var s=e.__iterator(r,i),o=[],u=0;return new V(function(){while(s){var e=s.next();if(e.done!==!1){s=o.pop();continue}var a=e.value;r===U&&(a=a[1]);if(!(!t||o.length<t)||!ct(a))return n?e:J(r,u++,a,e);o.push(s),s=a.__iterator(r,i)}return K()})},r}function sr(e,t,n){var r=hr(e);return e.toSeq().map(function(i,s){return r(t.call(n,i,s,e))}).flatten(!0)}function or(e,t){var n=pr(e);return n.size=e.size&&e.size*2-1,n.__iterateUncached=function(n,r){var i=this,s=0;return e.__iterate(function(e,r){return(!s||n(t,s++,i)!==!1)&&n(e,s++,i)!==!1},r),s},n.__iteratorUncached=function(n,r){var i=e.__iterator(R,r),s=0,o;return new V(function(){if(!o||s%2){o=i.next();if(o.done)return o}return s%2?J(n,s++,t):J(n,s++,o.value,o)})},n}function ur(e,t,n){t||(t=vr);var r=ht(e),i=0,s=e.toSeq().map(function(t,r){return[r,t,i++,n?n(t,r,e):t]}).toArray();return s.sort(function(e,n){return t(e[3],n[3])||e[2]-n[2]}).forEach(r?function(e,t){s[t].length=2}:function(e,t){s[t]=e[1]}),r?Ct(s):pt(e)?Lt(s):Ot(s)}function ar(e,t,n){t||(t=vr);if(n){var r=e.toSeq().map(function(t,r){return[t,n(t,r,e)]}).reduce(function(e,n){return t(n[1],e[1])>0?n:e});return r&&r[0]}return e.reduce(function(e,n){return t(n,e)>0?n:e})}function fr(e,t){return jt(e)?t:e.constructor(t)}function lr(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function cr(e){return y(e.size),b(e)}function hr(e){return ht(e)?ut:pt(e)?ft:lt}function pr(e){return Object.create((ht(e)?Ct:pt(e)?Lt:Ot).prototype)}function dr(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):Tt.prototype.cacheResult.call(this)}function vr(e,t){return e>t?1:e<t?-1:0}function gr(e){return!!e&&!!e[yr]}function Sr(e,t,n,r,i,s){var o,u=e&&e.array;if(t===0){var c=n<0?-n:0,h=r-n;h>f&&(h=f);for(o=c;o<h;o++)if(i(u&&u[s?c+h-1-o:o])===!1)return!1}else{var p=1<<t,d=t-a;for(o=0;o<=l;o++){var v=s?l-o:o,m=n+(v<<t);if(m<r&&m+p>0){var g=u&&u[v];if(!Sr(g,d,m,r,i,s))return!1}}}return!0}function Tr(e,t,n,r,i){return{array:e,level:t,offset:n,max:r,rawMax:r-n>>t,index:0,__prev:i}}function Nr(e,t,n,r,i,s,o){var u=Object.create(br);return u.size=t-e,u._origin=e,u._capacity=t,u._level=n,u._root=r,u._tail=i,u.__ownerID=s,u.__hash=o,u.__altered=!1,u}function kr(){return Cr||(Cr=Nr(0,0,a))}function Lr(e,t,n){t=w(e,t);if(t>=e.size||t<0)return e.withMutations(function(e){t<0?_r(e,t).set(0,n):_r(e,0,t+1).set(t,n)});t+=e._origin;var r=e._tail,i=e._root,s=d(p);return t>=Pr(e._capacity)?r=Ar(r,e.__ownerID,0,t,n,s):i=Ar(i,e.__ownerID,e._level,t,n,s),s.value?e.__ownerID?(e._root=i,e._tail=r,e.__hash=undefined,e.__altered=!0,e):Nr(e._origin,e._capacity,e._level,i,r):e}function Ar(e,t,n,r,i,s){var o=r>>>n&l,u=e&&o<e.array.length;if(!u&&i===undefined)return e;var f;if(n>0){var c=e&&e.array[o],h=Ar(c,t,n-a,r,i,s);return h===c?e:(f=Or(e,t),f.array[o]=h,f)}return u&&e.array[o]===i?e:(v(s),f=Or(e,t),i===undefined&&o===f.array.length-1?f.array.pop():f.array[o]=i,f)}function Or(e,t){return t&&e&&t===e.ownerID?e:new wr(e?e.array.slice():[],t)}function Mr(e,t){if(t>=Pr(e._capacity))return e._tail;if(t<1<<e._level+a){var n=e._root,r=e._level;while(n&&r>0)n=n.array[t>>>r&l],r-=a;return n}}function _r(e,t,n){var r=e.__ownerID||new m,i=e._origin,s=e._capacity,o=i+t,u=n===undefined?s:n<0?s+n:i+n;if(o===i&&u===s)return e;if(o>=u)return e.clear();var f=e._level,c=e._root,h=0;while(o+h<0)c=new wr(c&&c.array.length?[undefined,c]:[],r),f+=a,h+=1<<f;h&&(o+=h,i+=h,u+=h,s+=h);var p=Pr(s),d=Pr(u);while(d>=1<<f+a)c=new wr(c&&c.array.length?[c]:[],r),f+=a;var v=e._tail,g=d<p?Mr(e,u-1):d>p?new wr([],r):v;if(v&&d>p&&o<s&&v.array.length){c=Or(c,r);var y=c;for(var b=f;b>a;b-=a){var w=p>>>b&l;y=y.array[w]=Or(y.array[w],r)}y.array[p>>>a&l]=v}u<s&&(g=g&&g.removeAfter(r,0,u));if(o>=d)o-=d,u-=d,f=a,c=null,g=g&&g.removeBefore(r,0,o);else if(o>i||d<p){h=0;while(c){var E=o>>>f&l;if(E!==d>>>f&l)break;E&&(h+=(1<<f)*E),f-=a,c=c.array[E]}c&&o>i&&(c=c.removeBefore(r,f,o-h)),c&&d<p&&(c=c.removeAfter(r,f,d-h)),h&&(o-=h,u-=h)}return e.__ownerID?(e.size=u-o,e._origin=o,e._capacity=u,e._level=f,e._root=c,e._tail=g,e.__hash=undefined,e.__altered=!0,e):Nr(o,u,f,c,g)}function Dr(e,t,n){var r=[],i=0;for(var s=0;s<n.length;s++){var o=n[s],u=ft(o);u.size>i&&(i=u.size),ct(o)||(u=u.map(function(e){return $t(e)})),r.push(u)}return i>e.size&&(e=e.setSize(i)),Pn(e,t,r)}function Pr(e){return e<f?0:e-1>>>a<<a}function Br(e){return on(e)&&vt(e)}function jr(e,t,n,r){var i=Object.create(Hr.prototype);return i.size=e?e.size:0,i._map=e,i._list=t,i.__ownerID=n,i.__hash=r,i}function Ir(){return Fr||(Fr=jr(Tn(),kr()))}function qr(e,t,n){var r=e._map,i=e._list,s=r.get(t),o=s!==undefined,u,a;if(n===c){if(!o)return e;i.size>=f&&i.size>=r.size*2?(a=i.filter(function(e,t){return e!==undefined&&s!==t}),u=a.toKeyedSeq().map(function(e){return e[0]}).flip().toMap(),e.__ownerID&&(u.__ownerID=a.__ownerID=e.__ownerID)):(u=r.remove(t),a=s===i.size-1?i.pop():i.set(s,undefined))}else if(o){if(n===i.get(s)[1])return e;u=r,a=i.set(s,[t,n])}else u=r.set(t,i.size),a=i.set(i.size,[t,n]);return e.__ownerID?(e.size=u.size,e._map=u,e._list=a,e.__hash=undefined,e):jr(u,a)}function zr(e){return!!e&&!!e[Wr]}function Vr(e,t,n,r){var i=Object.create(Xr);return i.size=e,i._head=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function Jr(){return $r||($r=Vr(0))}function Qr(e){return!!e&&!!e[Gr]}function Zr(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:t.size===0?e.__empty():e.__make(t)}function ei(e,t){var n=Object.create(Yr);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function ni(){return ti||(ti=ei(Tn()))}function ii(e){return Qr(e)&&vt(e)}function oi(e,t){var n=Object.create(si);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function ai(){return ui||(ui=oi(Ir()))}function ci(e,t,n){var r=Object.create(Object.getPrototypeOf(e));return r._map=t,r.__ownerID=n,r}function hi(e){return e._name||e.constructor.name}var e=Object,i={};i.createClass=t,i.superCall=n,i.defaultSuperCall=r;var u="delete",a=5,f=1<<a,l=f-1,c={},h={value:!1},p={value:!1},O=function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}(),_=typeof WeakMap=="function"&&new WeakMap,D=2147483647,P=0,H="__immutablehash__";typeof Symbol=="function"&&(H=Symbol(H));var B=16,j=255,F=0,I={},q=0,R=1,U=2,z="@@iterator",W=typeof Symbol=="function"&&Symbol.iterator,X=W||z,V=function(t){this.next=t};i.createClass(V,{toString:function(){return"[Iterator]"}},{}),V.KEYS=q,V.VALUES=R,V.ENTRIES=U;var $=V.prototype;$.inspect=$.toSource=function(){return this.toString()},$[X]=function(){return this};var et=function(t){return ct(t)?t:Tt(t)},tt=et;i.createClass(et,{toArray:function(){y(this.size);var e=new Array(this.size||0);return this.valueSeq().__iterate(function(t,n){e[n]=t}),e},toIndexedSeq:function(){return new Wn(this)},toJS:function(){return this.toSeq().map(function(e){return e&&typeof e.toJS=="function"?e.toJS():e}).__toJS()},toKeyedSeq:function(){return new zn(this,!0)},toMap:function(){return y(this.size),sn(this.toKeyedSeq())},toObject:function(){y(this.size);var e={};return this.__iterate(function(t,n){e[n]=t}),e},toOrderedMap:function(){return y(this.size),Hr(this.toKeyedSeq())},toOrderedSet:function(){return y(this.size),ri(ht(this)?this.valueSeq():this)},toSet:function(){return y(this.size),Kr(ht(this)?this.valueSeq():this)},toSetSeq:function(){return new Xn(this)},toSeq:function(){return pt(this)?this.toIndexedSeq():ht(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return y(this.size),Rr(ht(this)?this.valueSeq():this)},toList:function(){return y(this.size),mr(ht(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(e,t){return this.size===0?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return fr(this,rr(this,e))},contains:function(e){return this.some(function(t){return s(t,e)})},entries:function(){return this.__iterator(U)},every:function(e,t){var n=!0;return this.__iterate(function(r,i,s){if(!e.call(t,r,i,s))return n=!1,!1}),n},filter:function(e,t){return fr(this,Qn(this,e,t,!0))},find:function(e,t,n){var r=n;return this.__iterate(function(n,i,s){if(e.call(t,n,i,s))return r=n,!1}),r},forEach:function(e,t){return this.__iterate(t?e.bind(t):e)},join:function(e){e=e!==undefined?""+e:",";var t="",n=!0;return this.__iterate(function(r){n?n=!1:t+=e,t+=r!==null&&r!==undefined?r:""}),t},keys:function(){return this.__iterator(q)},map:function(e,t){return fr(this,Jn(this,e,t))},reduce:function(e,t,n){var r,i;return arguments.length<2?i=!0:r=t,this.__iterate(function(t,s,o){i?(i=!1,r=t):r=e.call(n,r,t,s,o)}),r},reduceRight:function(e,t,n){var r=this.toKeyedSeq().reverse();return r.reduce.apply(r,arguments)},reverse:function(){return fr(this,Kn(this,!0))},slice:function(e,t){if(S(e,t,this.size))return this;var n=x(e,this.size),r=T(t,this.size);if(n!==n||r!==r)return this.toSeq().cacheResult().slice(e,t);var i=n===0?this:this.skip(n);return fr(this,r===undefined||r===this.size?i:i.take(r-n))},some:function(e,t){return!this.every(yt(e),t)},sort:function(e){return fr(this,ur(this,e))},values:function(){return this.__iterator(R)},butLast:function(){return this.slice(0,-1)},count:function(e,t){return b(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return Gn(this,e,t)},equals:function(e){if(this===e)return!0;if(!e||typeof e.equals!="function")return!1;if(this.size!==undefined&&e.size!==undefined){if(this.size!==e.size)return!1;if(this.size===0&&e.size===0)return!0}return this.__hash!==undefined&&e.__hash!==undefined&&this.__hash!==e.__hash?!1:this.__deepEquals(e)},__deepEquals:function(e){return St(this,e)},entrySeq:function(){var e=this;if(e._cache)return new Dt(e._cache);var t=e.toSeq().map(gt).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(yt(e),t)},findLast:function(e,t,n){return this.toKeyedSeq().reverse().find(e,t,n)},first:function(){return this.find(E)},flatMap:function(e,t){return fr(this,sr(this,e,t))},flatten:function(e){return fr(this,ir(this,e,!0))},fromEntrySeq:function(){return new Vn(this)},get:function(e,t){return this.find(function(t,n){return s(n,e)},undefined,t)},getIn:function(e,t){var n=this;if(e)for(var r=0;r<e.length;r++){n=n&&n.get?n.get(e[r],c):c;if(n===c)return t}return n},groupBy:function(e,t){return Yn(this,e,t)},has:function(e){return this.get(e,c)!==c},isSubset:function(e){return e=typeof e.contains=="function"?e:tt(e),this.every(function(t){return e.contains(t)})},isSuperset:function(e){return e.isSubset(this)},keySeq:function(){return this.toSeq().map(mt).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},max:function(e){return ar(this,e)},maxBy:function(e,t){return ar(this,t,e)},min:function(e){return ar(this,e?bt(e):Et)},minBy:function(e,t){return ar(this,t?bt(t):Et,e)},rest:function(){return this.slice(1)},skip:function(e){return fr(this,tr(this,e,!0))},skipLast:function(e){return fr(this,this.toSeq().reverse().skip(e).reverse())},skipWhile:function(e,t){return fr(this,nr(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(yt(e),t)},sortBy:function(e,t){return fr(this,ur(this,t,e))},take:function(e){return fr(this,Zn(this,e))},takeLast:function(e){return fr(this,this.toSeq().reverse().take(e).reverse())},takeWhile:function(e,t){return fr(this,er(this,e,t))},takeUntil:function(e,t){return this.takeWhile(yt(e),t)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=this.size===Infinity?0:this.reduce(function(e,t,n){return e+(C(t)^(t===n?0:C(n)))&D},0))}},{});var nt="@@__IMMUTABLE_ITERABLE__@@",rt="@@__IMMUTABLE_KEYED__@@",it="@@__IMMUTABLE_INDEXED__@@",st="@@__IMMUTABLE_ORDERED__@@",ot=et.prototype;ot[nt]=!0,ot[X]=ot.values,ot.toJSON=ot.toJS,ot.__toJS=ot.toArray,ot.__toStringMapper=wt,ot.inspect=ot.toSource=function(){return this.toString()},ot.chain=ot.flatMap,function(){try{Object.defineProperty(ot,"length",{get:function(){if(!et.noLengthWarning){var e;try{throw new Error}catch(t){e=t.stack}if(e.indexOf("_wrapObject")===-1)return console&&console.warn&&console.warn("iterable.length has been deprecated, use iterable.size or iterable.count(). This warning will become a silent error in a future version. "+e),this.size}}})}catch(e){}}();var ut=function(t){return ht(t)?t:Ct(t)};i.createClass(ut,{flip:function(){return fr(this,$n(this))},findKey:function(e,t){var n;return this.__iterate(function(r,i,s){if(e.call(t,r,i,s))return n=i,!1}),n},findLastKey:function(e,t){return this.toSeq().reverse().findKey(e,t)},keyOf:function(e){return this.findKey(function(t){return s(t,e)})},lastKeyOf:function(e){return this.toSeq().reverse().keyOf(e)},mapEntries:function(e,t){var n=this,r=0;return fr(this,this.toSeq().map(function(i,s){return e.call(t,[s,i],r++,n)}).fromEntrySeq())},mapKeys:function(e,t){var n=this;return fr(this,this.toSeq().flip().map(function(r,i){return e.call(t,r,i,n)}).flip())}},{},et);var at=ut.prototype;at[rt]=!0,at[X]=ot.entries,at.__toJS=ot.toObject,at.__toStringMapper=function(e,t){return t+": "+wt(e)};var ft=function(t){return pt(t)?t:Lt(t)};i.createClass(ft,{toKeyedSeq:function(){return new zn(this,!1)},filter:function(e,t){return fr(this,Qn(this,e,t,!1))},findIndex:function(e,t){var n=this.toKeyedSeq().findKey(e,t);return n===undefined?-1:n},indexOf:function(e){var t=this.toKeyedSeq().keyOf(e);return t===undefined?-1:t},lastIndexOf:function(e){var t=this.toKeyedSeq().lastKeyOf(e);return t===undefined?-1:t},reverse:function(){return fr(this,Kn(this,!1))},splice:function(e,t){var n=arguments.length;t=Math.max(t|0,0);if(n===0||n===2&&!t)return this;e=x(e,this.size);var r=this.slice(0,e);return fr(this,n===1?r:r.concat(g(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var n=this.toKeyedSeq().findLastKey(e,t);return n===undefined?-1:n},first:function(){return this.get(0)},flatten:function(e){return fr(this,ir(this,e,!1))},get:function(e,t){return e=w(this,e),e<0||this.size===Infinity||this.size!==undefined&&e>this.size?t:this.find(function(t,n){return n===e},undefined,t)},has:function(e){return e=w(this,e),e>=0&&(this.size!==undefined?this.size===Infinity||e<this.size:this.indexOf(e)!==-1)},interpose:function(e){return fr(this,or(this,e))},last:function(){return this.get(-1)},skip:function(e){var t=this,n=tr(t,e,!1);return jt(t)&&n!==t&&(n.get=function(n,r){return n=w(this,n),n>=0?t.get(n+e,r):r}),fr(this,n)},skipWhile:function(e,t){return fr(this,nr(this,e,t,!1))},take:function(e){var t=this,n=Zn(t,e);return jt(t)&&n!==t&&(n.get=function(n,r){return n=w(this,n),n>=0&&n<e?t.get(n,r):r}),fr(this,n)}},{},et),ft.prototype[it]=!0,ft.prototype[st]=!0;var lt=function(t){return ct(t)&&!dt(t)?t:Ot(t)};i.createClass(lt,{get:function(e,t){return this.has(e)?e:t},contains:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}},{},et),lt.prototype.has=ot.contains,et.isIterable=ct,et.isKeyed=ht,et.isIndexed=pt,et.isAssociative=dt,et.isOrdered=vt,et.Keyed=ut,et.Indexed=ft,et.Set=lt,et.Iterator=V;var Tt=function(t){return t===null||t===undefined?It():ct(t)?t.toSeq():Ut(t)},Nt=Tt;i.createClass(Tt,{toSeq:function(){return this},toString:function(){return this.__toString("Seq {","}")},cacheResult:function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},__iterate:function(e,t){return Xt(this,e,t,!0)},__iterator:function(e,t){return Vt(this,e,t,!0)}},{of:function(){return Nt(arguments)}},et);var Ct=function(t){return t===null||t===undefined?It().toKeyedSeq():ct(t)?ht(t)?t.toSeq():t.fromEntrySeq():qt(t)},kt=Ct;i.createClass(Ct,{toKeyedSeq:function(){return this},toSeq:function(){return this}},{of:function(){return kt(arguments)}},Tt),xt(Ct,ut.prototype);var Lt=function(t){return t===null||t===undefined?It():ct(t)?ht(t)?t.entrySeq():t.toIndexedSeq():Rt(t)},At=Lt;i.createClass(Lt,{toIndexedSeq:function(){return this},toString:function(){return this.__toString("Seq [","]")},__iterate:function(e,t){return Xt(this,e,t,!1)},__iterator:function(e,t){return Vt(this,e,t,!1)}},{of:function(){return At(arguments)}},Tt),xt(Lt,ft.prototype);var Ot=function(t){return(t===null||t===undefined?It():ct(t)?ht(t)?t.entrySeq():t:Rt(t)).toSetSeq()},Mt=Ot;i.createClass(Ot,{toSetSeq:function(){return this}},{of:function(){return Mt(arguments)}},Tt),xt(Ot,lt.prototype),Tt.isSeq=jt,Tt.Keyed=Ct,Tt.Set=Ot,Tt.Indexed=Lt;var _t="@@__IMMUTABLE_SEQ__@@";Tt.prototype[_t]=!0;var Dt=function(t){this._array=t,this.size=t.length};i.createClass(Dt,{get:function(e,t){return this.has(e)?this._array[w(this,e)]:t},__iterate:function(e,t){var n=this._array,r=n.length-1;for(var i=0;i<=r;i++)if(e(n[t?r-i:i],i,this)===!1)return i+1;return i},__iterator:function(e,t){var n=this._array,r=n.length-1,i=0;return new V(function(){return i>r?K():J(e,i,n[t?r-i++:i++])})}},{},Lt);var Pt=function(t){var n=Object.keys(t);this._object=t,this._keys=n,this.size=n.length};i.createClass(Pt,{get:function(e,t){return t!==undefined&&!this.has(e)?t:this._object[e]},has:function(e){return this._object.hasOwnProperty(e)},__iterate:function(e,t){var n=this._object,r=this._keys,i=r.length-1;for(var s=0;s<=i;s++){var o=r[t?i-s:s];if(e(n[o],o,this)===!1)return s+1}return s},__iterator:function(e,t){var n=this._object,r=this._keys,i=r.length-1,s=0;return new V(function(){var o=r[t?i-s:s];return s++>i?K():J(e,o,n[o])})}},{},Ct),Pt.prototype[st]=!0;var Ht=function(t){this._iterable=t,this.size=t.length||t.size};i.createClass(Ht,{__iterateUncached:function(e,t){if(t)return this.cacheResult().__iterate(e,t);var n=this._iterable,r=Y(n),i=0;if(G(r)){var s;while(!(s=r.next()).done)if(e(s.value,i++,this)===!1)break}return i},__iteratorUncached:function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterable,r=Y(n);if(!G(r))return new V(K);var i=0;return new V(function(){var t=r.next();return t.done?t:J(e,i++,t.value)})}},{},Lt);var Bt=function(t){this._iterator=t,this._iteratorCache=[]};i.createClass(Bt,{__iterateUncached:function(e,t){if(t)return this.cacheResult().__iterate(e,t);var n=this._iterator,r=this._iteratorCache,i=0;while(i<r.length)if(e(r[i],i++,this)===!1)return i;var s;while(!(s=n.next()).done){var o=s.value;r[i]=o;if(e(o,i++,this)===!1)break}return i},__iteratorUncached:function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterator,r=this._iteratorCache,i=0;return new V(function(){if(i>=r.length){var t=n.next();if(t.done)return t;r[i]=t.value}return J(e,i,r[i++])})}},{},Lt);var Ft,Gt=function(){throw TypeError("Abstract")};i.createClass(Gt,{},{},et);var Yt=function(){i.defaultSuperCall(this,Zt.prototype,arguments)},Zt=Yt;i.createClass(Yt,{},{},Gt),xt(Yt,ut.prototype);var en=function(){i.defaultSuperCall(this,tn.prototype,arguments)},tn=en;i.createClass(en,{},{},Gt),xt(en,ft.prototype);var nn=function(){i.defaultSuperCall(this,rn.prototype,arguments)},rn=nn;i.createClass(nn,{},{},Gt),xt(nn,lt.prototype),Gt.Keyed=Yt,Gt.Indexed=en,Gt.Set=nn;var sn=function(t){return t===null||t===undefined?Tn():on(t)?t:Tn().merge(ut(t))};i.createClass(sn,{toString:function(){return this.__toString("Map {","}")},get:function(e,t){return this._root?this._root.get(0,undefined,e,t):t},set:function(e,t){return Nn(this,e,t)},setIn:function(e,t){return o(e.length>0,"Requires non-empty key path."),this.updateIn(e,function(){return t})},remove:function(e){return Nn(this,e,c)},removeIn:function(e){return o(e.length>0,"Requires non-empty key path."),this.updateIn(e,function(){return c})},update:function(e,t,n){return arguments.length===1?e(this):this.updateIn([e],t,n)},updateIn:function(e,t,n){return n||(n=t,t=undefined),e.length===0?n(this):Hn(this,e,t,n,0)},clear:function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=undefined,this.__altered=!0,this):Tn()},merge:function(){return _n(this,undefined,arguments)},mergeWith:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return _n(this,e,t)},mergeDeep:function(){return _n(this,Dn(undefined),arguments)},mergeDeepWith:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return _n(this,Dn(e),t)},sort:function(e){return Hr(ur(this,e))},sortBy:function(e,t){return Hr(ur(this,t,e))},withMutations:function(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this},asMutable:function(){return this.__ownerID?this:this.__ensureOwner(new m)},asImmutable:function(){return this.__ensureOwner()},wasAltered:function(){return this.__altered},__iterator:function(e,t){return new bn(this,e,t)},__iterate:function(e,t){var n=this,r=0;return this._root&&this._root.iterate(function(t){return r++,e(t[1],t[0],n)},t),r},__ensureOwner:function(e){return e===this.__ownerID?this:e?Sn(this.size,this._root,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)}},{},Yt),sn.isMap=on;var un="@@__IMMUTABLE_MAP__@@",an=sn.prototype;an[un]=!0,an[u]=an.remove;var fn=function(t,n){this.ownerID=t,this.entries=n},ln=fn;i.createClass(fn,{get:function(e,t,n,r){var i=this.entries;for(var o=0,u=i.length;o<u;o++)if(s(n,i[o][0]))return i[o][1];return r},update:function(e,t,n,r,i,o,u){var a=i===c,f=this.entries,l=0;for(var h=f.length;l<h;l++)if(s(r,f[l][0]))break;var p=l<h;if(p?f[l][1]===i:a)return this;v(u),(a||!p)&&v(o);if(a&&f.length===1)return;if(!p&&!a&&f.length>=qn)return An(e,f,r,i);var d=e&&e===this.ownerID,m=d?f:g(f);return p?a?l===h-1?m.pop():m[l]=m.pop():m[l]=[r,i]:m.push([r,i]),d?(this.entries=m,this):new ln(e,m)}},{});var cn=function(t,n,r){this.ownerID=t,this.bitmap=n,this.nodes=r},hn=cn;i.createClass(cn,{get:function(e,t,n,r){t===undefined&&(t=C(n));var i=1<<((e===0?t:t>>>e)&l),s=this.bitmap;return(s&i)===0?r:this.nodes[Bn(s&i-1)].get(e+a,t,n,r)},update:function(e,t,n,r,i,s,o){n===undefined&&(n=C(r));var u=(t===0?n:n>>>t)&l,f=1<<u,h=this.bitmap,p=(h&f)!==0;if(!p&&i===c)return this;var d=Bn(h&f-1),v=this.nodes,m=p?v[d]:undefined,g=Cn(m,e,t+a,n,r,i,s,o);if(g===m)return this;if(!p&&g&&v.length>=Rn)return Mn(e,v,h,u,g);if(p&&!g&&v.length===2&&kn(v[d^1]))return v[d^1];if(p&&g&&v.length===1&&kn(g))return g;var y=e&&e===this.ownerID,b=p?g?h:h^f:h|f,w=p?g?jn(v,d,g,y):In(v,d,y):Fn(v,d,g,y);return y?(this.bitmap=b,this.nodes=w,this):new hn(e,b,w)}},{});var pn=function(t,n,r){this.ownerID=t,this.count=n,this.nodes=r},dn=pn;i.createClass(pn,{get:function(e,t,n,r){t===undefined&&(t=C(n));var i=(e===0?t:t>>>e)&l,s=this.nodes[i];return s?s.get(e+a,t,n,r):r},update:function(e,t,n,r,i,s,o){n===undefined&&(n=C(r));var u=(t===0?n:n>>>t)&l,f=i===c,h=this.nodes,p=h[u];if(f&&!p)return this;var d=Cn(p,e,t+a,n,r,i,s,o);if(d===p)return this;var v=this.count;if(!p)v++;else if(!d){v--;if(v<Un)return On(e,h,v,u)}var m=e&&e===this.ownerID,g=jn(h,u,d,m);return m?(this.count=v,this.nodes=g,this):new dn(e,v,g)}},{});var vn=function(t,n,r){this.ownerID=t,this.keyHash=n,this.entries=r},mn=vn;i.createClass(vn,{get:function(e,t,n,r){var i=this.entries;for(var o=0,u=i.length;o<u;o++)if(s(n,i[o][0]))return i[o][1];return r},update:function(e,t,n,r,i,o,u){n===undefined&&(n=C(r));var a=i===c;if(n!==this.keyHash)return a?this:(v(u),v(o),Ln(this,e,t,n,[r,i]));var f=this.entries,l=0;for(var h=f.length;l<h;l++)if(s(r,f[l][0]))break;var p=l<h;if(p?f[l][1]===i:a)return this;v(u),(a||!p)&&v(o);if(a&&h===2)return new gn(e,this.keyHash,f[l^1]);var d=e&&e===this.ownerID,m=d?f:g(f);return p?a?l===h-1?m.pop():m[l]=m.pop():m[l]=[r,i]:m.push([r,i]),d?(this.entries=m,this):new mn(e,this.keyHash,m)}},{});var gn=function(t,n,r){this.ownerID=t,this.keyHash=n,this.entry=r},yn=gn;i.createClass(gn,{get:function(e,t,n,r){return s(n,this.entry[0])?this.entry[1]:r},update:function(e,t,n,r,i,o,u){var a=i===c,f=s(r,this.entry[0]);if(f?i===this.entry[1]:a)return this;v(u);if(a){v(o);return}return f?e&&e===this.ownerID?(this.entry[1]=i,this):new yn(e,this.keyHash,[r,i]):(v(o),Ln(this,e,t,C(r),[r,i]))}},{}),fn.prototype.iterate=vn.prototype.iterate=function(e,t){var n=this.entries;for(var r=0,i=n.length-1;r<=i;r++)if(e(n[t?i-r:r])===!1)return!1},cn.prototype.iterate=pn.prototype.iterate=function(e,t){var n=this.nodes;for(var r=0,i=n.length-1;r<=i;r++){var s=n[t?i-r:r];if(s&&s.iterate(e,t)===!1)return!1}},gn.prototype.iterate=function(e,t){return e(this.entry)};var bn=function(t,n,r){this._type=n,this._reverse=r,this._stack=t._root&&En(t._root)};i.createClass(bn,{next:function(){var e=this._type,t=this._stack;while(t){var n=t.node,r=t.index++,i;if(n.entry){if(r===0)return wn(e,n.entry)}else if(n.entries){i=n.entries.length-1;if(r<=i)return wn(e,n.entries[this._reverse?i-r:r])}else{i=n.nodes.length-1;if(r<=i){var s=n.nodes[this._reverse?i-r:r];if(s){if(s.entry)return wn(e,s.entry);t=this._stack=En(s,t)}continue}}t=this._stack=this._stack.__prev}return K()}},{},V);var xn,qn=f/4,Rn=f/2,Un=f/4,zn=function(t,n){this._iter=t,this._useKeys=n,this.size=t.size};i.createClass(zn,{get:function(e,t){return this._iter.get(e,t)},has:function(e){return this._iter.has(e)},valueSeq:function(){return this._iter.valueSeq()},reverse:function(){var e=this,t=Kn(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},map:function(e,t){var n=this,r=Jn(this,e,t);return this._useKeys||(r.valueSeq=function(){return n._iter.toSeq().map(e,t)}),r},__iterate:function(e,t){var n=this,r;return this._iter.__iterate(this._useKeys?function(t,r){return e(t,r,n)}:(r=t?cr(this):0,function(i){return e(i,t?--r:r++,n)}),t)},__iterator:function(e,t){if(this._useKeys)return this._iter.__iterator(e,t);var n=this._iter.__iterator(R,t),r=t?cr(this):0;return new V(function(){var i=n.next();return i.done?i:J(e,t?--r:r++,i.value,i)})}},{},Ct),zn.prototype[st]=!0;var Wn=function(t){this._iter=t,this.size=t.size};i.createClass(Wn,{contains:function(e){return this._iter.contains(e)},__iterate:function(e,t){var n=this,r=0;return this._iter.__iterate(function(t){return e(t,r++,n)},t)},__iterator:function(e,t){var n=this._iter.__iterator(R,t),r=0;return new V(function(){var t=n.next();return t.done?t:J(e,r++,t.value,t)})}},{},Lt);var Xn=function(t){this._iter=t,this.size=t.size};i.createClass(Xn,{has:function(e){return this._iter.contains(e)},__iterate:function(e,t){var n=this;return this._iter.__iterate(function(t){return e(t,t,n)},t)},__iterator:function(e,t){var n=this._iter.__iterator(R,t);return new V(function(){var t=n.next();return t.done?t:J(e,t.value,t.value,t)})}},{},Ot);var Vn=function(t){this._iter=t,this.size=t.size};i.createClass(Vn,{entrySeq:function(){return this._iter.toSeq()},__iterate:function(e,t){var n=this;return this._iter.__iterate(function(t){if(t)return lr(t),e(t[1],t[0],n)},t)},__iterator:function(e,t){var n=this._iter.__iterator(R,t);return new V(function(){for(;;){var t=n.next();if(t.done)return t;var r=t.value;if(r)return lr(r),e===U?t:J(e,r[0],r[1],t)}})}},{},Ct),Wn.prototype.cacheResult=zn.prototype.cacheResult=Xn.prototype.cacheResult=Vn.prototype.cacheResult=dr;var mr=function(t){var n=kr();if(t===null||t===undefined)return n;if(gr(t))return t;t=ft(t);var r=t.size;return r===0?n:r>0&&r<f?Nr(0,r,a,null,new wr(t.toArray())):n.merge(t)};i.createClass(mr,{toString:function(){return this.__toString("List [","]")},get:function(e,t){e=w(this,e);if(e<0||e>=this.size)return t;e+=this._origin;var n=Mr(this,e);return n&&n.array[e&l]},set:function(e,t){return Lr(this,e,t)},remove:function(e){return this.has(e)?e===0?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},clear:function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=a,this._root=this._tail=null,this.__hash=undefined,this.__altered=!0,this):kr()},push:function(){var e=arguments,t=this.size;return this.withMutations(function(n){_r(n,0,t+e.length);for(var r=0;r<e.length;r++)n.set(t+r,e[r])})},pop:function(){return _r(this,0,-1)},unshift:function(){var e=arguments;return this.withMutations(function(t){_r(t,-e.length);for(var n=0;n<e.length;n++)t.set(n,e[n])})},shift:function(){return _r(this,1)},merge:function(){return Dr(this,undefined,arguments)},mergeWith:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return Dr(this,e,t)},mergeDeep:function(){return Dr(this,Dn(undefined),arguments)},mergeDeepWith:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return Dr(this,Dn(e),t)},setSize:function(e){return _r(this,0,e)},slice:function(e,t){var n=this.size;return S(e,t,n)?this:_r(this,x(e,n),T(t,n))},__iterator:function(e,t){return new xr(this,e,t)},__iterate:function(e,t){var n=this,r=0,i=function(t){return e(t,r++,n)},s=Pr(this._capacity);return t?Sr(this._tail,0,s-this._origin,this._capacity-this._origin,i,t)&&Sr(this._root,this._level,-this._origin,s-this._origin,i,t):Sr(this._root,this._level,-this._origin,s-this._origin,i,t)&&Sr(this._tail,0,s-this._origin,this._capacity-this._origin,i,t),r},__ensureOwner:function(e){return e===this.__ownerID?this:e?Nr(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this.__ownerID=e,this)}},{of:function(){return this(arguments)}},en),mr.isList=gr;var yr="@@__IMMUTABLE_LIST__@@",br=mr.prototype;br[yr]=!0,br[u]=br.remove,br.setIn=an.setIn,br.removeIn=an.removeIn,br.update=an.update,br.updateIn=an.updateIn,br.withMutations=an.withMutations,br.asMutable=an.asMutable,br.asImmutable=an.asImmutable,br.wasAltered=an.wasAltered;var wr=function(t,n){this.array=t,this.ownerID=n},Er=wr;i.createClass(wr,{removeBefore:function(e,t,n){if(n===t?1<<t:this.array.length===0)return this;var r=n>>>t&l;if(r>=this.array.length)return new Er([],e);var i=r===0,s;if(t>0){var o=this.array[r];s=o&&o.removeBefore(e,t-a,n);if(s===o&&i)return this}if(i&&!s)return this;var u=Or(this,e);if(!i)for(var f=0;f<r;f++)u.array[f]=undefined;return s&&(u.array[r]=s),u},removeAfter:function(e,t,n){if(n===t?1<<t:this.array.length===0)return this;var r=n-1>>>t&l;if(r>=this.array.length)return this;var i=r===this.array.length-1,s;if(t>0){var o=this.array[r];s=o&&o.removeAfter(e,t-a,n);if(s===o&&i)return this}if(i&&!s)return this;var u=Or(this,e);return i||u.array.pop(),s&&(u.array[r]=s),u}},{});var xr=function(t,n,r){this._type=n,this._reverse=!!r,this._maxIndex=t.size-1;var i=Pr(t._capacity),s=Tr(t._root&&t._root.array,t._level,-t._origin,i-t._origin-1),o=Tr(t._tail&&t._tail.array,0,i-t._origin,t._capacity-t._origin-1);this._stack=r?o:s,this._stack.__prev=r?s:o};i.createClass(xr,{next:function(){var e=this._stack;while(e){var t=e.array,n=e.index++;this._reverse&&(n=l-n,n>e.rawMax&&(n=e.rawMax,e.index=f-n));if(n>=0&&n<f&&n<=e.rawMax){var r=t&&t[n];if(e.level===0){var i=this._type,s;return i!==1&&(s=e.offset+(n<<e.level),this._reverse&&(s=this._maxIndex-s)),J(i,s,r)}this._stack=e=Tr(r&&r.array,e.level-a,e.offset+(n<<e.level),e.max,e);continue}e=this._stack=this._stack.__prev}return K()}},{},V);var Cr,Hr=function(t){return t===null||t===undefined?Ir():Br(t)?t:Ir().merge(ut(t))};i.createClass(Hr,{toString:function(){return this.__toString("OrderedMap {","}")},get:function(e,t){var n=this._map.get(e);return n!==undefined?this._list.get(n)[1]:t},clear:function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Ir()},set:function(e,t){return qr(this,e,t)},remove:function(e){return qr(this,e,c)},wasAltered:function(){return this._map.wasAltered()||this._list.wasAltered()},__iterate:function(e,t){var n=this;return this._list.__iterate(function(t){return t&&e(t[1],t[0],n)},t)},__iterator:function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},__ensureOwner:function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),n=this._list.__ensureOwner(e);return e?jr(t,n,e,this.__hash):(this.__ownerID=e,this._map=t,this._list=n,this)}},{of:function(){return this(arguments)}},sn),Hr.isOrderedMap=Br,Hr.prototype[st]=!0,Hr.prototype[u]=Hr.prototype.remove;var Fr,Rr=function(t){return t===null||t===undefined?Jr():zr(t)?t:Jr().unshiftAll(t)},Ur=Rr;i.createClass(Rr,{toString:function(){return this.__toString("Stack [","]")},get:function(e,t){var n=this._head;while(n&&e--)n=n.next;return n?n.value:t},peek:function(){return this._head&&this._head.value},push:function(){if(arguments.length===0)return this;var e=this.size+arguments.length,t=this._head;for(var n=arguments.length-1;n>=0;n--)t={value:arguments[n],next:t};return this.__ownerID?(this.size=e,this._head=t,this.__hash=undefined,this.__altered=!0,this):Vr(e,t)},pushAll:function(e){e=ft(e);if(e.size===0)return this;var t=this.size,n=this._head;return e.reverse().forEach(function(e){t++,n={value:e,next:n}}),this.__ownerID?(this.size=t,this._head=n,this.__hash=undefined,this.__altered=!0,this):Vr(t,n)},pop:function(){return this.slice(1)},unshift:function(){return this.push.apply(this,arguments)},unshiftAll:function(e){return this.pushAll(e)},shift:function(){return this.pop.apply(this,arguments)},clear:function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=undefined,this.__hash=undefined,this.__altered=!0,this):Jr()},slice:function(e,t){if(S(e,t,this.size))return this;var n=x(e,this.size),r=T(t,this.size);if(r!==this.size)return i.superCall(this,Ur.prototype,"slice",[e,t]);var s=this.size-n,o=this._head;while(n--)o=o.next;return this.__ownerID?(this.size=s,this._head=o,this.__hash=undefined,this.__altered=!0,this):Vr(s,o)},__ensureOwner:function(e){return e===this.__ownerID?this:e?Vr(this.size,this._head,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},__iterate:function(e,t){if(t)return this.toSeq().cacheResult.__iterate(e,t);var n=0,r=this._head;while(r){if(e(r.value,n++,this)===!1)break;r=r.next}return n},__iterator:function(e,t){if(t)return this.toSeq().cacheResult().__iterator(e,t);var n=0,r=this._head;return new V(function(){if(r){var t=r.value;return r=r.next,J(e,n++,t)}return K()})}},{of:function(){return this(arguments)}},en),Rr.isStack=zr;var Wr="@@__IMMUTABLE_STACK__@@",Xr=Rr.prototype;Xr[Wr]=!0,Xr.withMutations=an.withMutations,Xr.asMutable=an.asMutable,Xr.asImmutable=an.asImmutable,Xr.wasAltered=an.wasAltered;var $r,Kr=function(t){return t===null||t===undefined?ni():Qr(t)?t:ni().union(lt(t))};i.createClass(Kr,{toString:function(){return this.__toString("Set {","}")},has:function(e){return this._map.has(e)},add:function(e){return Zr(this,this._map.set(e,!0))},remove:function(e){return Zr(this,this._map.remove(e))},clear:function(){return Zr(this,this._map.clear())},union:function(){var e=arguments;return e.length===0?this:this.withMutations(function(t){for(var n=0;n<e.length;n++)lt(e[n]).forEach(function(e){return t.add(e)})})},intersect:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(e.length===0)return this;e=e.map(function(e){return lt(e)});var n=this;return this.withMutations(function(t){n.forEach(function(n){e.every(function(e){return e.contains(n)})||t.remove(n)})})},subtract:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(e.length===0)return this;e=e.map(function(e){return lt(e)});var n=this;return this.withMutations(function(t){n.forEach(function(n){e.some(function(e){return e.contains(n)})&&t.remove(n)})})},merge:function(){return this.union.apply(this,arguments)},mergeWith:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.union.apply(this,t)},sort:function(e){return ri(ur(this,e))},sortBy:function(e,t){return ri(ur(this,t,e))},wasAltered:function(){return this._map.wasAltered()},__iterate:function(e,t){var n=this;return this._map.__iterate(function(t,r){return e(r,r,n)},t)},__iterator:function(e,t){return this._map.map(function(e,t){return t}).__iterator(e,t)},__ensureOwner:function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):(this.__ownerID=e,this._map=t,this)}},{of:function(){return this(arguments)},fromKeys:function(e){return this(ut(e).keySeq())}},nn),Kr.isSet=Qr;var Gr="@@__IMMUTABLE_SET__@@",Yr=Kr.prototype;Yr[Gr]=!0,Yr[u]=Yr.remove,Yr.mergeDeep=Yr.merge,Yr.mergeDeepWith=Yr.mergeWith,Yr.withMutations=an.withMutations,Yr.asMutable=an.asMutable,Yr.asImmutable=an.asImmutable,Yr.__empty=ni,Yr.__make=ei;var ti,ri=function(t){return t===null||t===undefined?ai():ii(t)?t:ai().union(lt(t))};i.createClass(ri,{toString:function(){return this.__toString("OrderedSet {","}")}},{of:function(){return this(arguments)},fromKeys:function(e){return this(ut(e).keySeq())}},Kr),ri.isOrderedSet=ii;var si=ri.prototype;si[st]=!0,si.__empty=ai,si.__make=oi;var ui,fi=function(t,n){var r=function(t){if(!(this instanceof r))return new r(t);this._map=sn(t)},i=Object.keys(t),s=r.prototype=Object.create(li);s.constructor=r,n&&(s._name=n),s._defaultValues=t,s._keys=i,s.size=i.length;try{i.forEach(function(e){Object.defineProperty(r.prototype,e,{get:function(){return this.get(e)},set:function(t){o(this.__ownerID,"Cannot set on an immutable record."),this.set(e,t)}})})}catch(u){}return r};i.createClass(fi,{toString:function(){return this.__toString(hi(this)+" {","}")},has:function(e){return this._defaultValues.hasOwnProperty(e)},get:function(e,t){if(!this.has(e))return t;var n=this._defaultValues[e];return this._map?this._map.get(e,n):n},clear:function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var e=Object.getPrototypeOf(this).constructor;return e._empty||(e._empty=ci(this,Tn()))},set:function(e,t){if(!this.has(e))throw new Error('Cannot set unknown key "'+e+'" on '+hi(this));var n=this._map&&this._map.set(e,t);return this.__ownerID||n===this._map?this:ci(this,n)},remove:function(e){if(!this.has(e))return this;var t=this._map&&this._map.remove(e);return this.__ownerID||t===this._map?this:ci(this,t)},wasAltered:function(){return this._map.wasAltered()},__iterator:function(e,t){var n=this;return ut(this._defaultValues).map(function(e,t){return n.get(t)}).__iterator(e,t)},__iterate:function(e,t){var n=this;return ut(this._defaultValues).map(function(e,t){return n.get(t)}).__iterate(e,t)},__ensureOwner:function(e){if(e===this.__ownerID)return this;var t=this._map&&this._map.__ensureOwner(e);return e?ci(this,t,e):(this.__ownerID=e,this._map=t,this)}},{},Yt);var li=fi.prototype;li[u]=li.remove,li.merge=an.merge,li.mergeWith=an.mergeWith,li.mergeDeep=an.mergeDeep,li.mergeDeepWith=an.mergeDeepWith,li.update=an.update,li.updateIn=an.updateIn,li.withMutations=an.withMutations,li.asMutable=an.asMutable,li.asImmutable=an.asImmutable;var pi=function(t,n,r){if(!(this instanceof di))return new di(t,n,r);o(r!==0,"Cannot step a Range by 0"),t=t||0,n===undefined&&(n=Infinity);if(t===n&&mi)return mi;r=r===undefined?1:Math.abs(r),n<t&&(r=-r),this._start=t,this._end=n,this._step=r,this.size=Math.max(0,Math.ceil((n-t)/r-1)+1)},di=pi;i.createClass(pi,{toString:function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step>1?" by "+this._step:"")+" ]"},get:function(e,t){return this.has(e)?this._start+w(this,e)*this._step:t},contains:function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},slice:function(e,t){return S(e,t,this.size)?this:(e=x(e,this.size),t=T(t,this.size),t<=e?mi:new di(this.get(e,this._end),this.get(t,this._end),this._step))},indexOf:function(e){var t=e-this._start;if(t%this._step===0){var n=t/this._step;if(n>=0&&n<this.size)return n}return-1},lastIndexOf:function(e){return this.indexOf(e)},take:function(e){return this.slice(0,Math.max(0,e))},skip:function(e){return this.slice(Math.max(0,e))},__iterate:function(e,t){var n=this.size-1,r=this._step,i=t?this._start+n*r:this._start;for(var s=0;s<=n;s++){if(e(i,s,this)===!1)return s+1;i+=t?-r:r}return s},__iterator:function(e,t){var n=this.size-1,r=this._step,i=t?this._start+n*r:this._start,s=0;return new V(function(){var o=i;return i+=t?-r:r,s>n?K():J(e,s++,o)})},__deepEquals:function(e){return e instanceof di?this._start===e._start&&this._end===e._end&&this._step===e._step:St(this,e)}},{},Lt);var vi=pi.prototype;vi.__toJS=vi.toArray,vi.first=br.first,vi.last=br.last;var mi=pi(0,0),gi=function(t,n){if(n<=0&&wi)return wi;if(!(this instanceof yi))return new yi(t,n);this._value=t,this.size=n===undefined?Infinity:Math.max(0,n),this.size===0&&(wi=this)},yi=gi;i.createClass(gi,{toString:function(){return this.size===0?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},get:function(e,t){return this.has(e)?this._value:t},contains:function(e){return s(this._value,e)},slice:function(e,t){var n=this.size;return S(e,t,n)?this:new yi(this._value,T(t,n)-x(e,n))},reverse:function(){return this},indexOf:function(e){return s(this._value,e)?0:-1},lastIndexOf:function(e){return s(this._value,e)?this.size:-1},__iterate:function(e,t){for(var n=0;n<this.size;n++)if(e(this._value,n,this)===!1)return n+1;return n},__iterator:function(e,t){var n=this,r=0;return new V(function(){return r<n.size?J(e,r++,n._value):K()})},__deepEquals:function(e){return e instanceof yi?s(this._value,e._value):St(e)}},{},Lt);var bi=gi.prototype;bi.last=bi.first,bi.has=vi.has,bi.take=vi.take,bi.skip=vi.skip,bi.__toJS=vi.__toJS;var wi,Ei={Iterable:et,Seq:Tt,Collection:Gt,Map:sn,OrderedMap:Hr,List:mr,Stack:Rr,Set:Kr,OrderedSet:ri,Record:fi,Range:pi,Repeat:gi,is:s,fromJS:$t};return Ei}var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){}),define("lodash-amd/modern/internals/isNative",[],function(){function r(e){return typeof e=="function"&&n.test(e)}var e=Object.prototype,t=e.toString,n=RegExp("^"+String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return r}),define("lodash-amd/modern/internals/objectTypes",[],function(){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1};return e}),define("lodash-amd/modern/objects/isObject",["../internals/objectTypes"],function(e){function t(t){return!!t&&!!e[typeof t]}return t}),define("lodash-amd/modern/internals/shimKeys",["./objectTypes"],function(e){var t=Object.prototype,n=t.hasOwnProperty,r=function(t){var r,i=t,s=[];if(!i)return s;if(!e[typeof t])return s;for(r in i)n.call(i,r)&&s.push(r);return s};return r}),define("lodash-amd/modern/objects/keys",["../internals/isNative","./isObject","../internals/shimKeys"],function(e,t,n){var r=e(r=Object.keys)&&r,i=r?function(e){return t(e)?r(e):[]}:n;return i}),define("lodash-amd/modern/objects/defaults",["./keys","../internals/objectTypes"],function(e,t){var n=function(n,r,i){var s,o=n,u=o;if(!o)return u;var a=arguments,f=0,l=typeof i=="number"?2:a.length;while(++f<l){o=a[f];if(o&&t[typeof o]){var c=-1,h=t[typeof o]&&e(o),p=h?h.length:0;while(++c<p)s=h[c],typeof u[s]=="undefined"&&(u[s]=o[s])}}return u};return n}),define("plugins/core/commands/indent",[],function(){return function(){return function(e){var t=new e.api.Command("indent");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return e.nodeName==="UL"||e.nodeName==="OL"});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!n},e.commands.indent=t}}}),define("plugins/core/commands/insert-list",[],function(){return function(){return function(e){var t=function(t){e.api.Command.call(this,t)};t.prototype=Object.create(e.api.Command.prototype),t.prototype.constructor=t,t.prototype.execute=function(t){function n(e){if(e.length>0){var t=document.createElement(s.nodeName);e.forEach(function(e){t.appendChild(e)}),s.parentNode.insertBefore(t,s.nextElementSibling)}}if(this.queryState()){var r=new e.api.Selection,i=r.range,s=r.getContaining(function(e){return e.nodeName==="OL"||e.nodeName==="UL"}),o=r.getContaining(function(e){return e.nodeName==="LI"});e.transactionManager.run(function(){if(o){var t=(new e.api.Node(o)).nextAll();n(t),r.placeMarkers();var u=document.createElement("p");u.innerHTML=o.innerHTML,s.parentNode.insertBefore(u,s.nextElementSibling),o.parentNode.removeChild(o)}else{var a=Array.prototype.map.call(s.querySelectorAll("li"),function(e){return i.intersectsNode(e)&&e}).filter(function(e){return e}),f=a.slice(-1)[0],l=(new e.api.Node(f)).nextAll();n(l),r.placeMarkers();var c=document.createDocumentFragment();a.forEach(function(e){var t=document.createElement("p");t.innerHTML=e.innerHTML,c.appendChild(t)}),s.parentNode.insertBefore(c,s.nextElementSibling),a.forEach(function(e){e.parentNode.removeChild(e)})}s.childNodes.length===0&&s.parentNode.removeChild(s),r.selectMarkers()}.bind(this))}else e.api.Command.prototype.execute.call(this,t)},t.prototype.queryEnabled=function(){return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()},e.commands.insertOrderedList=new t("insertOrderedList"),e.commands.insertUnorderedList=new t("insertUnorderedList")}}}),define("plugins/core/commands/outdent",[],function(){return function(){return function(e){var t=new e.api.Command("outdent");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return e.nodeName==="UL"||e.nodeName==="OL"});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!n},e.commands.outdent=t}}}),define("plugins/core/commands/redo",[],function(){return function(){return function(e){var t=new e.api.Command("redo");t.execute=function(){var t=e.undoManager.redo();typeof t!="undefined"&&e.restoreFromHistory(t)},t.queryEnabled=function(){return e.undoManager.position<e.undoManager.stack.length-1},e.commands.redo=t,e.el.addEventListener("keydown",function(e){e.shiftKey&&(e.metaKey||e.ctrlKey)&&e.keyCode===90&&(e.preventDefault(),t.execute())})}}}),define("plugins/core/commands/subscript",[],function(){return function(){return function(e){var t=new e.api.Command("subscript");e.commands.subscript=t}}}),define("plugins/core/commands/superscript",[],function(){return function(){return function(e){var t=new e.api.Command("superscript");e.commands.superscript=t}}}),define("plugins/core/commands/undo",[],function(){return function(){return function(e){var t=new e.api.Command("undo");t.execute=function(){var t=e.undoManager.undo();typeof t!="undefined"&&e.restoreFromHistory(t)},t.queryEnabled=function(){return e.undoManager.position>1},e.commands.undo=t,e.el.addEventListener("keydown",function(e){!e.shiftKey&&(e.metaKey||e.ctrlKey)&&e.keyCode===90&&(e.preventDefault(),t.execute())})}}}),define("plugins/core/commands",["./commands/indent","./commands/insert-list","./commands/outdent","./commands/redo","./commands/subscript","./commands/superscript","./commands/undo"],function(e,t,n,r,i,s,o){return{indent:e,insertList:t,outdent:n,redo:r,subscript:i,superscript:s,undo:o}}),define("lodash-amd/modern/internals/baseIndexOf",[],function(){function e(e,t,n){var r=(n||0)-1,i=e?e.length:0;while(++r<i)if(e[r]===t)return r;return-1}return e}),define("lodash-amd/modern/utilities/noop",[],function(){function e(){}return e}),define("lodash-amd/modern/internals/baseCreate",["./isNative","../objects/isObject","../utilities/noop"],function(e,t,n){function i(e,n){return t(e)?r(e):{}}var r=e(r=Object.create)&&r;return r||(i=function(){function e(){}return function(n){if(t(n)){e.prototype=n;var r=new e;e.prototype=null}return r||window.Object()}}()),i}),define("lodash-amd/modern/internals/setBindData",["./isNative","../utilities/noop"],function(e,t){var n={configurable:!1,enumerable:!1,value:null,writable:!1},r=function(){try{var t={},n=e(n=Object.defineProperty)&&n,r=n(t,t,t)&&n}catch(i){}return r}(),i=r?function(e,t){n.value=t,r(e,"__bindData__",n)}:t;return i}),define("lodash-amd/modern/internals/slice",[],function(){function e(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var r=-1,i=n-t||0,s=Array(i<0?0:i);while(++r<i)s[r]=e[t+r];return s}return e}),define("lodash-amd/modern/internals/baseBind",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(e,t,n,r){function o(i){function f(){if(u){var n=r(u);s.apply(n,arguments)}if(this instanceof f){var i=e(o.prototype),l=o.apply(i,n||arguments);return t(l)?l:i}return o.apply(a,n||arguments)}var o=i[0],u=i[2],a=i[4];return n(f,i),f}var i=[],s=i.push;return o}),define("lodash-amd/modern/internals/baseCreateWrapper",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(e,t,n,r){function o(i){function y(){var n=p?c:this;if(f){var i=r(f);s.apply(i,arguments)}if(l||v){i||(i=r(arguments)),l&&s.apply(i,l);if(v&&i.length<h)return a|=16,o([u,m?a:a&-4,i,null,c,h])}i||(i=arguments),d&&(u=n[g]);if(this instanceof y){n=e(u.prototype);var b=u.apply(n,i);return t(b)?b:n}return u.apply(n,i)}var u=i[0],a=i[1],f=i[2],l=i[3],c=i[4],h=i[5],p=a&1,d=a&2,v=a&4,m=a&8,g=u;return n(y,i),y}var i=[],s=i.push;return o}),define("lodash-amd/modern/objects/isFunction",[],function(){function e(e){return typeof e=="function"}return e}),define("lodash-amd/modern/internals/createWrapper",["./baseBind","./baseCreateWrapper","../objects/isFunction","./slice"],function(e,t,n,r){function u(i,a,f,l,c,h){var p=a&1,d=a&2,v=a&4,m=a&8,g=a&16,y=a&32;if(!d&&!n(i))throw new TypeError;g&&!f.length&&(a&=-17,g=f=!1),y&&!l.length&&(a&=-33,y=l=!1);var b=i&&i.__bindData__;if(b&&b!==!0)return b=r(b),b[2]&&(b[2]=r(b[2])),b[3]&&(b[3]=r(b[3])),p&&!(b[1]&1)&&(b[4]=c),!p&&b[1]&1&&(a|=8),v&&!(b[1]&4)&&(b[5]=h),g&&s.apply(b[2]||(b[2]=[]),f),y&&o.apply(b[3]||(b[3]=[]),l),b[1]|=a,u.apply(null,b);var w=a==1||a===17?e:t;return w([i,a,f,l,c,h])}var i=[],s=i.push,o=i.unshift;return u}),define("lodash-amd/modern/functions/bind",["../internals/createWrapper","../internals/slice"],function(e,t){function n(n,r){return arguments.length>2?e(n,17,t(arguments,2),null,r):e(n,1,null,null,r)}return n}),define("lodash-amd/modern/utilities/identity",[],function(){function e(e){return e}return e}),define("lodash-amd/modern/support",["./internals/isNative"],function(e){var t=/\bthis\b/,n={};return n.funcDecomp=!e(window.WinRTError)&&t.test(function(){return this}),n.funcNames=typeof Function.name=="string",n}),define("lodash-amd/modern/internals/baseCreateCallback",["../functions/bind","../utilities/identity","./setBindData","../support"],function(e,t,n,r){function u(u,a,f){if(typeof u!="function")return t;if(typeof a!="undefined"&&"prototype"in u){var l=u.__bindData__;if(typeof l=="undefined"){r.funcNames&&(l=!u.name),l=l||!r.funcDecomp;if(!l){var c=o.call(u);r.funcNames||(l=!i.test(c)),l||(l=s.test(c),n(u,l))}}if(l===!1||l!==!0&&l[1]&1)return u;switch(f){case 1:return function(e){return u.call(a,e)};case 2:return function(e,t){return u.call(a,e,t)};case 3:return function(e,t,n){return u.call(a,e,t,n)};case 4:return function(e,t,n,r){return u.call(a,e,t,n,r)}}return e(u,a)}return u}var i=/^\s*function[ \n\r\t]+\w/,s=/\bthis\b/,o=Function.prototype.toString;return u}),define("lodash-amd/modern/objects/forOwn",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(e,t,n){var r=function(r,i,s){var o,u=r,a=u;if(!u)return a;if(!n[typeof u])return a;i=i&&typeof s=="undefined"?i:e(i,s,3);var f=-1,l=n[typeof u]&&t(u),c=l?l.length:0;while(++f<c){o=l[f];if(i(u[o],o,r)===!1)return a}return a};return r}),define("lodash-amd/modern/objects/isArray",["../internals/isNative"],function(e){var t="[object Array]",n=Object.prototype,r=n.toString,i=e(i=Array.isArray)&&i,s=i||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&r.call(e)==t||!1};return s}),define("lodash-amd/modern/objects/isString",[],function(){function r(t){return typeof t=="string"||t&&typeof t=="object"&&n.call(t)==e||!1}var e="[object String]",t=Object.prototype,n=t.toString;return r}),define("lodash-amd/modern/collections/contains",["../internals/baseIndexOf","../objects/forOwn","../objects/isArray","../objects/isString"],function(e,t,n,r){function s(s,o,u){var a=-1,f=e,l=s?s.length:0,c=!1;return u=(u<0?i(0,l+u):u)||0,n(s)?c=f(s,o,u)>-1:typeof l=="number"?c=(r(s)?s.indexOf(o,u):f(s,o,u))>-1:t(s,function(e){if(++a>=u)return!(c=e===o)}),c}var i=Math.max;return s}),define("lodash-amd/modern/objects/isArguments",[],function(){function r(t){return t&&typeof t=="object"&&typeof t.length=="number"&&n.call(t)==e||!1}var e="[object Arguments]",t=Object.prototype,n=t.toString;return r}),define("lodash-amd/modern/internals/baseFlatten",["../objects/isArguments","../objects/isArray"],function(e,t){function n(r,i,s,o){var u=(o||0)-1,a=r?r.length:0,f=[];while(++u<a){var l=r[u];if(l&&typeof l=="object"&&typeof l.length=="number"&&(t(l)||e(l))){i||(l=n(l,i,s));var c=-1,h=l.length,p=f.length;f.length+=h;while(++c<h)f[p++]=l[c]}else s||f.push(l)}return f}return n}),define("lodash-amd/modern/objects/forIn",["../internals/baseCreateCallback","../internals/objectTypes"],function(e,t){var n=function(n,r,i){var s,o=n,u=o;if(!o)return u;if(!t[typeof o])return u;r=r&&typeof i=="undefined"?r:e(r,i,3);for(s in o)if(r(o[s],s,n)===!1)return u;return u};return n}),define("lodash-amd/modern/internals/arrayPool",[],function(){var e=[];return e}),define("lodash-amd/modern/internals/getArray",["./arrayPool"],function(e){function t(){return e.pop()||[]}return t}),define("lodash-amd/modern/internals/maxPoolSize",[],function(){var e=40;return e}),define("lodash-amd/modern/internals/releaseArray",["./arrayPool","./maxPoolSize"],function(e,t){function n(n){n.length=0,e.length<t&&e.push(n)}return n}),define("lodash-amd/modern/internals/baseIsEqual",["../objects/forIn","./getArray","../objects/isFunction","./objectTypes","./releaseArray"],function(e,t,n,r,i){function m(p,g,y,b,w,E){if(y){var S=y(p,g);if(typeof S!="undefined")return!!S}if(p===g)return p!==0||1/p==1/g;var x=typeof p,T=typeof g;if(p===p&&(!p||!r[x])&&(!g||!r[T]))return!1;if(p==null||g==null)return p===g;var N=d.call(p),C=d.call(g);N==s&&(N=l),C==s&&(C=l);if(N!=C)return!1;switch(N){case u:case a:return+p==+g;case f:return p!=+p?g!=+g:p==0?1/p==1/g:p==+g;case c:case h:return p==String(g)}var k=N==o;if(!k){var L=v.call(p,"__wrapped__"),A=v.call(g,"__wrapped__");if(L||A)return m(L?p.__wrapped__:p,A?g.__wrapped__:g,y,b,w,E);if(N!=l)return!1;var O=p.constructor,M=g.constructor;if(O!=M&&!(n(O)&&O instanceof O&&n(M)&&M instanceof M)&&"constructor"in p&&"constructor"in g)return!1}var _=!w;w||(w=t()),E||(E=t());var D=w.length;while(D--)if(w[D]==p)return E[D]==g;var P=0;S=!0,w.push(p),E.push(g);if(k){D=p.length,P=g.length,S=P==D;if(S||b)while(P--){var H=D,B=g[P];if(b){while(H--)if(S=m(p[H],B,y,b,w,E))break}else if(!(S=m(p[P],B,y,b,w,E)))break}}else e(g,function(e,t,n){if(v.call(n,t))return P++,S=v.call(p,t)&&m(p[t],e,y,b,w,E)}),S&&!b&&e(p,function(e,t,n){if(v.call(n,t))return S=--P>-1});return w.pop(),E.pop(),_&&(i(w),i(E)),S}var s="[object Arguments]",o="[object Array]",u="[object Boolean]",a="[object Date]",f="[object Number]",l="[object Object]",c="[object RegExp]",h="[object String]",p=Object.prototype,d=p.toString,v=p.hasOwnProperty;return m}),define("lodash-amd/modern/utilities/property",[],function(){function e(e){return function(t){return t[e]}}return e}),define("lodash-amd/modern/functions/createCallback",["../internals/baseCreateCallback","../internals/baseIsEqual","../objects/isObject","../objects/keys","../utilities/property"],function(e,t,n,r,i){function s(s,o,u){var a=typeof s;if(s==null||a=="function")return e(s,o,u);if(a!="object")return i(s);var f=r(s),l=f[0],c=s[l];return f.length==1&&c===c&&!n(c)?function(e){var t=e[l];return c===t&&(c!==0||1/c==1/t)}:function(e){var n=f.length,r=!1;while(n--)if(!(r=t(e[f[n]],s[f[n]],null,!0)))break;return r}}return s}),define("lodash-amd/modern/collections/map",["../functions/createCallback","../objects/forOwn"],function(e,t){function n(n,r,i){var s=-1,o=n?n.length:0;r=e(r,i,3);if(typeof o=="number"){var u=Array(o);while(++s<o)u[s]=r(n[s],s,n)}else u=[],t(n,function(e,t,n){u[++s]=r(e,t,n)});return u}return n}),define("lodash-amd/modern/arrays/flatten",["../internals/baseFlatten","../collections/map"],function(e,t){function n(n,r,i,s){return typeof r!="boolean"&&r!=null&&(s=i,i=typeof r!="function"&&s&&s[r]===n?null:r,r=!1),i!=null&&(n=t(n,i,s)),e(n,r)}return n}),define("lodash-amd/modern/objects/values",["./keys"],function(e){function t(t){var n=-1,r=e(t),i=r.length,s=Array(i);while(++n<i)s[n]=t[r[n]];return s}return t}),define("lodash-amd/modern/collections/toArray",["../objects/isString","../internals/slice","../objects/values"],function(e,t,n){function r(e){return e&&typeof e.length=="number"?t(e):n(e)}return r}),define("element",["lodash-amd/modern/collections/contains"],function(e){function n(n){return e(t,n.nodeName)}function r(e){return e.nodeType===Node.ELEMENT_NODE&&e.className==="scribe-marker"}function i(e){return e.nodeType===Node.ELEMENT_NODE&&e.className==="caret-position"}function s(e,t){while(t.childNodes.length>0)e.insertBefore(t.childNodes[0],t);e.removeChild(t)}var t=["P","LI","DIV","BLOCKQUOTE","UL","OL","H1","H2","H3","H4","H5","H6","TABLE","TH","TD"];return{isBlockElement:n,isSelectionMarkerNode:r,isCaretPositionNode:i,unwrap:s}}),define("node",[],function(){function e(e){return e.nodeType===Node.TEXT_NODE&&e.textContent===""}function t(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}function n(e){return e.parentNode.removeChild(e)}return{isEmptyTextNode:e,insertAfter:t,removeNode:n}}),define("dom-observer",["lodash-amd/modern/arrays/flatten","lodash-amd/modern/collections/toArray","./element","./node"],function(e,t,n,r){function i(i,s){function o(i){var s=e(i.map(function(e){var n=t(e.addedNodes),r=t(e.removedNodes);return n.concat(r)})),o=s.filter(function(e){return!r.isEmptyTextNode(e)}).filter(function(e){return!n.isSelectionMarkerNode(e)});return o.length>0}var u=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,a=!1,f=new u(function(e){if(!a&&o(e)){a=!0;try{s()}catch(t){throw t}finally{setTimeout(function(){a=!1},0)}}});return f.observe(i,{attributes:!0,childList:!0,subtree:!0}),f}return i}),define("plugins/core/events",["lodash-amd/modern/collections/contains","../../dom-observer"],function(e,t){return function(){return function(n){var r=function(){setTimeout(function(){n.pushHistory()}.bind(n),0),n.el.removeEventListener("focus",r)}.bind(n);n.el.addEventListener("focus",r),n.el.addEventListener("focus",function(){function o(e){var t=document.createTreeWalker(e),n=t.currentNode;return t.firstChild()?t.currentNode.nodeName==="BR"?n:o(t.currentNode):t.currentNode}var t=new n.api.Selection;if(t.range){var r=n.allowsBlockElements()&&t.range.startContainer===n.el;if(r){var i=o(n.el.firstChild),s=t.range;s.setStart(i,0),s.setEnd(i,0),t.selection.removeAllRanges(),t.selection.addRange(s)}}}.bind(n));var i=function(){if(!n._skipFormatters){var e=new n.api.Selection,t=e.range,r=function(){t&&e.placeMarkers(),n.setHTML(n._htmlFormatterFactory.format(n.getHTML())),e.selectMarkers()}.bind(n);t?(n.undoManager.undo(),n.transactionManager.run(r)):r()}delete n._skipFormatters}.bind(n);t(n.el,i),n.allowsBlockElements()&&n.el.addEventListener("keydown",function(e){if(e.keyCode===13){var t=new n.api.Selection,r=t.range,i=t.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});if(i&&r.collapsed){var s=r.cloneRange();s.setEndAfter(i,0);var o=s.cloneContents();o.firstChild.textContent===""&&(e.preventDefault(),n.transactionManager.run(function(){var e=document.createElement("p"),n=document.createElement("br");e.appendChild(n),i.parentNode.insertBefore(e,i.nextElementSibling),r.setStart(e,0),r.setEnd(e,0),t.selection.removeAllRanges(),t.selection.addRange(r)}))}}}),n.allowsBlockElements()&&n.el.addEventListener("keydown",function(e){if(e.keyCode===13||e.keyCode===8){var t=new n.api.Selection,r=t.range;if(r.collapsed){var i=t.getContaining(function(e){return e.nodeName==="LI"});if(i&&i.textContent.trim()===""){e.preventDefault();var s=t.getContaining(function(e){return e.nodeName==="UL"||e.nodeName==="OL"}),o=n.getCommand(s.nodeName==="OL"?"insertOrderedList":"insertUnorderedList");o.execute()}}}}),n.el.addEventListener("paste",function(r){if(r.clipboardData)r.preventDefault(),e(r.clipboardData.types,"text/html")?n.insertHTML(r.clipboardData.getData("text/html")):n.insertPlainText(r.clipboardData.getData("text/plain"));else{var i=new n.api.Selection;i.placeMarkers();var s=document.createElement("div");document.body.appendChild(s),s.setAttribute("contenteditable",!0),s.focus(),setTimeout(function(){var e=s.innerHTML;s.parentNode.removeChild(s),i.selectMarkers(),n.el.focus(),n.insertHTML(e)},1)}})}}}),define("plugins/core/formatters/html/replace-nbsp-chars",[],function(){return function(){return function(e){var t=/(\s|&nbsp;)+/g;e.registerHTMLFormatter("export",function(e){return e.replace(t," ")})}}}),define("lodash-amd/modern/arrays/last",["../functions/createCallback","../internals/slice"],function(e,t){function i(i,s,o){var u=0,a=i?i.length:0;if(typeof s!="number"&&s!=null){var f=a;s=e(s,o,3);while(f--&&s(i[f],f,i))u++}else{u=s;if(u==null||o)return i?i[a-1]:n}return t(i,r(0,a-u))}var n,r=Math.max;return i}),define("plugins/core/formatters/html/enforce-p-elements",["lodash-amd/modern/arrays/last"],function(e){function t(t,n){var r=Array.prototype.reduce.call(n.childNodes,function(n,r){function o(){var e=[r];n.push(e)}var i=e(n);if(!i)o();else{var s=t.element.isBlockElement(i[0]);s===t.element.isBlockElement(r)?i.push(r):o()}return n},[]),i=r.filter(function(e){var n=t.element.isBlockElement(e[0]);return!n});i.forEach(function(e){var t=document.createElement("p");e[0].parentNode.insertBefore(t,e[0]),e.forEach(function(e){t.appendChild(e)})}),n._isWrapped=!0}function n(e,r){var i=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT),s=i.firstChild();while(s){if(s.nodeName==="BLOCKQUOTE"&&!s._isWrapped){t(e,s),n(e,r);break}s=i.nextSibling()}}return function(){return function(e){e.registerHTMLFormatter("normalize",function(r){var i=document.createElement("div");return i.innerHTML=r,t(e,i),n(e,i),i.innerHTML})}}}),define("plugins/core/formatters/html/ensure-selectable-containers",["../../../../element","lodash-amd/modern/collections/contains"],function(e,t){function r(e,t){return e.isCaretPositionNode(t)?!0:t.parentNode.textContent.trim()===""}function i(e,s){function u(t){return t.children.length===0&&e.isBlockElement(t)||t.children.length===1&&e.isSelectionMarkerNode(t.children[0])?!0:!e.isBlockElement(t)&&t.children.length===0?r(e,t):!1}var o=s.firstElementChild;while(o)e.isSelectionMarkerNode(o)||(u(o)&&o.textContent.trim()===""&&!t(n,o.nodeName)?o.appendChild(document.createElement("br")):o.children.length>0&&i(e,o)),o=o.nextElementSibling}var n=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];return function(){return function(e){e.registerHTMLFormatter("normalize",function(t){var n=document.createElement("div");return n.innerHTML=t,i(e.element,n),n.innerHTML})}}}),define("lodash-amd/modern/internals/htmlEscapes",[],function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e}),define("lodash-amd/modern/internals/escapeHtmlChar",["./htmlEscapes"],function(e){function t(t){return e[t]}return t}),define("lodash-amd/modern/internals/reUnescapedHtml",["./htmlEscapes","../objects/keys"],function(e,t){var n=RegExp("["+t(e).join("")+"]","g");return n}),define("lodash-amd/modern/utilities/escape",["../internals/escapeHtmlChar","../objects/keys","../internals/reUnescapedHtml"],function(e,t,n){function r(t){return t==null?"":String(t).replace(n,e)}return r}),define("plugins/core/formatters/plain-text/escape-html-characters",["lodash-amd/modern/utilities/escape"],function(e){return function(){return function(t){t.registerPlainTextFormatter(e)}}}),define("plugins/core/inline-elements-mode",[],function(){function e(e){var t=document.createTreeWalker(e);while(t.nextNode())if(t.currentNode)if(~["br"].indexOf(t.currentNode.nodeName.toLowerCase())||t.currentNode.length>0)return!0;return!1}return function(){return function(t){t.el.addEventListener("keydown",function(n){if(n.keyCode===13){var r=new t.api.Selection,i=r.range,s=r.getContaining(function(e){return e.nodeName==="LI"||/^(H[1-6])$/.test(e.nodeName)});s||(n.preventDefault(),t.transactionManager.run(function(){t.el.lastChild.nodeName==="BR"&&t.el.removeChild(t.el.lastChild);var n=document.createElement("br");i.insertNode(n),i.collapse(!1);var s=i.cloneRange();s.setEndAfter(t.el.lastChild,0);var o=s.cloneContents();if(!e(o)){var u=document.createElement("br");i.insertNode(u)}var a=i.cloneRange();a.setStartAfter(n,0),a.setEndAfter(n,0),r.selection.removeAllRanges(),r.selection.addRange(a)}))}}.bind(this)),t.getHTML().trim()===""&&t.setContent("")}}}),define("plugins/core/patches/commands/bold",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("bold");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});return e.api.CommandPatch.prototype.queryEnabled.apply(this,arguments)&&!n},e.commandPatches.bold=t}}}),define("plugins/core/patches/commands/indent",[],function(){var e="﻿";return function(){return function(t){var n=new t.api.CommandPatch("indent");n.execute=function(n){t.transactionManager.run(function(){var r=new t.api.Selection,i=r.range,s=i.commonAncestorContainer.nodeName==="P"&&i.commonAncestorContainer.innerHTML==="<br>";if(s){var o=document.createTextNode(e);i.insertNode(o),i.setStart(o,0),i.setEnd(o,0),r.selection.removeAllRanges(),r.selection.addRange(i)}t.api.CommandPatch.prototype.execute.call(this,n),r=new t.api.Selection;var u=r.getContaining(function(e){return e.nodeName==="BLOCKQUOTE"});u&&u.removeAttribute("style")}.bind(this))},t.commandPatches.indent=n}}}),define("plugins/core/patches/commands/insert-html",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("insertHTML"),n=e.element;t.execute=function(t){e.transactionManager.run(function(){function r(e){var t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),i=t.firstChild();if(!i)return;do i.nodeName==="SPAN"?n.unwrap(e,i):(i.style.lineHeight=null,i.getAttribute("style")===""&&i.removeAttribute("style")),r(i);while(i=t.nextSibling())}e.api.CommandPatch.prototype.execute.call(this,t),r(e.el)}.bind(this))},e.commandPatches.insertHTML=t}}}),define("plugins/core/patches/commands/insert-list",[],function(){return function(){return function(e){var t=e.element,n=e.node,r=function(t){e.api.CommandPatch.call(this,t)};r.prototype=Object.create(e.api.CommandPatch.prototype),r.prototype.constructor=r,r.prototype.execute=function(r){e.transactionManager.run(function(){e.api.CommandPatch.prototype.execute.call(this,r);if(this.queryState()){var i=new e.api.Selection,s=i.getContaining(function(e){return e.nodeName==="OL"||e.nodeName==="UL"});s.nextElementSibling&&s.nextElementSibling.childNodes.length===0&&n.removeNode(s.nextElementSibling);if(s){var o=s.parentNode;o&&/^(H[1-6]|P)$/.test(o.nodeName)&&(i.placeMarkers(),n.insertAfter(s,o),i.selectMarkers(),o.childNodes.length===2&&n.isEmptyTextNode(o.firstChild)&&n.removeNode(o),o.childNodes.length===0&&n.removeNode(o))}var u=Array.prototype.slice.call(s.childNodes);u.forEach(function(e){var n=Array.prototype.slice.call(e.childNodes);n.forEach(function(n){if(n.nodeName==="SPAN"){var r=n;t.unwrap(e,r)}else n.nodeType===Node.ELEMENT_NODE&&(n.style.lineHeight=null,n.getAttribute("style")===""&&n.removeAttribute("style"))})})}}.bind(this))},e.commandPatches.insertOrderedList=new r("insertOrderedList"),e.commandPatches.insertUnorderedList=new r("insertUnorderedList")}}}),define("plugins/core/patches/commands/outdent",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("outdent");t.execute=function(){e.transactionManager.run(function(){var t=new e.api.Selection,n=t.range,r=t.getContaining(function(e){return e.nodeName==="BLOCKQUOTE"});if(n.commonAncestorContainer.nodeName==="BLOCKQUOTE"){t.placeMarkers(),t.selectMarkers(!0);var i=n.cloneContents();r.parentNode.insertBefore(i,r),n.deleteContents(),t.selectMarkers(),r.textContent===""&&r.parentNode.removeChild(r)}else{var s=t.getContaining(function(e){return e.nodeName==="P"});if(s){var o=(new e.api.Node(s)).nextAll();if(o.length){var u=document.createElement(r.nodeName);o.forEach(function(e){u.appendChild(e)}),r.parentNode.insertBefore(u,r.nextElementSibling)}t.placeMarkers(),r.parentNode.insertBefore(s,r.nextElementSibling),t.selectMarkers(),r.innerHTML===""&&r.parentNode.removeChild(r)}else e.api.CommandPatch.prototype.execute.call(this)}}.bind(this))},e.commandPatches.outdent=t}}}),define("plugins/core/patches/commands/create-link",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("createLink");e.commandPatches.createLink=t,t.execute=function(t){var n=new e.api.Selection;if(n.selection.isCollapsed){var r=document.createElement("a");r.setAttribute("href",t),r.textContent=t,n.range.insertNode(r);var i=document.createRange();i.setStartBefore(r),i.setEndAfter(r),n.selection.removeAllRanges(),n.selection.addRange(i)}else e.api.CommandPatch.prototype.execute.call(this,t)}}}}),define("plugins/core/patches/events",[],function(){return function(){return function(e){var t=e.element;e.allowsBlockElements()&&e.el.addEventListener("keyup",function(n){if(n.keyCode===8||n.keyCode===46){var r=new e.api.Selection,i=r.getContaining(function(e){return e.nodeName==="P"});i&&(e.undoManager.undo(),e.transactionManager.run(function(){r.placeMarkers();var e=Array.prototype.slice.call(i.childNodes);e.forEach(function(e){if(e.nodeName==="SPAN"){var n=e;t.unwrap(i,n)}else e.nodeType===Node.ELEMENT_NODE&&(e.style.lineHeight=null,e.getAttribute("style")===""&&e.removeAttribute("style"))}),r.selectMarkers()}))}})}}}),define("plugins/core/patches",["./patches/commands/bold","./patches/commands/indent","./patches/commands/insert-html","./patches/commands/insert-list","./patches/commands/outdent","./patches/commands/create-link","./patches/events"],function(e,t,n,r,i,s,o){return{commands:{bold:e,indent:t,insertHTML:n,insertList:r,outdent:i,createLink:s},events:o}}),define("plugins/core/set-root-p-element",[],function(){return function(){return function(e){e.getHTML().trim()===""&&e.setContent("<p><br></p>")}}}),define("api/command-patch",[],function(){return function(e){function t(e){this.commandName=e}return t.prototype.execute=function(t){e.transactionManager.run(function(){document.execCommand(this.commandName,!1,t||null)}.bind(this))},t.prototype.queryState=function(){return document.queryCommandState(this.commandName)},t.prototype.queryEnabled=function(){return document.queryCommandEnabled(this.commandName)},t}}),define("api/command",[],function(){return function(e){function t(t){this.commandName=t,this.patch=e.commandPatches[this.commandName]}return t.prototype.execute=function(t){this.patch?this.patch.execute(t):e.transactionManager.run(function(){document.execCommand(this.commandName,!1,t||null)}.bind(this))},t.prototype.queryState=function(){return this.patch?this.patch.queryState():document.queryCommandState(this.commandName)},t.prototype.queryEnabled=function(){return this.patch?this.patch.queryEnabled():document.queryCommandEnabled(this.commandName)},t}}),define("api/node",[],function(){function e(e){this.node=e}return e.prototype.getAncestor=function(e){var t=function(e){return e&&e.attributes&&e.attributes.getNamedItem("contenteditable")};if(t(this.node))return;var n=this.node.parentNode;while(n&&!t(n)){if(e(n))return n;n=n.parentNode}},e.prototype.nextAll=function(){var e=[],t=this.node.nextSibling;while(t)e.push(t),t=t.nextSibling;return e},e}),define("api/selection",["../element"],function(e){return function(e){function t(){this.selection=window.getSelection(),this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}return t.prototype.getContaining=function(t){var n=this.range;if(!n)return;var r=new e.api.Node(this.range.commonAncestorContainer),i=r.node&&r.node.attributes&&r.node.attributes.getNamedItem("contenteditable");return!i&&t(r.node)?r.node:r.getAncestor(t)},t.prototype.placeMarkers=function(){var e=this.range;if(!e)return;var t=document.createElement("em");t.classList.add("scribe-marker");var n=document.createElement("em");n.classList.add("scribe-marker");var r=this.range.cloneRange();r.collapse(!1),r.insertNode(n),n.nextSibling&&n.nextSibling.nodeType===Node.TEXT_NODE&&n.nextSibling.data===""&&n.parentNode.removeChild(n.nextSibling),n.previousSibling&&n.previousSibling.nodeType===Node.TEXT_NODE&&n.previousSibling.data===""&&n.parentNode.removeChild(n.previousSibling);if(!this.selection.isCollapsed){var i=this.range.cloneRange();i.collapse(!0),i.insertNode(t),t.nextSibling&&t.nextSibling.nodeType===Node.TEXT_NODE&&t.nextSibling.data===""&&t.parentNode.removeChild(t.nextSibling),t.previousSibling&&t.previousSibling.nodeType===Node.TEXT_NODE&&t.previousSibling.data===""&&t.parentNode.removeChild(t.previousSibling)}this.selection.removeAllRanges(),this.selection.addRange(this.range)},t.prototype.getMarkers=function(){return e.el.querySelectorAll("em.scribe-marker")},t.prototype.removeMarkers=function(){var e=this.getMarkers();Array.prototype.forEach.call(e,function(e){e.parentNode.removeChild(e)})},t.prototype.selectMarkers=function(e){var t=this.getMarkers();if(!t.length)return;var n=document.createRange();n.setStartBefore(t[0]),t.length>=2?n.setEndAfter(t[1]):n.setEndAfter(t[0]),e||this.removeMarkers(),this.selection.removeAllRanges(),this.selection.addRange(n)},t.prototype.isCaretOnNewLine=function(){function e(e){var t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),n=t.root;while(n){var r=n.childNodes.length;if(r>1||r===1&&n.textContent.trim()!=="")return!1;if(r===0)return n.textContent.trim()==="";n=t.nextNode()}}var t=this.getContaining(function(e){return e.nodeName==="P"});return t?e(t):!1},t}}),define("api/simple-command",[],function(){return function(e,t){function n(e,n){t.api.Command.call(this,e),this.nodeName=n}return n.prototype=Object.create(e.Command.prototype),n.prototype.constructor=n,n.prototype.queryState=function(){var e=new t.api.Selection;return t.api.Command.prototype.queryState.call(this)&&!!e.getContaining(function(e){return e.nodeName===this.nodeName}.bind(this))},n}}),define("api",["./api/command-patch","./api/command","./api/node","./api/selection","./api/simple-command"],function(e,t,n,r,i){return function(o){this.CommandPatch=e(o),this.Command=t(o),this.Node=n,this.Selection=r(o),this.SimpleCommand=i(this,o)}}),define("lodash-amd/modern/objects/assign",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(e,t,n){var r=function(r,i,s){var o,u=r,a=u;if(!u)return a;var f=arguments,l=0,c=typeof s=="number"?2:f.length;if(c>3&&typeof f[c-2]=="function")var h=e(f[--c-1],f[c--],2);else c>2&&typeof f[c-1]=="function"&&(h=f[--c]);while(++l<c){u=f[l];if(u&&n[typeof u]){var p=-1,d=n[typeof u]&&t(u),v=d?d.length:0;while(++p<v)o=d[p],a[o]=h?h(a[o],u[o]):u[o]}}return a};return r}),define("transaction-manager",["lodash-amd/modern/objects/assign"],function(e){return function(t){function n(){this.history=[]}return e(n.prototype,{start:function(){this.history.push(1)},end:function(){this.history.pop(),this.history.length===0&&(t.pushHistory(),t.trigger("content-changed"))},run:function(e){this.start();try{e&&e()}finally{this.end()}}}),n}}),define("undo-manager",[],function(){return function(e){function t(){this.position=-1,this.stack=[],this.debug=e.isDebugModeEnabled()}return t.prototype.maxStackSize=100,t.prototype.push=function(e){this.debug&&console.log("UndoManager.push: %s",e),this.stack.length=++this.position,this.stack.push(e);while(this.stack.length>this.maxStackSize)this.stack.shift(),--this.position},t.prototype.undo=function(){if(this.position>0)return this.stack[--this.position]},t.prototype.redo=function(){if(this.position<this.stack.length-1)return this.stack[++this.position]},t}}),define("lodash-amd/modern/arrays/pull",[],function(){function n(e){var n=arguments,r=0,i=n.length,s=e?e.length:0;while(++r<i){var o=-1,u=n[r];while(++o<s)e[o]===u&&(t.call(e,o--,1),s--)}return e}var e=[],t=e.splice;return n}),define("event-emitter",["lodash-amd/modern/arrays/pull"],function(e){function t(){this._listeners={}}return t.prototype.on=function(e,t){var n=this._listeners[e]||[];n.push(t),this._listeners[e]=n},t.prototype.off=function(t,n){var r=this._listeners[t]||[];n?e(r,n):delete this._listeners[t]},t.prototype.trigger=function(e,t){var n=this._listeners[e]||[];n.forEach(function(e){e.apply(null,t)})},t}),typeof exports=="object"?module.exports=universalModule():typeof define=="function"&&define.amd?define("immutable/dist/immutable",universalModule):Immutable=universalModule(),define("scribe",["lodash-amd/modern/objects/defaults","./plugins/core/commands","./plugins/core/events","./plugins/core/formatters/html/replace-nbsp-chars","./plugins/core/formatters/html/enforce-p-elements","./plugins/core/formatters/html/ensure-selectable-containers","./plugins/core/formatters/plain-text/escape-html-characters","./plugins/core/inline-elements-mode","./plugins/core/patches","./plugins/core/set-root-p-element","./api","./transaction-manager","./undo-manager","./event-emitter","./element","./node","immutable/dist/immutable"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){function g(g,w){p.call(this),this.el=g,this.commands={},this.options=e(w||{},{allowBlockElements:!0,debug:!1}),this.commandPatches={},this._plainTextFormatterFactory=new y,this._htmlFormatterFactory=new b,this.api=new l(this),this.node=v,this.element=d,this.Immutable=m;var E=c(this);this.transactionManager=new E;var S=h(this);this.undoManager=new S,this.el.setAttribute("contenteditable",!0),this.el.addEventListener("input",function(){this.transactionManager.run()}.bind(this),!1),this.allowsBlockElements()?(this.use(f()),this.use(i()),this.use(s())):this.use(u()),this.use(o()),this.use(r());var x=[a.commands.bold,a.commands.indent,a.commands.insertHTML,a.commands.insertList,a.commands.outdent,a.commands.createLink,a.events],T=[t.indent,t.insertList,t.outdent,t.redo,t.subscript,t.superscript,t.undo],N=[].concat(x,T);N.forEach(function(e){this.use(e())}.bind(this)),this.use(n())}function y(){this.formatters=m.List()}function b(){this.formatters={sanitize:m.List(),normalize:m.List(),"export":m.List()}}return g.prototype=Object.create(p.prototype),g.prototype.use=function(e){return e(this),this},g.prototype.setHTML=function(e,t){t&&(this._skipFormatters=!0),this.el.innerHTML=e},g.prototype.getHTML=function(){return this.el.innerHTML},g.prototype.getContent=function(){return this._htmlFormatterFactory.formatForExport(this.getHTML().replace(/<br>$/,""))},g.prototype.getTextContent=function(){return this.el.textContent},g.prototype.pushHistory=function(){var e=this.undoManager.stack[this.undoManager.position],t=e&&e.replace(/<em class="scribe-marker">/g,"").replace(/<\/em>/g,"");if(!e||e&&this.getHTML()!==t){var n=new this.api.Selection;n.placeMarkers();var r=this.getHTML();return n.removeMarkers(),this.undoManager.push(r),!0}return!1},g.prototype.getCommand=function(e){return this.commands[e]||this.commandPatches[e]||new this.api.Command(e)},g.prototype.restoreFromHistory=function(e){this.setHTML(e,!0);var t=new this.api.Selection;t.selectMarkers(),this.trigger("content-changed")},g.prototype.allowsBlockElements=function(){return this.options.allowBlockElements},g.prototype.setContent=function(e){this.allowsBlockElements()||(e+="<br>"),this.setHTML(e),this.trigger("content-changed")},g.prototype.insertPlainText=function(e){this.insertHTML("<p>"+this._plainTextFormatterFactory.format(e)+"</p>")},g.prototype.insertHTML=function(e){this.getCommand("insertHTML").execute(this._htmlFormatterFactory.format(e))},g.prototype.isDebugModeEnabled=function(){return this.options.debug},g.prototype.registerHTMLFormatter=function(e,t){this._htmlFormatterFactory.formatters[e]=this._htmlFormatterFactory.formatters[e].push(t)},g.prototype.registerPlainTextFormatter=function(e){this._plainTextFormatterFactory.formatters=this._plainTextFormatterFactory.formatters.push(e)},y.prototype.format=function(e){var t=this.formatters.reduce(function(e,t){return t(e)},e);return t},b.prototype=Object.create(y.prototype),b.prototype.constructor=b,b.prototype.format=function(e){var t=this.formatters.sanitize.concat(this.formatters.normalize),n=t.reduce(function(e,t){return t(e)},e);return n},b.prototype.formatForExport=function(e){return this.formatters["export"].reduce(function(e,t){return t(e)},e)},g});
/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.slice(0,v.length-1).concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){}),define("plugins/core/set-root-p-element",[],function(){return function(){return function(e){""===e.getHTML().trim()&&e.setContent("<p><br></p>")}}}),define("lodash-amd/modern/internals/isNative",[],function(){function e(e){return"function"==typeof e&&r.test(e)}var t=Object.prototype,n=t.toString,r=RegExp("^"+String(n).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return e}),define("lodash-amd/modern/internals/objectTypes",[],function(){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1};return e}),define("lodash-amd/modern/objects/isObject",["../internals/objectTypes"],function(e){function t(t){return!!t&&!!e[typeof t]}return t}),define("lodash-amd/modern/utilities/noop",[],function(){function e(){}return e}),define("lodash-amd/modern/internals/baseCreate",["./isNative","../objects/isObject","../utilities/noop"],function(e,t){function n(e){return t(e)?r(e):{}}var r=e(r=Object.create)&&r;return r||(n=function(){function e(){}return function(n){if(t(n)){e.prototype=n;var r=new e;e.prototype=null}return r||window.Object()}}()),n}),define("lodash-amd/modern/internals/setBindData",["./isNative","../utilities/noop"],function(e,t){var n={configurable:!1,enumerable:!1,value:null,writable:!1},r=function(){try{var t={},n=e(n=Object.defineProperty)&&n,r=n(t,t,t)&&n}catch(i){}return r}(),i=r?function(e,t){n.value=t,r(e,"__bindData__",n)}:t;return i}),define("lodash-amd/modern/internals/slice",[],function(){function e(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,i=n-t||0,s=Array(0>i?0:i);++r<i;)s[r]=e[t+r];return s}return e}),define("lodash-amd/modern/internals/baseBind",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(e,t,n,r){function i(i){function s(){if(f){var n=r(f);o.apply(n,arguments)}if(this instanceof s){var i=e(u.prototype),h=u.apply(i,n||arguments);return t(h)?h:i}return u.apply(l,n||arguments)}var u=i[0],f=i[2],l=i[4];return n(s,i),s}var s=[],o=s.push;return i}),define("lodash-amd/modern/internals/baseCreateWrapper",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(e,t,n,r){function i(s){function u(){var n=v?p:this;if(c){var s=r(c);o.apply(s,arguments)}if((h||g)&&(s||(s=r(arguments)),h&&o.apply(s,h),g&&s.length<d))return l|=16,i([f,y?l:-4&l,s,null,p,d]);if(s||(s=arguments),m&&(f=n[b]),this instanceof u){n=e(f.prototype);var w=f.apply(n,s);return t(w)?w:n}return f.apply(n,s)}var f=s[0],l=s[1],c=s[2],h=s[3],p=s[4],d=s[5],v=1&l,m=2&l,g=4&l,y=8&l,b=f;return n(u,s),u}var s=[],o=s.push;return i}),define("lodash-amd/modern/objects/isFunction",[],function(){function e(e){return"function"==typeof e}return e}),define("lodash-amd/modern/internals/createWrapper",["./baseBind","./baseCreateWrapper","../objects/isFunction","./slice"],function(e,t,n,r){function i(s,f,l,c,h,p){var d=1&f,v=2&f,m=4&f,g=16&f,y=32&f;if(!v&&!n(s))throw new TypeError;g&&!l.length&&(f&=-17,g=l=!1),y&&!c.length&&(f&=-33,y=c=!1);var b=s&&s.__bindData__;if(b&&b!==!0)return b=r(b),b[2]&&(b[2]=r(b[2])),b[3]&&(b[3]=r(b[3])),!d||1&b[1]||(b[4]=h),!d&&1&b[1]&&(f|=8),!m||4&b[1]||(b[5]=p),g&&o.apply(b[2]||(b[2]=[]),l),y&&u.apply(b[3]||(b[3]=[]),c),b[1]|=f,i.apply(null,b);var w=1==f||17===f?e:t;return w([s,f,l,c,h,p])}var s=[],o=s.push,u=s.unshift;return i}),define("lodash-amd/modern/functions/bind",["../internals/createWrapper","../internals/slice"],function(e,t){function n(n,r){return arguments.length>2?e(n,17,t(arguments,2),null,r):e(n,1,null,null,r)}return n}),define("lodash-amd/modern/utilities/identity",[],function(){function e(e){return e}return e}),define("lodash-amd/modern/support",["./internals/isNative"],function(e){var t=/\bthis\b/,n={};return n.funcDecomp=!e(window.WinRTError)&&t.test(function(){return this}),n.funcNames="string"==typeof Function.name,n}),define("lodash-amd/modern/internals/baseCreateCallback",["../functions/bind","../utilities/identity","./setBindData","../support"],function(e,t,n,r){function i(i,f,l){if("function"!=typeof i)return t;if("undefined"!=typeof f&&"prototype"in i){var c=i.__bindData__;if("undefined"==typeof c&&(r.funcNames&&(c=!i.name),c=c||!r.funcDecomp,!c)){var h=u.call(i);r.funcNames||(c=!s.test(h)),c||(c=o.test(h),n(i,c))}if(c===!1||c!==!0&&1&c[1])return i;switch(l){case 1:return function(e){return i.call(f,e)};case 2:return function(e,t){return i.call(f,e,t)};case 3:return function(e,t,n){return i.call(f,e,t,n)};case 4:return function(e,t,n,r){return i.call(f,e,t,n,r)}}return e(i,f)}return i}var s=/^\s*function[ \n\r\t]+\w/,o=/\bthis\b/,u=Function.prototype.toString;return i}),define("lodash-amd/modern/objects/forIn",["../internals/baseCreateCallback","../internals/objectTypes"],function(e,t){var n=function(n,r,i){var s,o=n,u=o;if(!o)return u;if(!t[typeof o])return u;r=r&&"undefined"==typeof i?r:e(r,i,3);for(s in o)if(r(o[s],s,n)===!1)return u;return u};return n}),define("lodash-amd/modern/internals/arrayPool",[],function(){var e=[];return e}),define("lodash-amd/modern/internals/getArray",["./arrayPool"],function(e){function t(){return e.pop()||[]}return t}),define("lodash-amd/modern/internals/maxPoolSize",[],function(){var e=40;return e}),define("lodash-amd/modern/internals/releaseArray",["./arrayPool","./maxPoolSize"],function(e,t){function n(n){n.length=0,e.length<t&&e.push(n)}return n}),define("lodash-amd/modern/internals/baseIsEqual",["../objects/forIn","./getArray","../objects/isFunction","./objectTypes","./releaseArray"],function(e,t,n,r,i){function s(d,g,y,b,w,E){if(y){var S=y(d,g);if("undefined"!=typeof S)return!!S}if(d===g)return 0!==d||1/d==1/g;var x=typeof d,T=typeof g;if(!(d!==d||d&&r[x]||g&&r[T]))return!1;if(null==d||null==g)return d===g;var N=v.call(d),C=v.call(g);if(N==o&&(N=c),C==o&&(C=c),N!=C)return!1;switch(N){case a:case f:return+d==+g;case l:return d!=+d?g!=+g:0==d?1/d==1/g:d==+g;case h:case p:return d==String(g)}var k=N==u;if(!k){var L=m.call(d,"__wrapped__"),A=m.call(g,"__wrapped__");if(L||A)return s(L?d.__wrapped__:d,A?g.__wrapped__:g,y,b,w,E);if(N!=c)return!1;var O=d.constructor,M=g.constructor;if(O!=M&&!(n(O)&&O instanceof O&&n(M)&&M instanceof M)&&"constructor"in d&&"constructor"in g)return!1}var D=!w;w||(w=t()),E||(E=t());for(var P=w.length;P--;)if(w[P]==d)return E[P]==g;var H=0;if(S=!0,w.push(d),E.push(g),k){if(P=d.length,H=g.length,S=H==P,S||b)for(;H--;){var B=P,j=g[H];if(b)for(;B--&&!(S=s(d[B],j,y,b,w,E)););else if(!(S=s(d[H],j,y,b,w,E)))break}}else e(g,function(e,t,n){return m.call(n,t)?(H++,S=m.call(d,t)&&s(d[t],e,y,b,w,E)):void 0}),S&&!b&&e(d,function(e,t,n){return m.call(n,t)?S=--H>-1:void 0});return w.pop(),E.pop(),D&&(i(w),i(E)),S}var o="[object Arguments]",u="[object Array]",a="[object Boolean]",f="[object Date]",l="[object Number]",c="[object Object]",h="[object RegExp]",p="[object String]",d=Object.prototype,v=d.toString,m=d.hasOwnProperty;return s}),define("lodash-amd/modern/internals/shimKeys",["./objectTypes"],function(e){var t=Object.prototype,n=t.hasOwnProperty,r=function(t){var r,i=t,s=[];if(!i)return s;if(!e[typeof t])return s;for(r in i)n.call(i,r)&&s.push(r);return s};return r}),define("lodash-amd/modern/objects/keys",["../internals/isNative","./isObject","../internals/shimKeys"],function(e,t,n){var r=e(r=Object.keys)&&r,i=r?function(e){return t(e)?r(e):[]}:n;return i}),define("lodash-amd/modern/utilities/property",[],function(){function e(e){return function(n){return n[e]}}return e}),define("lodash-amd/modern/functions/createCallback",["../internals/baseCreateCallback","../internals/baseIsEqual","../objects/isObject","../objects/keys","../utilities/property"],function(e,t,n,r,i){function s(s,o,u){var a=typeof s;if(null==s||"function"==a)return e(s,o,u);if("object"!=a)return i(s);var f=r(s),l=f[0],c=s[l];return 1!=f.length||c!==c||n(c)?function(e){for(var n=f.length,r=!1;n--&&(r=t(e[f[n]],s[f[n]],null,!0)););return r}:function(e){var t=e[l];return c===t&&(0!==c||1/c==1/t)}}return s}),define("lodash-amd/modern/arrays/last",["../functions/createCallback","../internals/slice"],function(e,t){function n(n,s,o){var u=0,a=n?n.length:0;if("number"!=typeof s&&null!=s){var f=a;for(s=e(s,o,3);f--&&s(n[f],f,n);)u++}else if(u=s,null==u||o)return n?n[a-1]:r;return t(n,i(0,a-u))}var r,i=Math.max;return n}),define("plugins/core/formatters/html/enforce-p-elements",["lodash-amd/modern/arrays/last"],function(e){function t(t,n){var r=Array.prototype.reduce.call(n.childNodes,function(n,r){function i(){var e=[r];n.push(e)}var s=e(n);if(s){var o=t.element.isBlockElement(s[0]);o===t.element.isBlockElement(r)?s.push(r):i()}else i();return n},[]),i=r.filter(function(e){var n=t.element.isBlockElement(e[0]);return!n});i.forEach(function(e){var t=document.createElement("p");e[0].parentNode.insertBefore(t,e[0]),e.forEach(function(e){t.appendChild(e)})}),n._isWrapped=!0}function n(e,r){for(var i=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,null,!1),s=i.firstChild();s;){if("BLOCKQUOTE"===s.nodeName&&!s._isWrapped){t(e,s),n(e,r);break}s=i.nextSibling()}}return function(){return function(e){e.registerHTMLFormatter("normalize",function(r){var i=document.createElement("div");return i.innerHTML=r,t(e,i),n(e,i),i.innerHTML})}}}),define("lodash-amd/modern/internals/baseIndexOf",[],function(){function e(e,t,n){for(var r=(n||0)-1,i=e?e.length:0;++r<i;)if(e[r]===t)return r;return-1}return e}),define("lodash-amd/modern/objects/forOwn",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(e,t,n){var r=function(r,i,s){var o,u=r,a=u;if(!u)return a;if(!n[typeof u])return a;i=i&&"undefined"==typeof s?i:e(i,s,3);for(var f=-1,l=n[typeof u]&&t(u),c=l?l.length:0;++f<c;)if(o=l[f],i(u[o],o,r)===!1)return a;return a};return r}),define("lodash-amd/modern/objects/isArray",["../internals/isNative"],function(e){var t="[object Array]",n=Object.prototype,r=n.toString,i=e(i=Array.isArray)&&i,s=i||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&r.call(e)==t||!1};return s}),define("lodash-amd/modern/objects/isString",[],function(){function e(e){return"string"==typeof e||e&&"object"==typeof e&&r.call(e)==t||!1}var t="[object String]",n=Object.prototype,r=n.toString;return e}),define("lodash-amd/modern/collections/contains",["../internals/baseIndexOf","../objects/forOwn","../objects/isArray","../objects/isString"],function(e,t,n,r){function i(i,u,a){var f=-1,l=e,c=i?i.length:0,h=!1;return a=(0>a?s(0,c+a):a)||0,n(i)?h=l(i,u,a)>-1:"number"==typeof c?h=(r(i)?i.indexOf(u,a):l(i,u,a))>-1:t(i,function(e){return++f>=a?!(h=e===u):void 0}),h}var s=Math.max;return i}),define("element",["lodash-amd/modern/collections/contains"],function(e){function t(t){return e(s,t.nodeName)}function n(e){return e.nodeType===Node.ELEMENT_NODE&&"scribe-marker"===e.className}function r(e){return e.nodeType===Node.ELEMENT_NODE&&"caret-position"===e.className}function i(e,t){for(;t.childNodes.length>0;)e.insertBefore(t.childNodes[0],t);e.removeChild(t)}var s=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","CANVAS","DD","DIV","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TD","TH","TFOOT","UL","VIDEO"];return{isBlockElement:t,isSelectionMarkerNode:n,isCaretPositionNode:r,unwrap:i}}),define("plugins/core/formatters/html/ensure-selectable-containers",["../../../../element","lodash-amd/modern/collections/contains"],function(e,t){function n(e,t){return e.isCaretPositionNode(t)?!0:""===t.parentNode.textContent.trim()}function r(e,s){function o(t){return 0===t.children.length&&e.isBlockElement(t)||1===t.children.length&&e.isSelectionMarkerNode(t.children[0])?!0:e.isBlockElement(t)||0!==t.children.length?!1:n(e,t)}for(var u=s.firstElementChild;u;)e.isSelectionMarkerNode(u)||(o(u)&&""===u.textContent.trim()&&!t(i,u.nodeName)?u.appendChild(document.createElement("br")):u.children.length>0&&r(e,u)),u=u.nextElementSibling}var i=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];return function(){return function(e){e.registerHTMLFormatter("normalize",function(t){var n=document.createElement("div");return n.innerHTML=t,r(e.element,n),n.innerHTML})}}}),define("plugins/core/inline-elements-mode",[],function(){function e(e){for(var t=document.createTreeWalker(e,NodeFilter.SHOW_ALL,null,!1);t.nextNode();)if(t.currentNode&&(~["br"].indexOf(t.currentNode.nodeName.toLowerCase())||t.currentNode.length>0))return!0;return!1}return function(){return function(n){n.el.addEventListener("keydown",function(r){if(13===r.keyCode){var i=new n.api.Selection,s=i.range,o=i.getContaining(function(e){return"LI"===e.nodeName||/^(H[1-6])$/.test(e.nodeName)});o||(r.preventDefault(),n.transactionManager.run(function(){"BR"===n.el.lastChild.nodeName&&n.el.removeChild(n.el.lastChild);var r=document.createElement("br");s.insertNode(r),s.collapse(!1);var o=s.cloneRange();o.setEndAfter(n.el.lastChild,0);var u=o.cloneContents();if(!e(u)){var a=document.createElement("br");s.insertNode(a)}var f=s.cloneRange();f.setStartAfter(r,0),f.setEndAfter(r,0),i.selection.removeAllRanges(),i.selection.addRange(f)}))}}.bind(this)),""===n.getHTML().trim()&&n.setContent("")}}}),define("plugins/core/plugins",["./set-root-p-element","./formatters/html/enforce-p-elements","./formatters/html/ensure-selectable-containers","./inline-elements-mode"],function(e,t,n,r){return{setRootPElement:e,enforcePElements:t,ensureSelectableContainers:n,inlineElementsMode:r}}),define("plugins/core/commands/indent",[],function(){return function(){return function(e){var t=new e.api.Command("indent");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!n},e.commands.indent=t}}}),define("plugins/core/commands/insert-list",[],function(){return function(){return function(e){var t=function(t){e.api.Command.call(this,t)};t.prototype=Object.create(e.api.Command.prototype),t.prototype.constructor=t,t.prototype.execute=function(t){function n(e){if(e.length>0){var t=document.createElement(s.nodeName);e.forEach(function(e){t.appendChild(e)}),s.parentNode.insertBefore(t,s.nextElementSibling)}}if(this.queryState()){var r=new e.api.Selection,i=r.range,s=r.getContaining(function(e){return"OL"===e.nodeName||"UL"===e.nodeName}),o=r.getContaining(function(e){return"LI"===e.nodeName});e.transactionManager.run(function(){if(o){var t=(new e.api.Node(o)).nextAll();n(t),r.placeMarkers();var u=document.createElement("p");u.innerHTML=o.innerHTML,s.parentNode.insertBefore(u,s.nextElementSibling),o.parentNode.removeChild(o)}else{var f=Array.prototype.map.call(s.querySelectorAll("li"),function(e){return i.intersectsNode(e)&&e}).filter(function(e){return e}),l=f.slice(-1)[0],c=(new e.api.Node(l)).nextAll();n(c),r.placeMarkers();var h=document.createDocumentFragment();f.forEach(function(e){var t=document.createElement("p");t.innerHTML=e.innerHTML,h.appendChild(t)}),s.parentNode.insertBefore(h,s.nextElementSibling),f.forEach(function(e){e.parentNode.removeChild(e)})}0===s.childNodes.length&&s.parentNode.removeChild(s),r.selectMarkers()}.bind(this))}else e.api.Command.prototype.execute.call(this,t)},t.prototype.queryEnabled=function(){return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()},e.commands.insertOrderedList=new t("insertOrderedList"),e.commands.insertUnorderedList=new t("insertUnorderedList")}}}),define("plugins/core/commands/outdent",[],function(){return function(){return function(e){var t=new e.api.Command("outdent");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName});return e.api.Command.prototype.queryEnabled.call(this)&&e.allowsBlockElements()&&!n},e.commands.outdent=t}}}),define("plugins/core/commands/redo",[],function(){return function(){return function(e){var t=new e.api.Command("redo");t.execute=function(){e.undoManager.redo()},t.queryEnabled=function(){return e.undoManager.position>0},e.commands.redo=t,e.options.undo.enabled&&e.el.addEventListener("keydown",function(e){e.shiftKey&&(e.metaKey||e.ctrlKey)&&90===e.keyCode&&(e.preventDefault(),t.execute())})}}}),define("plugins/core/commands/subscript",[],function(){return function(){return function(e){var t=new e.api.Command("subscript");e.commands.subscript=t}}}),define("plugins/core/commands/superscript",[],function(){return function(){return function(e){var t=new e.api.Command("superscript");e.commands.superscript=t}}}),define("plugins/core/commands/undo",[],function(){return function(){return function(e){var t=new e.api.Command("undo");t.execute=function(){e.undoManager.undo()},t.queryEnabled=function(){return e.undoManager.position<e.undoManager.length},e.commands.undo=t,e.options.undo.enabled&&e.el.addEventListener("keydown",function(e){e.shiftKey||!e.metaKey&&!e.ctrlKey||90!==e.keyCode||(e.preventDefault(),t.execute())})}}}),define("plugins/core/commands",["./commands/indent","./commands/insert-list","./commands/outdent","./commands/redo","./commands/subscript","./commands/superscript","./commands/undo"],function(e,t,n,r,i,s,o){return{indent:e,insertList:t,outdent:n,redo:r,subscript:i,superscript:s,undo:o}}),define("plugins/core/formatters/html/replace-nbsp-chars",[],function(){return function(){return function(e){var t=/(\s|&nbsp;)+/g;e.registerHTMLFormatter("export",function(e){return e.replace(t," ")})}}}),define("lodash-amd/modern/internals/htmlEscapes",[],function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e}),define("lodash-amd/modern/internals/escapeHtmlChar",["./htmlEscapes"],function(e){function t(t){return e[t]}return t}),define("lodash-amd/modern/internals/reUnescapedHtml",["./htmlEscapes","../objects/keys"],function(e,t){var n=RegExp("["+t(e).join("")+"]","g");return n}),define("lodash-amd/modern/utilities/escape",["../internals/escapeHtmlChar","../objects/keys","../internals/reUnescapedHtml"],function(e,t,n){function r(t){return null==t?"":String(t).replace(n,e)}return r}),define("plugins/core/formatters/plain-text/escape-html-characters",["lodash-amd/modern/utilities/escape"],function(e){return function(){return function(n){n.registerPlainTextFormatter(e)}}}),define("plugins/core/formatters",["./formatters/html/replace-nbsp-chars","./formatters/plain-text/escape-html-characters"],function(e,t){return{replaceNbspCharsFormatter:e,escapeHtmlCharactersFormatter:t}}),define("lodash-amd/modern/objects/isArguments",[],function(){function e(e){return e&&"object"==typeof e&&"number"==typeof e.length&&r.call(e)==t||!1}var t="[object Arguments]",n=Object.prototype,r=n.toString;return e}),define("lodash-amd/modern/internals/baseFlatten",["../objects/isArguments","../objects/isArray"],function(e,t){function n(r,i,s,o){for(var u=(o||0)-1,a=r?r.length:0,f=[];++u<a;){var l=r[u];if(l&&"object"==typeof l&&"number"==typeof l.length&&(t(l)||e(l))){i||(l=n(l,i,s));var c=-1,h=l.length,p=f.length;for(f.length+=h;++c<h;)f[p++]=l[c]}else s||f.push(l)}return f}return n}),define("lodash-amd/modern/collections/map",["../functions/createCallback","../objects/forOwn"],function(e,t){function n(n,r,i){var s=-1,o=n?n.length:0;if(r=e(r,i,3),"number"==typeof o)for(var u=Array(o);++s<o;)u[s]=r(n[s],s,n);else u=[],t(n,function(e,t,n){u[++s]=r(e,t,n)});return u}return n}),define("lodash-amd/modern/arrays/flatten",["../internals/baseFlatten","../collections/map"],function(e,t){function n(n,r,i,s){return"boolean"!=typeof r&&null!=r&&(s=i,i="function"!=typeof r&&s&&s[r]===n?null:r,r=!1),null!=i&&(n=t(n,i,s)),e(n,r)}return n}),define("lodash-amd/modern/objects/values",["./keys"],function(e){function t(t){for(var n=-1,r=e(t),i=r.length,s=Array(i);++n<i;)s[n]=t[r[n]];return s}return t}),define("lodash-amd/modern/collections/toArray",["../objects/isString","../internals/slice","../objects/values"],function(e,t,n){function r(e){return e&&"number"==typeof e.length?t(e):n(e)}return r}),define("node",[],function(){function e(e){return e.nodeType===Node.TEXT_NODE&&""===e.textContent}function t(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}function n(e){return e.parentNode.removeChild(e)}return{isEmptyTextNode:e,insertAfter:t,removeNode:n}}),define("dom-observer",["lodash-amd/modern/arrays/flatten","lodash-amd/modern/collections/toArray","./element","./node"],function(e,t,n,r){function i(i,s){function o(i){var s=e(i.map(function(e){var n=t(e.addedNodes),r=t(e.removedNodes);return n.concat(r)})),o=s.filter(function(e){return!r.isEmptyTextNode(e)}).filter(function(e){return!n.isSelectionMarkerNode(e)});return o.length>0}var u=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,a=!1,f=new u(function(e){if(!a&&o(e)){a=!0;try{s()}catch(t){throw t}finally{setTimeout(function(){a=!1},0)}}});return f.observe(i,{attributes:!0,childList:!0,subtree:!0}),f}return i}),define("plugins/core/events",["lodash-amd/modern/collections/contains","../../dom-observer"],function(e,t){return function(){return function(n){n.el.addEventListener("focus",function(){function e(t){var n=document.createTreeWalker(t,NodeFilter.SHOW_ALL,null,!1),r=n.currentNode;return n.firstChild()?"BR"===n.currentNode.nodeName?r:e(n.currentNode):n.currentNode}var t=new n.api.Selection;if(t.range){var r=n.allowsBlockElements()&&t.range.startContainer===n.el;if(r){var i=e(n.el.firstChild),s=t.range;s.setStart(i,0),s.setEnd(i,0),t.selection.removeAllRanges(),t.selection.addRange(s)}}}.bind(n));var r=function(){if(!n._skipFormatters){var e=new n.api.Selection,t=e.range,r=function(){t&&e.placeMarkers(),n.setHTML(n._htmlFormatterFactory.format(n.getHTML())),e.selectMarkers()}.bind(n);n.transactionManager.run(r)}delete n._skipFormatters}.bind(n);t(n.el,r),n.allowsBlockElements()&&n.el.addEventListener("keydown",function(e){if(13===e.keyCode){var t=new n.api.Selection,r=t.range,i=t.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});if(i&&r.collapsed){var s=r.cloneRange();s.setEndAfter(i,0);var o=s.cloneContents();""===o.firstChild.textContent&&(e.preventDefault(),n.transactionManager.run(function(){var e=document.createElement("p"),n=document.createElement("br");e.appendChild(n),i.parentNode.insertBefore(e,i.nextElementSibling),r.setStart(e,0),r.setEnd(e,0),t.selection.removeAllRanges(),t.selection.addRange(r)}))}}}),n.allowsBlockElements()&&n.el.addEventListener("keydown",function(e){if(13===e.keyCode||8===e.keyCode){var t=new n.api.Selection,r=t.range;if(r.collapsed){var i=t.getContaining(function(e){return"LI"===e.nodeName});if(i&&""===i.textContent.trim()){e.preventDefault();var s=t.getContaining(function(e){return"UL"===e.nodeName||"OL"===e.nodeName}),o=n.getCommand("OL"===s.nodeName?"insertOrderedList":"insertUnorderedList");o.execute()}}}}),n.el.addEventListener("paste",function(t){if(t.clipboardData)t.preventDefault(),e(t.clipboardData.types,"text/html")?n.insertHTML(t.clipboardData.getData("text/html")):n.insertPlainText(t.clipboardData.getData("text/plain"));else{var r=new n.api.Selection;r.placeMarkers();var i=document.createElement("div");document.body.appendChild(i),i.setAttribute("contenteditable",!0),i.focus(),setTimeout(function(){var e=i.innerHTML;i.parentNode.removeChild(i),r.selectMarkers(),n.el.focus(),n.insertHTML(e)},1)}})}}}),define("plugins/core/patches/commands/bold",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("bold");t.queryEnabled=function(){var t=new e.api.Selection,n=t.getContaining(function(e){return/^(H[1-6])$/.test(e.nodeName)});return e.api.CommandPatch.prototype.queryEnabled.apply(this,arguments)&&!n},e.commandPatches.bold=t}}}),define("plugins/core/patches/commands/indent",[],function(){var e="ï»¿";return function(){return function(n){var r=new n.api.CommandPatch("indent");r.execute=function(r){n.transactionManager.run(function(){var i=new n.api.Selection,s=i.range,o="P"===s.commonAncestorContainer.nodeName&&"<br>"===s.commonAncestorContainer.innerHTML;if(o){var u=document.createTextNode(e);s.insertNode(u),s.setStart(u,0),s.setEnd(u,0),i.selection.removeAllRanges(),i.selection.addRange(s)}n.api.CommandPatch.prototype.execute.call(this,r),i=new n.api.Selection;var a=i.getContaining(function(e){return"BLOCKQUOTE"===e.nodeName});a&&a.removeAttribute("style")}.bind(this))},n.commandPatches.indent=r}}}),define("plugins/core/patches/commands/insert-html",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("insertHTML"),n=e.element;t.execute=function(t){e.transactionManager.run(function(){function r(e){var t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1),i=t.firstChild();if(i)do"SPAN"===i.nodeName?n.unwrap(e,i):(i.style.lineHeight=null,""===i.getAttribute("style")&&i.removeAttribute("style")),r(i);while(i=t.nextSibling())}e.api.CommandPatch.prototype.execute.call(this,t),r(e.el)}.bind(this))},e.commandPatches.insertHTML=t}}}),define("plugins/core/patches/commands/insert-list",[],function(){return function(){return function(e){var t=e.element,n=e.node,r=function(t){e.api.CommandPatch.call(this,t)};r.prototype=Object.create(e.api.CommandPatch.prototype),r.prototype.constructor=r,r.prototype.execute=function(r){e.transactionManager.run(function(){if(e.api.CommandPatch.prototype.execute.call(this,r),this.queryState()){var i=new e.api.Selection,s=i.getContaining(function(e){return"OL"===e.nodeName||"UL"===e.nodeName});if(s.nextElementSibling&&0===s.nextElementSibling.childNodes.length&&n.removeNode(s.nextElementSibling),s){var o=s.parentNode;o&&/^(H[1-6]|P)$/.test(o.nodeName)&&(i.placeMarkers(),n.insertAfter(s,o),i.selectMarkers(),2===o.childNodes.length&&n.isEmptyTextNode(o.firstChild)&&n.removeNode(o),0===o.childNodes.length&&n.removeNode(o))}var u=Array.prototype.slice.call(s.childNodes);u.forEach(function(e){var n=Array.prototype.slice.call(e.childNodes);n.forEach(function(n){if("SPAN"===n.nodeName){var r=n;t.unwrap(e,r)}else n.nodeType===Node.ELEMENT_NODE&&(n.style.lineHeight=null,""===n.getAttribute("style")&&n.removeAttribute("style"))})})}}.bind(this))},e.commandPatches.insertOrderedList=new r("insertOrderedList"),e.commandPatches.insertUnorderedList=new r("insertUnorderedList")}}}),define("plugins/core/patches/commands/outdent",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("outdent");t.execute=function(){e.transactionManager.run(function(){var t=new e.api.Selection,n=t.range,r=t.getContaining(function(e){return"BLOCKQUOTE"===e.nodeName});if("BLOCKQUOTE"===n.commonAncestorContainer.nodeName){t.placeMarkers(),t.selectMarkers(!0);var i=n.cloneContents();r.parentNode.insertBefore(i,r),n.deleteContents(),t.selectMarkers(),""===r.textContent&&r.parentNode.removeChild(r)}else{var s=t.getContaining(function(e){return"P"===e.nodeName});if(s){var o=(new e.api.Node(s)).nextAll();if(o.length){var u=document.createElement(r.nodeName);o.forEach(function(e){u.appendChild(e)}),r.parentNode.insertBefore(u,r.nextElementSibling)}t.placeMarkers(),r.parentNode.insertBefore(s,r.nextElementSibling),t.selectMarkers(),""===r.innerHTML&&r.parentNode.removeChild(r)}else e.api.CommandPatch.prototype.execute.call(this)}}.bind(this))},e.commandPatches.outdent=t}}}),define("plugins/core/patches/commands/create-link",[],function(){return function(){return function(e){var t=new e.api.CommandPatch("createLink");e.commandPatches.createLink=t,t.execute=function(t){var n=new e.api.Selection;if(n.range.collapsed){var r=document.createElement("a");r.setAttribute("href",t),r.textContent=t,n.range.insertNode(r);var i=document.createRange();i.setStartBefore(r),i.setEndAfter(r),n.selection.removeAllRanges(),n.selection.addRange(i)}else e.api.CommandPatch.prototype.execute.call(this,t)}}}}),define("plugins/core/patches/events",[],function(){return function(){return function(e){var t=e.element;e.allowsBlockElements()&&e.el.addEventListener("keyup",function(n){if(8===n.keyCode||46===n.keyCode){var r=new e.api.Selection,i=r.getContaining(function(e){return"P"===e.nodeName});i&&e.transactionManager.run(function(){r.placeMarkers();var e=Array.prototype.slice.call(i.childNodes);e.forEach(function(e){if("SPAN"===e.nodeName){var n=e;t.unwrap(i,n)}else e.nodeType===Node.ELEMENT_NODE&&(e.style.lineHeight=null,""===e.getAttribute("style")&&e.removeAttribute("style"))}),r.selectMarkers()},!0)}})}}}),define("plugins/core/patches",["./patches/commands/bold","./patches/commands/indent","./patches/commands/insert-html","./patches/commands/insert-list","./patches/commands/outdent","./patches/commands/create-link","./patches/events"],function(e,t,n,r,i,s,o){return{commands:{bold:e,indent:t,insertHTML:n,insertList:r,outdent:i,createLink:s},events:o}}),define("api/command-patch",[],function(){return function(e){function t(e){this.commandName=e}return t.prototype.execute=function(t){e.transactionManager.run(function(){document.execCommand(this.commandName,!1,t||null)}.bind(this))},t.prototype.queryState=function(){return document.queryCommandState(this.commandName)},t.prototype.queryEnabled=function(){return document.queryCommandEnabled(this.commandName)},t}}),define("api/command",[],function(){return function(e){function t(t){this.commandName=t,this.patch=e.commandPatches[this.commandName]}return t.prototype.execute=function(t){this.patch?this.patch.execute(t):e.transactionManager.run(function(){document.execCommand(this.commandName,!1,t||null)}.bind(this))},t.prototype.queryState=function(){return this.patch?this.patch.queryState():document.queryCommandState(this.commandName)},t.prototype.queryEnabled=function(){return this.patch?this.patch.queryEnabled():document.queryCommandEnabled(this.commandName)},t}}),define("api/node",[],function(){function e(e){this.node=e}return e.prototype.getAncestor=function(e,t){var n=function(t){return e===t};if(!n(this.node))for(var r=this.node.parentNode;r&&!n(r);){if(t(r))return r;r=r.parentNode}},e.prototype.nextAll=function(){for(var e=[],t=this.node.nextSibling;t;)e.push(t),t=t.nextSibling;return e},e}),define("api/selection",["../element"],function(){return function(e){function t(){for(var t=document,n=e.el.parentNode;n&&n.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&n.nodeType!==Node.DOCUMENT_NODE;)n=n.parentNode;if(n&&n.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&n.getSelection&&(t=n),this.selection=t.getSelection(),this.selection.rangeCount&&this.selection.anchorNode){this.range=document.createRange();var r=document.createRange();this.range.setStart(this.selection.anchorNode,this.selection.anchorOffset),r.setStart(this.selection.focusNode,this.selection.focusOffset),this.range.compareBoundaryPoints(Range.START_TO_START,r)<=0?this.range.setEnd(this.selection.focusNode,this.selection.focusOffset):(this.range=r,this.range.setEnd(this.selection.anchorNode,this.selection.anchorOffset))}}return t.prototype.getContaining=function(t){var n=this.range;if(n){var r=new e.api.Node(this.range.commonAncestorContainer),i=r.node&&e.el===r.node;return!i&&t(r.node)?r.node:r.getAncestor(e.el,t)}},t.prototype.placeMarkers=function(){var t=this.range;if(t&&e.el.offsetParent){var n=document.createRange();n.selectNodeContents(e.el);var r=this.range.compareBoundaryPoints(Range.START_TO_START,n)>=0,i=this.range.compareBoundaryPoints(Range.END_TO_END,n)<=0;if(r&&i){var s=document.createElement("em");s.classList.add("scribe-marker");var o=document.createElement("em");o.classList.add("scribe-marker");var u=this.range.cloneRange();if(u.collapse(!1),u.insertNode(o),o.nextSibling&&o.nextSibling.nodeType===Node.TEXT_NODE&&""===o.nextSibling.data&&o.parentNode.removeChild(o.nextSibling),o.previousSibling&&o.previousSibling.nodeType===Node.TEXT_NODE&&""===o.previousSibling.data&&o.parentNode.removeChild(o.previousSibling),!this.range.collapsed){var a=this.range.cloneRange();a.collapse(!0),a.insertNode(s),s.nextSibling&&s.nextSibling.nodeType===Node.TEXT_NODE&&""===s.nextSibling.data&&s.parentNode.removeChild(s.nextSibling),s.previousSibling&&s.previousSibling.nodeType===Node.TEXT_NODE&&""===s.previousSibling.data&&s.parentNode.removeChild(s.previousSibling)}this.selection.removeAllRanges(),this.selection.addRange(this.range)}}},t.prototype.getMarkers=function(){return e.el.querySelectorAll("em.scribe-marker")},t.prototype.removeMarkers=function(){var e=this.getMarkers();Array.prototype.forEach.call(e,function(e){e.parentNode.removeChild(e)})},t.prototype.selectMarkers=function(e){var t=this.getMarkers();if(t.length){var n=document.createRange();n.setStartBefore(t[0]),n.setEndAfter(t.length>=2?t[1]:t[0]),e||this.removeMarkers(),this.selection.removeAllRanges(),this.selection.addRange(n)}},t.prototype.isCaretOnNewLine=function(){function e(e){for(var t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1),n=t.root;n;){var r=n.childNodes.length;if(r>1||1===r&&""!==n.textContent.trim())return!1;if(0===r)return""===n.textContent.trim();n=t.nextNode()}}var t=this.getContaining(function(e){return"P"===e.nodeName});return t?e(t):!1},t}}),define("api/simple-command",[],function(){return function(e,t){function n(e,n){t.api.Command.call(this,e),this._nodeName=n}return n.prototype=Object.create(e.Command.prototype),n.prototype.constructor=n,n.prototype.queryState=function(){var e=new t.api.Selection;return t.api.Command.prototype.queryState.call(this)&&!!e.getContaining(function(e){return e.nodeName===this._nodeName}.bind(this))},n}}),define("api",["./api/command-patch","./api/command","./api/node","./api/selection","./api/simple-command"],function(e,t,n,r,i){return function(s){this.CommandPatch=e(s),this.Command=t(s),this.Node=n,this.Selection=r(s),this.SimpleCommand=i(this,s)}}),define("lodash-amd/modern/objects/assign",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(e,t,n){var r=function(r,i,s){var o,u=r,a=u;if(!u)return a;var f=arguments,l=0,c="number"==typeof s?2:f.length;if(c>3&&"function"==typeof f[c-2])var h=e(f[--c-1],f[c--],2);else c>2&&"function"==typeof f[c-1]&&(h=f[--c]);for(;++l<c;)if(u=f[l],u&&n[typeof u])for(var p=-1,d=n[typeof u]&&t(u),v=d?d.length:0;++p<v;)o=d[p],a[o]=h?h(a[o],u[o]):u[o];return a};return r}),define("transaction-manager",["lodash-amd/modern/objects/assign"],function(e){return function(n){function r(){this.history=[]}return e(r.prototype,{start:function(){this.history.push(1)},end:function(){this.history.pop(),0===this.history.length&&(n.pushHistory(),n.trigger("content-changed"))},run:function(e,t){this.start();try{e&&e()}finally{n._forceMerge=t===!0,this.end(),n._forceMerge=!1}}}),r}}),define("undo-manager",[],function(){function e(e,t){this._stack=[],this._limit=e,this._fireEvent="undefined"!=typeof CustomEvent&&t&&t.dispatchEvent,this._ush=t,this.position=0,this.length=0}return e.prototype.transact=function(e,t){if(arguments.length<2)throw new TypeError("Not enough arguments to UndoManager.transact.");e.execute(),this._stack.splice(0,this.position),t&&this.length?this._stack[0].push(e):this._stack.unshift([e]),this.position=0,this.length=this._limit&&this._stack.length>this._limit?this._stack.length=this._limit:this._stack.length,this._fireEvent&&this._ush.dispatchEvent(new CustomEvent("DOMTransaction",{detail:{transactions:this._stack[0].slice()},bubbles:!0,cancelable:!1}))},e.prototype.undo=function(){if(this.position<this.length){for(var e=this._stack[this.position].length-1;e>=0;e--)this._stack[this.position][e].undo();this.position++,this._fireEvent&&this._ush.dispatchEvent(new CustomEvent("undo",{detail:{transactions:this._stack[this.position-1].slice()},bubbles:!0,cancelable:!1}))}},e.prototype.redo=function(){if(this.position>0){for(var e=0,t=this._stack[this.position-1].length;t>e;e++)this._stack[this.position-1][e].redo();this.position--,this._fireEvent&&this._ush.dispatchEvent(new CustomEvent("redo",{detail:{transactions:this._stack[this.position].slice()},bubbles:!0,cancelable:!1}))}},e.prototype.item=function(e){return e>=0&&e<this.length?this._stack[e].slice():null},e.prototype.clearUndo=function(){this._stack.length=this.length=this.position},e.prototype.clearRedo=function(){this._stack.splice(0,this.position),this.position=0,this.length=this._stack.length},e}),define("lodash-amd/modern/arrays/pull",[],function(){function e(e){for(var t=arguments,r=0,i=t.length,s=e?e.length:0;++r<i;)for(var o=-1,u=t[r];++o<s;)e[o]===u&&(n.call(e,o--,1),s--);return e}var t=[],n=t.splice;return e}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("immutable/dist/immutable",t):e.Immutable=t()}(this,function(){function e(e,t){t&&(e.prototype=Object.create(t.prototype)),e.prototype.constructor=e}function t(e){return e.value=!1,e}function n(e){e&&(e.value=!0)}function r(){}function i(e,t){t=t||0;for(var n=Math.max(0,e.length-t),r=new Array(n),i=0;n>i;i++)r[i]=e[i+t];return r}function s(e){return void 0===e.size&&(e.size=e.__iterate(u)),e.size}function o(e,t){return t>=0?+t:s(e)+ +t}function u(){return!0}function a(e,t,n){return(0===e||void 0!==n&&-n>=e)&&(void 0===t||void 0!==n&&t>=n)}function f(e,t){return c(e,t,0)}function l(e,t){return c(e,t,t)}function c(e,t,n){return void 0===e?n:0>e?Math.max(0,t+e):void 0===t?e:Math.min(t,e)}function h(e){return m(e)?e:A(e)}function p(e){return g(e)?e:O(e)}function d(e){return y(e)?e:M(e)}function v(e){return m(e)&&!b(e)?e:_(e)}function m(e){return!!e&&!!e[pr]}function g(e){return!!e&&!!e[dr]}function y(e){return!!e&&!!e[vr]}function b(e){return g(e)||y(e)}function w(e){return!!e&&!!e[mr]}function E(e){this.next=e}function S(e,t,n,r){var i=0===e?t:1===e?n:[t,n];return r?r.value=i:r={value:i,done:!1},r}function x(){return{value:void 0,done:!0}}function T(e){return!!k(e)}function N(e){return e&&"function"==typeof e.next}function C(e){var t=k(e);return t&&t.call(e)}function k(e){var t=e&&(wr&&e[wr]||e[Er]);return"function"==typeof t?t:void 0}function L(e){return e&&"number"==typeof e.length}function A(e){return null===e||void 0===e?F():m(e)?e.toSeq():R(e)}function O(e){return null===e||void 0===e?F().toKeyedSeq():m(e)?g(e)?e.toSeq():e.fromEntrySeq():I(e)}function M(e){return null===e||void 0===e?F():m(e)?g(e)?e.entrySeq():e.toIndexedSeq():q(e)}function _(e){return(null===e||void 0===e?F():m(e)?g(e)?e.entrySeq():e:q(e)).toSetSeq()}function D(e){this._array=e,this.size=e.length}function P(e){var t=Object.keys(e);this._object=e,this._keys=t,this.size=t.length}function H(e){this._iterable=e,this.size=e.length||e.size}function B(e){this._iterator=e,this._iteratorCache=[]}function j(e){return!!e&&!!e[xr]}function F(){return Tr||(Tr=new D([]))}function I(e){var t=Array.isArray(e)?(new D(e)).fromEntrySeq():N(e)?(new B(e)).fromEntrySeq():T(e)?(new H(e)).fromEntrySeq():"object"==typeof e?new P(e):void 0;if(!t)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+e);return t}function q(e){var t=U(e);if(!t)throw new TypeError("Expected Array or iterable object of values: "+e);return t}function R(e){var t=U(e)||"object"==typeof e&&new P(e);if(!t)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+e);return t}function U(e){return L(e)?new D(e):N(e)?new B(e):T(e)?new H(e):void 0}function z(e,t,n,r){var i=e._cache;if(i){for(var s=i.length-1,o=0;s>=o;o++){var u=i[n?s-o:o];if(t(u[1],r?u[0]:o,e)===!1)return o+1}return o}return e.__iterateUncached(t,n)}function W(e,t,n,r){var i=e._cache;if(i){var s=i.length-1,o=0;return new E(function(){var e=i[n?s-o:o];return o++>s?x():S(t,r?e[0]:o-1,e[1])})}return e.__iteratorUncached(t,n)}function X(){throw TypeError("Abstract")}function V(){}function $(){}function J(){}function K(e,t){return e===t||e!==e&&t!==t?!0:e&&t?("function"==typeof e.valueOf&&"function"==typeof t.valueOf&&(e=e.valueOf(),t=t.valueOf()),"function"==typeof e.equals&&"function"==typeof t.equals?e.equals(t):e===t||e!==e&&t!==t):!1}function Q(e,t){return t?G(t,e,"",{"":e}):Y(e)}function G(e,t,n,r){return Array.isArray(t)?e.call(r,n,M(t).map(function(n,r){return G(e,n,r,t)})):Z(t)?e.call(r,n,O(t).map(function(n,r){return G(e,n,r,t)})):t}function Y(e){return Array.isArray(e)?M(e).map(Y).toList():Z(e)?O(e).map(Y).toMap():e}function Z(e){return e&&e.constructor===Object}function et(e){return e>>>1&1073741824|3221225471&e}function tt(e){if(e===!1||null===e||void 0===e)return 0;if("function"==typeof e.valueOf&&(e=e.valueOf(),e===!1||null===e||void 0===e))return 0;if(e===!0)return 1;var t=typeof e;if("number"===t){var n=0|e;for(n!==e&&(n^=4294967295*e);e>4294967295;)e/=4294967295,n^=e;return et(n)}return"string"===t?e.length>Or?nt(e):rt(e):"function"==typeof e.hashCode?e.hashCode():it(e)}function nt(e){var t=Dr[e];return void 0===t&&(t=rt(e),_r===Mr&&(_r=0,Dr={}),_r++,Dr[e]=t),t}function rt(e){for(var t=0,n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return et(t)}function it(e){var t=kr&&kr.get(e);if(t)return t;if(t=e[Ar])return t;if(!Cr){if(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[Ar])return t;if(t=st(e))return t}if(Object.isExtensible&&!Object.isExtensible(e))throw new Error("Non-extensible objects are not allowed as keys.");if(t=++Lr,1073741824&Lr&&(Lr=0),kr)kr.set(e,t);else if(Cr)Object.defineProperty(e,Ar,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[Ar]=t;else{if(!e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[Ar]=t}return t}function st(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function ot(e,t){if(!e)throw new Error(t)}function ut(e){ot(e!==1/0,"Cannot perform this action with an infinite size.")}function at(e,t){this._iter=e,this._useKeys=t,this.size=e.size}function ft(e){this._iter=e,this.size=e.size}function lt(e){this._iter=e,this.size=e.size}function ct(e){this._iter=e,this.size=e.size}function ht(e){var t=Dt(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.contains(t)},t.contains=function(t){return e.has(t)},t.cacheResult=Pt,t.__iterateUncached=function(t,n){var r=this;return e.__iterate(function(e,n){return t(n,e,r)!==!1},n)},t.__iteratorUncached=function(t,n){if(t===br){var r=e.__iterator(t,n);return new E(function(){var e=r.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e})}return e.__iterator(t===yr?gr:yr,n)},t}function pt(e,t,n){var r=Dt(e);return r.size=e.size,r.has=function(t){return e.has(t)},r.get=function(r,i){var s=e.get(r,lr);return s===lr?i:t.call(n,s,r,e)},r.__iterateUncached=function(r,i){var s=this;return e.__iterate(function(e,i,o){return r(t.call(n,e,i,o),i,s)!==!1},i)},r.__iteratorUncached=function(r,i){var s=e.__iterator(br,i);return new E(function(){var i=s.next();if(i.done)return i;var o=i.value,u=o[0];return S(r,u,t.call(n,o[1],u,e),i)})},r}function dt(e,t){var n=Dt(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var t=ht(e);return t.reverse=function(){return e.flip()},t}),n.get=function(n,r){return e.get(t?n:-1-n,r)},n.has=function(n){return e.has(t?n:-1-n)},n.contains=function(t){return e.contains(t)},n.cacheResult=Pt,n.__iterate=function(t,n){var r=this;return e.__iterate(function(e,n){return t(e,n,r)},!n)},n.__iterator=function(t,n){return e.__iterator(t,!n)},n}function vt(e,t,n,r){var i=Dt(e);return r&&(i.has=function(r){var i=e.get(r,lr);return i!==lr&&!!t.call(n,i,r,e)},i.get=function(r,i){var s=e.get(r,lr);return s!==lr&&t.call(n,s,r,e)?s:i}),i.__iterateUncached=function(i,s){var o=this,u=0;return e.__iterate(function(e,s,a){return t.call(n,e,s,a)?(u++,i(e,r?s:u-1,o)):void 0},s),u},i.__iteratorUncached=function(i,s){var o=e.__iterator(br,s),u=0;return new E(function(){for(;;){var s=o.next();if(s.done)return s;var a=s.value,f=a[0],l=a[1];if(t.call(n,l,f,e))return S(i,r?f:u++,l,s)}})},i}function mt(e,t,n){var r=jt().asMutable();return e.__iterate(function(i,s){r.update(t.call(n,i,s,e),0,function(e){return e+1})}),r.asImmutable()}function gt(e,t,n){var r=g(e),i=(w(e)?Tn():jt()).asMutable();e.__iterate(function(s,o){i.update(t.call(n,s,o,e),function(e){return e=e||[],e.push(r?[o,s]:s),e})});var s=_t(e);return i.map(function(t){return At(e,s(t))})}function yt(e,t,n,r){var i=e.size;if(a(t,n,i))return e;var s=f(t,i),u=l(n,i);if(s!==s||u!==u)return yt(e.toSeq().cacheResult(),t,n,r);var c=u-s;0>c&&(c=0);var h=Dt(e);return h.size=0===c?c:e.size&&c||void 0,!r&&j(e)&&c>=0&&(h.get=function(t,n){return t=o(this,t),t>=0&&c>t?e.get(t+s,n):n}),h.__iterateUncached=function(t,n){var i=this;if(0===c)return 0;if(n)return this.cacheResult().__iterate(t,n);var o=0,u=!0,a=0;return e.__iterate(function(e,n){return u&&(u=o++<s)?void 0:(a++,t(e,r?n:a-1,i)!==!1&&a!==c)}),a},h.__iteratorUncached=function(t,n){if(c&&n)return this.cacheResult().__iterator(t,n);var i=c&&e.__iterator(t,n),o=0,u=0;return new E(function(){for(;o++!==s;)i.next();if(++u>c)return x();var e=i.next();return r||t===yr?e:t===gr?S(t,u-1,void 0,e):S(t,u-1,e.value[1],e)})},h}function bt(e,t,n){var r=Dt(e);return r.__iterateUncached=function(r,i){var s=this;if(i)return this.cacheResult().__iterate(r,i);var o=0;return e.__iterate(function(e,i,u){return t.call(n,e,i,u)&&++o&&r(e,i,s)}),o},r.__iteratorUncached=function(r,i){var s=this;if(i)return this.cacheResult().__iterator(r,i);var o=e.__iterator(br,i),u=!0;return new E(function(){if(!u)return x();var e=o.next();if(e.done)return e;var i=e.value,a=i[0],f=i[1];return t.call(n,f,a,s)?r===br?e:S(r,a,f,e):(u=!1,x())})},r}function wt(e,t,n,r){var i=Dt(e);return i.__iterateUncached=function(i,s){var o=this;if(s)return this.cacheResult().__iterate(i,s);var u=!0,a=0;return e.__iterate(function(e,s,f){return u&&(u=t.call(n,e,s,f))?void 0:(a++,i(e,r?s:a-1,o))}),a},i.__iteratorUncached=function(i,s){var o=this;if(s)return this.cacheResult().__iterator(i,s);var u=e.__iterator(br,s),a=!0,f=0;return new E(function(){var e,s,l;do{if(e=u.next(),e.done)return r||i===yr?e:i===gr?S(i,f++,void 0,e):S(i,f++,e.value[1],e);var c=e.value;s=c[0],l=c[1],a&&(a=t.call(n,l,s,o))}while(a);return i===br?e:S(i,s,l,e)})},i}function Et(e,t){var n=g(e),r=[e].concat(t).map(function(e){return m(e)?n&&(e=p(e)):e=n?I(e):q(Array.isArray(e)?e:[e]),e}).filter(function(e){return 0!==e.size});if(0===r.length)return e;if(1===r.length){var i=r[0];if(i===e||n&&g(i)||y(e)&&y(i))return i}var s=new D(r);return n?s=s.toKeyedSeq():y(e)||(s=s.toSetSeq()),s=s.flatten(!0),s.size=r.reduce(function(e,t){if(void 0!==e){var n=t.size;if(void 0!==n)return e+n}},0),s}function St(e,t,n){var r=Dt(e);return r.__iterateUncached=function(r,i){function s(e,a){var f=this;e.__iterate(function(e,i){return(!t||t>a)&&m(e)?s(e,a+1):r(e,n?i:o++,f)===!1&&(u=!0),!u},i)}var o=0,u=!1;return s(e,0),o},r.__iteratorUncached=function(r,i){var s=e.__iterator(r,i),o=[],u=0;return new E(function(){for(;s;){var e=s.next();if(e.done===!1){var a=e.value;if(r===br&&(a=a[1]),t&&!(o.length<t)||!m(a))return n?e:S(r,u++,a,e);o.push(s),s=a.__iterator(r,i)}else s=o.pop()}return x()})},r}function xt(e,t,n){var r=_t(e);return e.toSeq().map(function(i,s){return r(t.call(n,i,s,e))}).flatten(!0)}function Tt(e,t){var n=Dt(e);return n.size=e.size&&2*e.size-1,n.__iterateUncached=function(n,r){var i=this,s=0;return e.__iterate(function(e){return(!s||n(t,s++,i)!==!1)&&n(e,s++,i)!==!1},r),s},n.__iteratorUncached=function(n,r){var i,s=e.__iterator(yr,r),o=0;return new E(function(){return(!i||o%2)&&(i=s.next(),i.done)?i:o%2?S(n,o++,t):S(n,o++,i.value,i)})},n}function Nt(e,t,n){t||(t=Ht);var r=g(e),i=0,s=e.toSeq().map(function(t,r){return[r,t,i++,n?n(t,r,e):t]}).toArray();return s.sort(function(e,n){return t(e[3],n[3])||e[2]-n[2]}).forEach(r?function(e,t){s[t].length=2}:function(e,t){s[t]=e[1]}),r?O(s):y(e)?M(s):_(s)}function Ct(e,t,n){if(t||(t=Ht),n){var r=e.toSeq().map(function(t,r){return[t,n(t,r,e)]}).reduce(function(e,n){return kt(t,e[1],n[1])?n:e});return r&&r[0]}return e.reduce(function(e,n){return kt(t,e,n)?n:e})}function kt(e,t,n){var r=e(n,t);return 0===r&&n!==t&&(void 0===n||null===n||n!==n)||r>0}function Lt(e,t,n){var r=Dt(e);return r.size=(new D(n)).map(function(e){return e.size}).min(),r.__iterate=function(e,t){for(var n,r=this.__iterator(yr,t),i=0;!(n=r.next()).done&&e(n.value,i++,this)!==!1;);return i},r.__iteratorUncached=function(e,r){var i=n.map(function(e){return e=h(e),C(r?e.reverse():e)}),s=0,o=!1;return new E(function(){var n;return o||(n=i.map(function(e){return e.next()}),o=n.some(function(e){return e.done})),o?x():S(e,s++,t.apply(null,n.map(function(e){return e.value})))})},r}function At(e,t){return j(e)?t:e.constructor(t)}function Ot(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function Mt(e){return ut(e.size),s(e)}function _t(e){return g(e)?p:y(e)?d:v}function Dt(e){return Object.create((g(e)?O:y(e)?M:_).prototype)}function Pt(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):A.prototype.cacheResult.call(this)}function Ht(e,t){return e>t?1:t>e?-1:0}function Bt(e){var t=C(e);if(!t){if(!L(e))throw new TypeError("Expected iterable or array-like: "+e);t=C(h(e))}return t}function jt(e){return null===e||void 0===e?Jt():Ft(e)?e:Jt().withMutations(function(t){var n=p(e);ut(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function Ft(e){return!!e&&!!e[Pr]}function It(e,t){this.ownerID=e,this.entries=t}function qt(e,t,n){this.ownerID=e,this.bitmap=t,this.nodes=n}function Rt(e,t,n){this.ownerID=e,this.count=t,this.nodes=n}function Ut(e,t,n){this.ownerID=e,this.keyHash=t,this.entries=n}function zt(e,t,n){this.ownerID=e,this.keyHash=t,this.entry=n}function Wt(e,t,n){this._type=t,this._reverse=n,this._stack=e._root&&Vt(e._root)}function Xt(e,t){return S(e,t[0],t[1])}function Vt(e,t){return{node:e,index:0,__prev:t}}function $t(e,t,n,r){var i=Object.create(Hr);return i.size=e,i._root=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function Jt(){return Br||(Br=$t(0))}function Kt(e,n,r){var i,s;if(e._root){var o=t(cr),u=t(hr);if(i=Qt(e._root,e.__ownerID,0,void 0,n,r,o,u),!u.value)return e;s=e.size+(o.value?r===lr?-1:1:0)}else{if(r===lr)return e;s=1,i=new It(e.__ownerID,[[n,r]])}return e.__ownerID?(e.size=s,e._root=i,e.__hash=void 0,e.__altered=!0,e):i?$t(s,i):Jt()}function Qt(e,t,r,i,s,o,u,a){return e?e.update(t,r,i,s,o,u,a):o===lr?e:(n(a),n(u),new zt(t,i,[s,o]))}function Gt(e){return e.constructor===zt||e.constructor===Ut}function Yt(e,t,n,r,i){if(e.keyHash===r)return new Ut(t,r,[e.entry,i]);var s,o=(0===n?e.keyHash:e.keyHash>>>n)&fr,u=(0===n?r:r>>>n)&fr,a=o===u?[Yt(e,t,n+ur,r,i)]:(s=new zt(t,r,i),u>o?[e,s]:[s,e]);return new qt(t,1<<o|1<<u,a)}function Zt(e,t,n,i){e||(e=new r);for(var s=new zt(e,tt(n),[n,i]),o=0;o<t.length;o++){var u=t[o];s=s.update(e,0,void 0,u[0],u[1])}return s}function en(e,t,n,r){for(var i=0,s=0,o=new Array(n),u=0,a=1,f=t.length;f>u;u++,a<<=1){var l=t[u];void 0!==l&&u!==r&&(i|=a,o[s++]=l)}return new qt(e,i,o)}function tn(e,t,n,r,i){for(var s=0,o=new Array(ar),u=0;0!==n;u++,n>>>=1)o[u]=1&n?t[s++]:void 0;return o[r]=i,new Rt(e,s+1,o)}function nn(e,t,n){for(var r=[],i=0;i<n.length;i++){var s=n[i],o=p(s);m(s)||(o=o.map(function(e){return Q(e)})),r.push(o)}return sn(e,t,r)}function rn(e){return function(t,n){return t&&t.mergeDeepWith&&m(n)?t.mergeDeepWith(e,n):e?e(t,n):n}}function sn(e,t,n){return n=n.filter(function(e){return 0!==e.size}),0===n.length?e:0===e.size&&1===n.length?e.constructor(n[0]):e.withMutations(function(e){for(var r=t?function(n,r){e.update(r,lr,function(e){return e===lr?n:t(e,n)})}:function(t,n){e.set(n,t)},i=0;i<n.length;i++)n[i].forEach(r)})}function on(e,t,n,r){var i=e===lr,s=t.next();if(s.done){var o=i?n:e,u=r(o);return u===o?e:u}ot(i||e&&e.set,"invalid keyPath");var a=s.value,f=i?lr:e.get(a,lr),l=on(f,t,n,r);return l===f?e:l===lr?e.remove(a):(i?Jt():e).set(a,l)}function un(e){return e-=e>>1&1431655765,e=(858993459&e)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,127&e}function an(e,t,n,r){var s=r?e:i(e);return s[t]=n,s}function fn(e,t,n,r){var i=e.length+1;if(r&&t+1===i)return e[t]=n,e;for(var s=new Array(i),o=0,u=0;i>u;u++)u===t?(s[u]=n,o=-1):s[u]=e[u+o];return s}function ln(e,t,n){var r=e.length-1;if(n&&t===r)return e.pop(),e;for(var i=new Array(r),s=0,o=0;r>o;o++)o===t&&(s=1),i[o]=e[o+s];return i}function cn(e){var t=mn();if(null===e||void 0===e)return t;if(hn(e))return e;var n=d(e),r=n.size;return 0===r?t:(ut(r),r>0&&ar>r?vn(0,r,ur,null,new pn(n.toArray())):t.withMutations(function(e){e.setSize(r),n.forEach(function(t,n){return e.set(n,t)})}))}function hn(e){return!!e&&!!e[qr]}function pn(e,t){this.array=e,this.ownerID=t}function dn(e,t){function n(e,t,n){return 0===t?r(e,n):i(e,t,n)}function r(e,n){var r=n===u?a&&a.array:e&&e.array,i=n>s?0:s-n,f=o-n;return f>ar&&(f=ar),function(){if(i===f)return zr;var e=t?--f:i++;return r&&r[e]}}function i(e,r,i){var u,a=e&&e.array,f=i>s?0:s-i>>r,l=(o-i>>r)+1;return l>ar&&(l=ar),function(){for(;;){if(u){var e=u();if(e!==zr)return e;u=null}if(f===l)return zr;var s=t?--l:f++;u=n(a&&a[s],r-ur,i+(s<<r))}}}var s=e._origin,o=e._capacity,u=xn(o),a=e._tail;return n(e._root,e._level,0)}function vn(e,t,n,r,i,s,o){var u=Object.create(Rr);return u.size=t-e,u._origin=e,u._capacity=t,u._level=n,u._root=r,u._tail=i,u.__ownerID=s,u.__hash=o,u.__altered=!1,u}function mn(){return Ur||(Ur=vn(0,0,ur))}function gn(e,n,r){if(n=o(e,n),n>=e.size||0>n)return e.withMutations(function(e){0>n?En(e,n).set(0,r):En(e,0,n+1).set(n,r)});n+=e._origin;var i=e._tail,s=e._root,u=t(hr);return n>=xn(e._capacity)?i=yn(i,e.__ownerID,0,n,r,u):s=yn(s,e.__ownerID,e._level,n,r,u),u.value?e.__ownerID?(e._root=s,e._tail=i,e.__hash=void 0,e.__altered=!0,e):vn(e._origin,e._capacity,e._level,s,i):e}function yn(e,t,r,i,s,o){var u=i>>>r&fr,a=e&&u<e.array.length;if(!a&&void 0===s)return e;var f;if(r>0){var l=e&&e.array[u],c=yn(l,t,r-ur,i,s,o);return c===l?e:(f=bn(e,t),f.array[u]=c,f)}return a&&e.array[u]===s?e:(n(o),f=bn(e,t),void 0===s&&u===f.array.length-1?f.array.pop():f.array[u]=s,f)}function bn(e,t){return t&&e&&t===e.ownerID?e:new pn(e?e.array.slice():[],t)}function wn(e,t){if(t>=xn(e._capacity))return e._tail;if(t<1<<e._level+ur){for(var n=e._root,r=e._level;n&&r>0;)n=n.array[t>>>r&fr],r-=ur;return n}}function En(e,t,n){var i=e.__ownerID||new r,s=e._origin,o=e._capacity,u=s+t,a=void 0===n?o:0>n?o+n:s+n;if(u===s&&a===o)return e;if(u>=a)return e.clear();for(var f=e._level,l=e._root,c=0;0>u+c;)l=new pn(l&&l.array.length?[void 0,l]:[],i),f+=ur,c+=1<<f;c&&(u+=c,s+=c,a+=c,o+=c);for(var h=xn(o),p=xn(a);p>=1<<f+ur;)l=new pn(l&&l.array.length?[l]:[],i),f+=ur;var d=e._tail,v=h>p?wn(e,a-1):p>h?new pn([],i):d;if(d&&p>h&&o>u&&d.array.length){l=bn(l,i);for(var m=l,g=f;g>ur;g-=ur){var y=h>>>g&fr;m=m.array[y]=bn(m.array[y],i)}m.array[h>>>ur&fr]=d}if(o>a&&(v=v&&v.removeAfter(i,0,a)),u>=p)u-=p,a-=p,f=ur,l=null,v=v&&v.removeBefore(i,0,u);else if(u>s||h>p){for(c=0;l;){var b=u>>>f&fr;if(b!==p>>>f&fr)break;b&&(c+=(1<<f)*b),f-=ur,l=l.array[b]}l&&u>s&&(l=l.removeBefore(i,f,u-c)),l&&h>p&&(l=l.removeAfter(i,f,p-c)),c&&(u-=c,a-=c)}return e.__ownerID?(e.size=a-u,e._origin=u,e._capacity=a,e._level=f,e._root=l,e._tail=v,e.__hash=void 0,e.__altered=!0,e):vn(u,a,f,l,v)}function Sn(e,t,n){for(var r=[],i=0,s=0;s<n.length;s++){var o=n[s],u=d(o);u.size>i&&(i=u.size),m(o)||(u=u.map(function(e){return Q(e)})),r.push(u)}return i>e.size&&(e=e.setSize(i)),sn(e,t,r)}function xn(e){return ar>e?0:e-1>>>ur<<ur}function Tn(e){return null===e||void 0===e?kn():Nn(e)?e:kn().withMutations(function(t){var n=p(e);ut(n.size),n.forEach(function(e,n){return t.set(n,e)})})}function Nn(e){return Ft(e)&&w(e)}function Cn(e,t,n,r){var i=Object.create(Tn.prototype);return i.size=e?e.size:0,i._map=e,i._list=t,i.__ownerID=n,i.__hash=r,i}function kn(){return Wr||(Wr=Cn(Jt(),mn()))}function Ln(e,t,n){var r,i,s=e._map,o=e._list,u=s.get(t),a=void 0!==u;if(n===lr){if(!a)return e;o.size>=ar&&o.size>=2*s.size?(i=o.filter(function(e,t){return void 0!==e&&u!==t}),r=i.toKeyedSeq().map(function(e){return e[0]}).flip().toMap(),e.__ownerID&&(r.__ownerID=i.__ownerID=e.__ownerID)):(r=s.remove(t),i=u===o.size-1?o.pop():o.set(u,void 0))}else if(a){if(n===o.get(u)[1])return e;r=s,i=o.set(u,[t,n])}else r=s.set(t,o.size),i=o.set(o.size,[t,n]);return e.__ownerID?(e.size=r.size,e._map=r,e._list=i,e.__hash=void 0,e):Cn(r,i)}function An(e){return null===e||void 0===e?_n():On(e)?e:_n().unshiftAll(e)}function On(e){return!!e&&!!e[Xr]}function Mn(e,t,n,r){var i=Object.create(Vr);return i.size=e,i._head=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function _n(){return $r||($r=Mn(0))}function Dn(e){return null===e||void 0===e?jn():Pn(e)?e:jn().withMutations(function(t){var n=v(e);ut(n.size),n.forEach(function(e){return t.add(e)})})}function Pn(e){return!!e&&!!e[Jr]}function Hn(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function Bn(e,t){var n=Object.create(Kr);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function jn(){return Qr||(Qr=Bn(Jt()))}function Fn(e){return null===e||void 0===e?Rn():In(e)?e:Rn().withMutations(function(t){var n=v(e);ut(n.size),n.forEach(function(e){return t.add(e)})})}function In(e){return Pn(e)&&w(e)}function qn(e,t){var n=Object.create(Gr);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function Rn(){return Yr||(Yr=qn(kn()))}function Un(e,t){var n=function(e){return this instanceof n?void (this._map=jt(e)):new n(e)},r=Object.keys(e),i=n.prototype=Object.create(Zr);i.constructor=n,t&&(i._name=t),i._defaultValues=e,i._keys=r,i.size=r.length;try{r.forEach(function(e){Object.defineProperty(n.prototype,e,{get:function(){return this.get(e)},set:function(t){ot(this.__ownerID,"Cannot set on an immutable record."),this.set(e,t)}})})}catch(s){}return n}function zn(e,t,n){var r=Object.create(Object.getPrototypeOf(e));return r._map=t,r.__ownerID=n,r}function Wn(e){return e._name||e.constructor.name}function Xn(e,t){if(e===t)return!0;if(!m(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||g(e)!==g(t)||y(e)!==y(t)||w(e)!==w(t))return!1;if(0===e.size&&0===t.size)return!0;var n=!b(e);if(w(e)){var r=e.entries();return t.every(function(e,t){var i=r.next().value;return i&&K(i[1],e)&&(n||K(i[0],t))})&&r.next().done}var i=!1;if(void 0===e.size)if(void 0===t.size)e.cacheResult();else{i=!0;var s=e;e=t,t=s}var o=!0,u=t.__iterate(function(t,r){return(n?e.has(t):i?K(t,e.get(r,lr)):K(e.get(r,lr),t))?void 0:(o=!1,!1)});return o&&e.size===u}function Vn(e,t,n){if(!(this instanceof Vn))return new Vn(e,t,n);if(ot(0!==n,"Cannot step a Range by 0"),e=e||0,void 0===t&&(t=1/0),n=void 0===n?1:Math.abs(n),e>t&&(n=-n),this._start=e,this._end=t,this._step=n,this.size=Math.max(0,Math.ceil((t-e)/n-1)+1),0===this.size){if(ei)return ei;ei=this}}function $n(e,t){if(!(this instanceof $n))return new $n(e,t);if(this._value=e,this.size=void 0===t?1/0:Math.max(0,t),0===this.size){if(ti)return ti;ti=this}}function Jn(e,t){var n=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(n),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(n),e}function Kn(e,t){return t}function Qn(e,t){return[t,e]}function Gn(e){return function(){return!e.apply(this,arguments)}}function Yn(e){return function(){return-e.apply(this,arguments)}}function Zn(e){return"string"==typeof e?JSON.stringify(e):e}function er(){return i(arguments)}function tr(e,t){return t>e?1:e>t?-1:0}function nr(e){if(e.size===1/0)return 0;var t=w(e),n=g(e),r=t?1:0,i=e.__iterate(n?t?function(e,t){r=31*r+ir(tt(e),tt(t))|0}:function(e,t){r=r+ir(tt(e),tt(t))|0}:t?function(e){r=31*r+tt(e)|0}:function(e){r=r+tt(e)|0});return rr(i,r)}function rr(e,t){return t=Nr(t,3432918353),t=Nr(t<<15|t>>>-15,461845907),t=Nr(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=Nr(t^t>>>16,2246822507),t=Nr(t^t>>>13,3266489909),t=et(t^t>>>16)}function ir(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}var sr=Array.prototype.slice,or="delete",ur=5,ar=1<<ur,fr=ar-1,lr={},cr={value:!1},hr={value:!1};e(p,h),e(d,h),e(v,h),h.isIterable=m,h.isKeyed=g,h.isIndexed=y,h.isAssociative=b,h.isOrdered=w,h.Keyed=p,h.Indexed=d,h.Set=v;var pr="@@__IMMUTABLE_ITERABLE__@@",dr="@@__IMMUTABLE_KEYED__@@",vr="@@__IMMUTABLE_INDEXED__@@",mr="@@__IMMUTABLE_ORDERED__@@",gr=0,yr=1,br=2,wr="function"==typeof Symbol&&Symbol.iterator,Er="@@iterator",Sr=wr||Er;E.prototype.toString=function(){return"[Iterator]"},E.KEYS=gr,E.VALUES=yr,E.ENTRIES=br,E.prototype.inspect=E.prototype.toSource=function(){return this.toString()},E.prototype[Sr]=function(){return this},e(A,h),A.of=function(){return A(arguments)},A.prototype.toSeq=function(){return this},A.prototype.toString=function(){return this.__toString("Seq {","}")},A.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},A.prototype.__iterate=function(e,t){return z(this,e,t,!0)},A.prototype.__iterator=function(e,t){return W(this,e,t,!0)},e(O,A),O.of=function(){return O(arguments)},O.prototype.toKeyedSeq=function(){return this},O.prototype.toSeq=function(){return this},e(M,A),M.of=function(){return M(arguments)},M.prototype.toIndexedSeq=function(){return this},M.prototype.toString=function(){return this.__toString("Seq [","]")},M.prototype.__iterate=function(e,t){return z(this,e,t,!1)},M.prototype.__iterator=function(e,t){return W(this,e,t,!1)},e(_,A),_.of=function(){return _(arguments)},_.prototype.toSetSeq=function(){return this},A.isSeq=j,A.Keyed=O,A.Set=_,A.Indexed=M;var xr="@@__IMMUTABLE_SEQ__@@";A.prototype[xr]=!0,e(D,M),D.prototype.get=function(e,t){return this.has(e)?this._array[o(this,e)]:t},D.prototype.__iterate=function(e,t){for(var n=this._array,r=n.length-1,i=0;r>=i;i++)if(e(n[t?r-i:i],i,this)===!1)return i+1;return i},D.prototype.__iterator=function(e,t){var n=this._array,r=n.length-1,i=0;return new E(function(){return i>r?x():S(e,i,n[t?r-i++:i++])})},e(P,O),P.prototype.get=function(e,t){return void 0===t||this.has(e)?this._object[e]:t},P.prototype.has=function(e){return this._object.hasOwnProperty(e)},P.prototype.__iterate=function(e,t){for(var n=this._object,r=this._keys,i=r.length-1,s=0;i>=s;s++){var o=r[t?i-s:s];if(e(n[o],o,this)===!1)return s+1}return s},P.prototype.__iterator=function(e,t){var n=this._object,r=this._keys,i=r.length-1,s=0;return new E(function(){var o=r[t?i-s:s];return s++>i?x():S(e,o,n[o])})},P.prototype[mr]=!0,e(H,M),H.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var n=this._iterable,r=C(n),i=0;if(N(r))for(var s;!(s=r.next()).done&&e(s.value,i++,this)!==!1;);return i},H.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterable,r=C(n);if(!N(r))return new E(x);var i=0;return new E(function(){var t=r.next();return t.done?t:S(e,i++,t.value)})},e(B,M),B.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);for(var n=this._iterator,r=this._iteratorCache,i=0;i<r.length;)if(e(r[i],i++,this)===!1)return i;for(var s;!(s=n.next()).done;){var o=s.value;if(r[i]=o,e(o,i++,this)===!1)break}return i},B.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=this._iterator,r=this._iteratorCache,i=0;return new E(function(){if(i>=r.length){var t=n.next();if(t.done)return t;r[i]=t.value}return S(e,i,r[i++])})};var Tr;e(X,h),e(V,X),e($,X),e(J,X),X.Keyed=V,X.Indexed=$,X.Set=J;var Nr="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(e,t){e=0|e,t=0|t;var n=65535&e,r=65535&t;return n*r+((e>>>16)*r+n*(t>>>16)<<16>>>0)|0},Cr=function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}(),kr="function"==typeof WeakMap&&new WeakMap,Lr=0,Ar="__immutablehash__";"function"==typeof Symbol&&(Ar=Symbol(Ar));var Or=16,Mr=255,_r=0,Dr={};e(at,O),at.prototype.get=function(e,t){return this._iter.get(e,t)},at.prototype.has=function(e){return this._iter.has(e)},at.prototype.valueSeq=function(){return this._iter.valueSeq()},at.prototype.reverse=function(){var e=this,t=dt(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},at.prototype.map=function(e,t){var n=this,r=pt(this,e,t);return this._useKeys||(r.valueSeq=function(){return n._iter.toSeq().map(e,t)}),r},at.prototype.__iterate=function(e,t){var n,r=this;return this._iter.__iterate(this._useKeys?function(t,n){return e(t,n,r)}:(n=t?Mt(this):0,function(i){return e(i,t?--n:n++,r)}),t)},at.prototype.__iterator=function(e,t){if(this._useKeys)return this._iter.__iterator(e,t);var n=this._iter.__iterator(yr,t),r=t?Mt(this):0;return new E(function(){var i=n.next();return i.done?i:S(e,t?--r:r++,i.value,i)})},at.prototype[mr]=!0,e(ft,M),ft.prototype.contains=function(e){return this._iter.contains(e)},ft.prototype.__iterate=function(e,t){var n=this,r=0;return this._iter.__iterate(function(t){return e(t,r++,n)},t)},ft.prototype.__iterator=function(e,t){var n=this._iter.__iterator(yr,t),r=0;return new E(function(){var t=n.next();return t.done?t:S(e,r++,t.value,t)})},e(lt,_),lt.prototype.has=function(e){return this._iter.contains(e)},lt.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){return e(t,t,n)},t)},lt.prototype.__iterator=function(e,t){var n=this._iter.__iterator(yr,t);return new E(function(){var t=n.next();return t.done?t:S(e,t.value,t.value,t)})},e(ct,O),ct.prototype.entrySeq=function(){return this._iter.toSeq()},ct.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate(function(t){return t?(Ot(t),e(t[1],t[0],n)):void 0},t)},ct.prototype.__iterator=function(e,t){var n=this._iter.__iterator(yr,t);return new E(function(){for(;;){var t=n.next();if(t.done)return t;var r=t.value;if(r)return Ot(r),e===br?t:S(e,r[0],r[1],t)}})},ft.prototype.cacheResult=at.prototype.cacheResult=lt.prototype.cacheResult=ct.prototype.cacheResult=Pt,e(jt,V),jt.prototype.toString=function(){return this.__toString("Map {","}")},jt.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},jt.prototype.set=function(e,t){return Kt(this,e,t)},jt.prototype.setIn=function(e,t){return this.updateIn(e,lr,function(){return t})},jt.prototype.remove=function(e){return Kt(this,e,lr)},jt.prototype.deleteIn=function(e){return this.updateIn(e,function(){return lr})},jt.prototype.update=function(e,t,n){return 1===arguments.length?e(this):this.updateIn([e],t,n)},jt.prototype.updateIn=function(e,t,n){n||(n=t,t=void 0);var r=on(this,Bt(e),t,n);return r===lr?void 0:r},jt.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Jt()},jt.prototype.merge=function(){return nn(this,void 0,arguments)},jt.prototype.mergeWith=function(e){var t=sr.call(arguments,1);return nn(this,e,t)},jt.prototype.mergeIn=function(e){var t=sr.call(arguments,1);return this.updateIn(e,Jt(),function(e){return e.merge.apply(e,t)})},jt.prototype.mergeDeep=function(){return nn(this,rn(void 0),arguments)},jt.prototype.mergeDeepWith=function(e){var t=sr.call(arguments,1);return nn(this,rn(e),t)},jt.prototype.mergeDeepIn=function(e){var t=sr.call(arguments,1);return this.updateIn(e,Jt(),function(e){return e.mergeDeep.apply(e,t)})},jt.prototype.sort=function(e){return Tn(Nt(this,e))},jt.prototype.sortBy=function(e,t){return Tn(Nt(this,t,e))},jt.prototype.withMutations=function(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this},jt.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new r)},jt.prototype.asImmutable=function(){return this.__ensureOwner()},jt.prototype.wasAltered=function(){return this.__altered},jt.prototype.__iterator=function(e,t){return new Wt(this,e,t)},jt.prototype.__iterate=function(e,t){var n=this,r=0;return this._root&&this._root.iterate(function(t){return r++,e(t[1],t[0],n)},t),r},jt.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?$t(this.size,this._root,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},jt.isMap=Ft;var Pr="@@__IMMUTABLE_MAP__@@",Hr=jt.prototype;Hr[Pr]=!0,Hr[or]=Hr.remove,Hr.removeIn=Hr.deleteIn,It.prototype.get=function(e,t,n,r){for(var i=this.entries,s=0,o=i.length;o>s;s++)if(K(n,i[s][0]))return i[s][1];return r},It.prototype.update=function(e,t,r,s,o,u,a){for(var f=o===lr,l=this.entries,c=0,h=l.length;h>c&&!K(s,l[c][0]);c++);var p=h>c;if(p?l[c][1]===o:f)return this;if(n(a),(f||!p)&&n(u),!f||1!==l.length){if(!p&&!f&&l.length>=jr)return Zt(e,l,s,o);var d=e&&e===this.ownerID,v=d?l:i(l);return p?f?c===h-1?v.pop():v[c]=v.pop():v[c]=[s,o]:v.push([s,o]),d?(this.entries=v,this):new It(e,v)}},qt.prototype.get=function(e,t,n,r){void 0===t&&(t=tt(n));var i=1<<((0===e?t:t>>>e)&fr),s=this.bitmap;return 0===(s&i)?r:this.nodes[un(s&i-1)].get(e+ur,t,n,r)},qt.prototype.update=function(e,t,n,r,i,s,o){void 0===n&&(n=tt(r));var u=(0===t?n:n>>>t)&fr,a=1<<u,f=this.bitmap,l=0!==(f&a);if(!l&&i===lr)return this;var c=un(f&a-1),h=this.nodes,p=l?h[c]:void 0,d=Qt(p,e,t+ur,n,r,i,s,o);if(d===p)return this;if(!l&&d&&h.length>=Fr)return tn(e,h,f,u,d);if(l&&!d&&2===h.length&&Gt(h[1^c]))return h[1^c];if(l&&d&&1===h.length&&Gt(d))return d;var v=e&&e===this.ownerID,m=l?d?f:f^a:f|a,g=l?d?an(h,c,d,v):ln(h,c,v):fn(h,c,d,v);return v?(this.bitmap=m,this.nodes=g,this):new qt(e,m,g)},Rt.prototype.get=function(e,t,n,r){void 0===t&&(t=tt(n));var i=(0===e?t:t>>>e)&fr,s=this.nodes[i];return s?s.get(e+ur,t,n,r):r},Rt.prototype.update=function(e,t,n,r,i,s,o){void 0===n&&(n=tt(r));var u=(0===t?n:n>>>t)&fr,a=i===lr,f=this.nodes,l=f[u];if(a&&!l)return this;var c=Qt(l,e,t+ur,n,r,i,s,o);if(c===l)return this;var h=this.count;if(l){if(!c&&(h--,Ir>h))return en(e,f,h,u)}else h++;var p=e&&e===this.ownerID,d=an(f,u,c,p);return p?(this.count=h,this.nodes=d,this):new Rt(e,h,d)},Ut.prototype.get=function(e,t,n,r){for(var i=this.entries,s=0,o=i.length;o>s;s++)if(K(n,i[s][0]))return i[s][1];return r},Ut.prototype.update=function(e,t,r,s,o,u,a){void 0===r&&(r=tt(s));var f=o===lr;if(r!==this.keyHash)return f?this:(n(a),n(u),Yt(this,e,t,r,[s,o]));for(var l=this.entries,c=0,h=l.length;h>c&&!K(s,l[c][0]);c++);var p=h>c;if(p?l[c][1]===o:f)return this;if(n(a),(f||!p)&&n(u),f&&2===h)return new zt(e,this.keyHash,l[1^c]);var d=e&&e===this.ownerID,v=d?l:i(l);return p?f?c===h-1?v.pop():v[c]=v.pop():v[c]=[s,o]:v.push([s,o]),d?(this.entries=v,this):new Ut(e,this.keyHash,v)},zt.prototype.get=function(e,t,n,r){return K(n,this.entry[0])?this.entry[1]:r},zt.prototype.update=function(e,t,r,i,s,o,u){var a=s===lr,f=K(i,this.entry[0]);return(f?s===this.entry[1]:a)?this:(n(u),a?void n(o):f?e&&e===this.ownerID?(this.entry[1]=s,this):new zt(e,this.keyHash,[i,s]):(n(o),Yt(this,e,t,tt(i),[i,s])))},It.prototype.iterate=Ut.prototype.iterate=function(e,t){for(var n=this.entries,r=0,i=n.length-1;i>=r;r++)if(e(n[t?i-r:r])===!1)return!1},qt.prototype.iterate=Rt.prototype.iterate=function(e,t){for(var n=this.nodes,r=0,i=n.length-1;i>=r;r++){var s=n[t?i-r:r];if(s&&s.iterate(e,t)===!1)return!1}},zt.prototype.iterate=function(e){return e(this.entry)},e(Wt,E),Wt.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var n,r=t.node,i=t.index++;if(r.entry){if(0===i)return Xt(e,r.entry)}else if(r.entries){if(n=r.entries.length-1,n>=i)return Xt(e,r.entries[this._reverse?n-i:i])}else if(n=r.nodes.length-1,n>=i){var s=r.nodes[this._reverse?n-i:i];if(s){if(s.entry)return Xt(e,s.entry);t=this._stack=Vt(s,t)}continue}t=this._stack=this._stack.__prev}return x()};var Br,jr=ar/4,Fr=ar/2,Ir=ar/4;e(cn,$),cn.of=function(){return this(arguments)},cn.prototype.toString=function(){return this.__toString("List [","]")},cn.prototype.get=function(e,t){if(e=o(this,e),0>e||e>=this.size)return t;e+=this._origin;var n=wn(this,e);return n&&n.array[e&fr]},cn.prototype.set=function(e,t){return gn(this,e,t)},cn.prototype.remove=function(e){return this.has(e)?0===e?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},cn.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=ur,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):mn()},cn.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations(function(n){En(n,0,t+e.length);for(var r=0;r<e.length;r++)n.set(t+r,e[r])})},cn.prototype.pop=function(){return En(this,0,-1)},cn.prototype.unshift=function(){var e=arguments;return this.withMutations(function(t){En(t,-e.length);for(var n=0;n<e.length;n++)t.set(n,e[n])})},cn.prototype.shift=function(){return En(this,1)},cn.prototype.merge=function(){return Sn(this,void 0,arguments)},cn.prototype.mergeWith=function(e){var t=sr.call(arguments,1);return Sn(this,e,t)},cn.prototype.mergeDeep=function(){return Sn(this,rn(void 0),arguments)},cn.prototype.mergeDeepWith=function(e){var t=sr.call(arguments,1);return Sn(this,rn(e),t)},cn.prototype.setSize=function(e){return En(this,0,e)},cn.prototype.slice=function(e,t){var n=this.size;return a(e,t,n)?this:En(this,f(e,n),l(t,n))},cn.prototype.__iterator=function(e,t){var n=0,r=dn(this,t);return new E(function(){var t=r();return t===zr?x():S(e,n++,t)})},cn.prototype.__iterate=function(e,t){for(var n,r=0,i=dn(this,t);(n=i())!==zr&&e(n,r++,this)!==!1;);return r},cn.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?vn(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this.__ownerID=e,this)},cn.isList=hn;var qr="@@__IMMUTABLE_LIST__@@",Rr=cn.prototype;Rr[qr]=!0,Rr[or]=Rr.remove,Rr.setIn=Hr.setIn,Rr.deleteIn=Rr.removeIn=Hr.removeIn,Rr.update=Hr.update,Rr.updateIn=Hr.updateIn,Rr.mergeIn=Hr.mergeIn,Rr.mergeDeepIn=Hr.mergeDeepIn,Rr.withMutations=Hr.withMutations,Rr.asMutable=Hr.asMutable,Rr.asImmutable=Hr.asImmutable,Rr.wasAltered=Hr.wasAltered,pn.prototype.removeBefore=function(e,t,n){if(n===t?1<<t:0===this.array.length)return this;var r=n>>>t&fr;if(r>=this.array.length)return new pn([],e);var i,s=0===r;if(t>0){var o=this.array[r];if(i=o&&o.removeBefore(e,t-ur,n),i===o&&s)return this}if(s&&!i)return this;var u=bn(this,e);if(!s)for(var a=0;r>a;a++)u.array[a]=void 0;return i&&(u.array[r]=i),u},pn.prototype.removeAfter=function(e,t,n){if(n===t?1<<t:0===this.array.length)return this;var r=n-1>>>t&fr;if(r>=this.array.length)return this;var i,s=r===this.array.length-1;if(t>0){var o=this.array[r];if(i=o&&o.removeAfter(e,t-ur,n),i===o&&s)return this}if(s&&!i)return this;var u=bn(this,e);return s||u.array.pop(),i&&(u.array[r]=i),u};var Ur,zr={};e(Tn,jt),Tn.of=function(){return this(arguments)},Tn.prototype.toString=function(){return this.__toString("OrderedMap {","}")},Tn.prototype.get=function(e,t){var n=this._map.get(e);return void 0!==n?this._list.get(n)[1]:t},Tn.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):kn()},Tn.prototype.set=function(e,t){return Ln(this,e,t)},Tn.prototype.remove=function(e){return Ln(this,e,lr)},Tn.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},Tn.prototype.__iterate=function(e,t){var n=this;return this._list.__iterate(function(t){return t&&e(t[1],t[0],n)},t)},Tn.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},Tn.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),n=this._list.__ensureOwner(e);return e?Cn(t,n,e,this.__hash):(this.__ownerID=e,this._map=t,this._list=n,this)},Tn.isOrderedMap=Nn,Tn.prototype[mr]=!0,Tn.prototype[or]=Tn.prototype.remove;var Wr;e(An,$),An.of=function(){return this(arguments)},An.prototype.toString=function(){return this.__toString("Stack [","]")},An.prototype.get=function(e,t){for(var n=this._head;n&&e--;)n=n.next;return n?n.value:t},An.prototype.peek=function(){return this._head&&this._head.value},An.prototype.push=function(){if(0===arguments.length)return this;for(var e=this.size+arguments.length,t=this._head,n=arguments.length-1;n>=0;n--)t={value:arguments[n],next:t};return this.__ownerID?(this.size=e,this._head=t,this.__hash=void 0,this.__altered=!0,this):Mn(e,t)},An.prototype.pushAll=function(e){if(e=d(e),0===e.size)return this;ut(e.size);var t=this.size,n=this._head;return e.reverse().forEach(function(e){t++,n={value:e,next:n}}),this.__ownerID?(this.size=t,this._head=n,this.__hash=void 0,this.__altered=!0,this):Mn(t,n)},An.prototype.pop=function(){return this.slice(1)},An.prototype.unshift=function(){return this.push.apply(this,arguments)},An.prototype.unshiftAll=function(e){return this.pushAll(e)},An.prototype.shift=function(){return this.pop.apply(this,arguments)},An.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):_n()},An.prototype.slice=function(e,t){if(a(e,t,this.size))return this;var n=f(e,this.size),r=l(t,this.size);if(r!==this.size)return $.prototype.slice.call(this,e,t);for(var i=this.size-n,s=this._head;n--;)s=s.next;return this.__ownerID?(this.size=i,this._head=s,this.__hash=void 0,this.__altered=!0,this):Mn(i,s)},An.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Mn(this.size,this._head,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},An.prototype.__iterate=function(e,t){if(t)return this.toSeq().cacheResult.__iterate(e,t);for(var n=0,r=this._head;r&&e(r.value,n++,this)!==!1;)r=r.next;return n},An.prototype.__iterator=function(e,t){if(t)return this.toSeq().cacheResult().__iterator(e,t);var n=0,r=this._head;return new E(function(){if(r){var t=r.value;return r=r.next,S(e,n++,t)}return x()})},An.isStack=On;var Xr="@@__IMMUTABLE_STACK__@@",Vr=An.prototype;Vr[Xr]=!0,Vr.withMutations=Hr.withMutations,Vr.asMutable=Hr.asMutable,Vr.asImmutable=Hr.asImmutable,Vr.wasAltered=Hr.wasAltered;var $r;e(Dn,J),Dn.of=function(){return this(arguments)},Dn.fromKeys=function(e){return this(p(e).keySeq())},Dn.prototype.toString=function(){return this.__toString("Set {","}")},Dn.prototype.has=function(e){return this._map.has(e)},Dn.prototype.add=function(e){return Hn(this,this._map.set(e,!0))},Dn.prototype.remove=function(e){return Hn(this,this._map.remove(e))},Dn.prototype.clear=function(){return Hn(this,this._map.clear())},Dn.prototype.union=function(){var e=sr.call(arguments,0);return e=e.filter(function(e){return 0!==e.size}),0===e.length?this:0===this.size&&1===e.length?this.constructor(e[0]):this.withMutations(function(t){for(var n=0;n<e.length;n++)v(e[n]).forEach(function(e){return t.add(e)})})},Dn.prototype.intersect=function(){var e=sr.call(arguments,0);if(0===e.length)return this;e=e.map(function(e){return v(e)});var t=this;return this.withMutations(function(n){t.forEach(function(t){e.every(function(e){return e.contains(t)})||n.remove(t)})})},Dn.prototype.subtract=function(){var e=sr.call(arguments,0);if(0===e.length)return this;e=e.map(function(e){return v(e)});var t=this;return this.withMutations(function(n){t.forEach(function(t){e.some(function(e){return e.contains(t)})&&n.remove(t)})})},Dn.prototype.merge=function(){return this.union.apply(this,arguments)},Dn.prototype.mergeWith=function(){var e=sr.call(arguments,1);return this.union.apply(this,e)},Dn.prototype.sort=function(e){return Fn(Nt(this,e))},Dn.prototype.sortBy=function(e,t){return Fn(Nt(this,t,e))},Dn.prototype.wasAltered=function(){return this._map.wasAltered()},Dn.prototype.__iterate=function(e,t){var n=this;return this._map.__iterate(function(t,r){return e(r,r,n)},t)},Dn.prototype.__iterator=function(e,t){return this._map.map(function(e,t){return t}).__iterator(e,t)},Dn.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):(this.__ownerID=e,this._map=t,this)},Dn.isSet=Pn;var Jr="@@__IMMUTABLE_SET__@@",Kr=Dn.prototype;Kr[Jr]=!0,Kr[or]=Kr.remove,Kr.mergeDeep=Kr.merge,Kr.mergeDeepWith=Kr.mergeWith,Kr.withMutations=Hr.withMutations,Kr.asMutable=Hr.asMutable,Kr.asImmutable=Hr.asImmutable,Kr.__empty=jn,Kr.__make=Bn;var Qr;e(Fn,Dn),Fn.of=function(){return this(arguments)},Fn.fromKeys=function(e){return this(p(e).keySeq())},Fn.prototype.toString=function(){return this.__toString("OrderedSet {","}")},Fn.isOrderedSet=In;var Gr=Fn.prototype;Gr[mr]=!0,Gr.__empty=Rn,Gr.__make=qn;var Yr;e(Un,V),Un.prototype.toString=function(){return this.__toString(Wn(this)+" {","}")},Un.prototype.has=function(e){return this._defaultValues.hasOwnProperty(e)},Un.prototype.get=function(e,t){if(!this.has(e))return t;var n=this._defaultValues[e];return this._map?this._map.get(e,n):n},Un.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var e=Object.getPrototypeOf(this).constructor;return e._empty||(e._empty=zn(this,Jt()))},Un.prototype.set=function(e,t){if(!this.has(e))throw new Error('Cannot set unknown key "'+e+'" on '+Wn(this));var n=this._map&&this._map.set(e,t);return this.__ownerID||n===this._map?this:zn(this,n)},Un.prototype.remove=function(e){if(!this.has(e))return this;var t=this._map&&this._map.remove(e);return this.__ownerID||t===this._map?this:zn(this,t)},Un.prototype.wasAltered=function(){return this._map.wasAltered()},Un.prototype.__iterator=function(e,t){var n=this;return p(this._defaultValues).map(function(e,t){return n.get(t)}).__iterator(e,t)},Un.prototype.__iterate=function(e,t){var n=this;return p(this._defaultValues).map(function(e,t){return n.get(t)}).__iterate(e,t)},Un.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map&&this._map.__ensureOwner(e);return e?zn(this,t,e):(this.__ownerID=e,this._map=t,this)};var Zr=Un.prototype;Zr[or]=Zr.remove,Zr.deleteIn=Zr.removeIn=Hr.removeIn,Zr.merge=Hr.merge,Zr.mergeWith=Hr.mergeWith,Zr.mergeIn=Hr.mergeIn,Zr.mergeDeep=Hr.mergeDeep,Zr.mergeDeepWith=Hr.mergeDeepWith,Zr.mergeDeepIn=Hr.mergeDeepIn,Zr.setIn=Hr.setIn,Zr.update=Hr.update,Zr.updateIn=Hr.updateIn,Zr.withMutations=Hr.withMutations,Zr.asMutable=Hr.asMutable,Zr.asImmutable=Hr.asImmutable,e(Vn,M),Vn.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(this._step>1?" by "+this._step:"")+" ]"},Vn.prototype.get=function(e,t){return this.has(e)?this._start+o(this,e)*this._step:t},Vn.prototype.contains=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},Vn.prototype.slice=function(e,t){return a(e,t,this.size)?this:(e=f(e,this.size),t=l(t,this.size),e>=t?new Vn(0,0):new Vn(this.get(e,this._end),this.get(t,this._end),this._step))},Vn.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step===0){var n=t/this._step;if(n>=0&&n<this.size)return n}return-1},Vn.prototype.lastIndexOf=function(e){return this.indexOf(e)},Vn.prototype.__iterate=function(e,t){for(var n=this.size-1,r=this._step,i=t?this._start+n*r:this._start,s=0;n>=s;s++){if(e(i,s,this)===!1)return s+1;i+=t?-r:r}return s},Vn.prototype.__iterator=function(e,t){var n=this.size-1,r=this._step,i=t?this._start+n*r:this._start,s=0;return new E(function(){var o=i;return i+=t?-r:r,s>n?x():S(e,s++,o)})},Vn.prototype.equals=function(e){return e instanceof Vn?this._start===e._start&&this._end===e._end&&this._step===e._step:Xn(this,e)};var ei;e($n,M),$n.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},$n.prototype.get=function(e,t){return this.has(e)?this._value:t},$n.prototype.contains=function(e){return K(this._value,e)},$n.prototype.slice=function(e,t){var n=this.size;return a(e,t,n)?this:new $n(this._value,l(t,n)-f(e,n))},$n.prototype.reverse=function(){return this},$n.prototype.indexOf=function(e){return K(this._value,e)?0:-1},$n.prototype.lastIndexOf=function(e){return K(this._value,e)?this.size:-1},$n.prototype.__iterate=function(e){for(var t=0;t<this.size;t++)if(e(this._value,t,this)===!1)return t+1;return t},$n.prototype.__iterator=function(e){var t=this,n=0;return new E(function(){return n<t.size?S(e,n++,t._value):x()})},$n.prototype.equals=function(e){return e instanceof $n?K(this._value,e._value):Xn(e)};var ti;h.Iterator=E,Jn(h,{toArray:function(){ut(this.size);var e=new Array(this.size||0);return this.valueSeq().__iterate(function(t,n){e[n]=t}),e},toIndexedSeq:function(){return new ft(this)},toJS:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJS?e.toJS():e}).__toJS()},toJSON:function(){return this.toSeq().map(function(e){return e&&"function"==typeof e.toJSON?e.toJSON():e}).__toJS()},toKeyedSeq:function(){return new at(this,!0)},toMap:function(){return jt(this.toKeyedSeq())},toObject:function(){ut(this.size);var e={};return this.__iterate(function(t,n){e[n]=t}),e},toOrderedMap:function(){return Tn(this.toKeyedSeq())},toOrderedSet:function(){return Fn(g(this)?this.valueSeq():this)},toSet:function(){return Dn(g(this)?this.valueSeq():this)},toSetSeq:function(){return new lt(this)},toSeq:function(){return y(this)?this.toIndexedSeq():g(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return An(g(this)?this.valueSeq():this)},toList:function(){return cn(g(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(e,t){return 0===this.size?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){var e=sr.call(arguments,0);return At(this,Et(this,e))},contains:function(e){return this.some(function(t){return K(t,e)})},entries:function(){return this.__iterator(br)},every:function(e,t){ut(this.size);var n=!0;return this.__iterate(function(r,i,s){return e.call(t,r,i,s)?void 0:(n=!1,!1)}),n},filter:function(e,t){return At(this,vt(this,e,t,!0))},find:function(e,t,n){var r=this.findEntry(e,t);return r?r[1]:n},findEntry:function(e,t){var n;return this.__iterate(function(r,i,s){return e.call(t,r,i,s)?(n=[i,r],!1):void 0}),n},findLastEntry:function(e,t){return this.toSeq().reverse().findEntry(e,t)},forEach:function(e,t){return ut(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){ut(this.size),e=void 0!==e?""+e:",";var t="",n=!0;return this.__iterate(function(r){n?n=!1:t+=e,t+=null!==r&&void 0!==r?r:""}),t},keys:function(){return this.__iterator(gr)},map:function(e,t){return At(this,pt(this,e,t))},reduce:function(e,t,n){ut(this.size);var r,i;return arguments.length<2?i=!0:r=t,this.__iterate(function(t,s,o){i?(i=!1,r=t):r=e.call(n,r,t,s,o)}),r},reduceRight:function(){var e=this.toKeyedSeq().reverse();return e.reduce.apply(e,arguments)},reverse:function(){return At(this,dt(this,!0))},slice:function(e,t){return At(this,yt(this,e,t,!0))},some:function(e,t){return!this.every(Gn(e),t)},sort:function(e){return At(this,Nt(this,e))},values:function(){return this.__iterator(yr)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(e,t){return s(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return mt(this,e,t)},equals:function(e){return Xn(this,e)},entrySeq:function(){var e=this;if(e._cache)return new D(e._cache);var t=e.toSeq().map(Qn).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(Gn(e),t)},findLast:function(e,t,n){return this.toKeyedSeq().reverse().find(e,t,n)},first:function(){return this.find(u)},flatMap:function(e,t){return At(this,xt(this,e,t))},flatten:function(e){return At(this,St(this,e,!0))},fromEntrySeq:function(){return new ct(this)},get:function(e,t){return this.find(function(t,n){return K(n,e)},void 0,t)},getIn:function(e,t){for(var n,r=this,i=Bt(e);!(n=i.next()).done;){var s=n.value;if(r=r&&r.get?r.get(s,lr):lr,r===lr)return t}return r},groupBy:function(e,t){return gt(this,e,t)},has:function(e){return this.get(e,lr)!==lr},hasIn:function(e){return this.getIn(e,lr)!==lr},isSubset:function(e){return e="function"==typeof e.contains?e:h(e),this.every(function(t){return e.contains(t)})},isSuperset:function(e){return e.isSubset(this)},keySeq:function(){return this.toSeq().map(Kn).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},max:function(e){return Ct(this,e)},maxBy:function(e,t){return Ct(this,t,e)},min:function(e){return Ct(this,e?Yn(e):tr)},minBy:function(e,t){return Ct(this,t?Yn(t):tr,e)},rest:function(){return this.slice(1)},skip:function(e){return this.slice(Math.max(0,e))},skipLast:function(e){return At(this,this.toSeq().reverse().skip(e).reverse())},skipWhile:function(e,t){return At(this,wt(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(Gn(e),t)},sortBy:function(e,t){return At(this,Nt(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return At(this,this.toSeq().reverse().take(e).reverse())},takeWhile:function(e,t){return At(this,bt(this,e,t))},takeUntil:function(e,t){return this.takeWhile(Gn(e),t)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=nr(this))}});var ni=h.prototype;ni[pr]=!0,ni[Sr]=ni.values,ni.__toJS=ni.toArray,ni.__toStringMapper=Zn,ni.inspect=ni.toSource=function(){return this.toString()},ni.chain=ni.flatMap,function(){try{Object.defineProperty(ni,"length",{get:function(){if(!h.noLengthWarning){var e;try{throw new Error}catch(t){e=t.stack}if(-1===e.indexOf("_wrapObject"))return console&&console.warn&&console.warn("iterable.length has been deprecated, use iterable.size or iterable.count(). This warning will become a silent error in a future version. "+e),this.size}}})}catch(e){}}(),Jn(p,{flip:function(){return At(this,ht(this))},findKey:function(e,t){var n=this.findEntry(e,t);return n&&n[0]},findLastKey:function(e,t){return this.toSeq().reverse().findKey(e,t)},keyOf:function(e){return this.findKey(function(t){return K(t,e)})},lastKeyOf:function(e){return this.findLastKey(function(t){return K(t,e)})},mapEntries:function(e,t){var n=this,r=0;return At(this,this.toSeq().map(function(i,s){return e.call(t,[s,i],r++,n)}).fromEntrySeq())},mapKeys:function(e,t){var n=this;return At(this,this.toSeq().flip().map(function(r,i){return e.call(t,r,i,n)}).flip())}});var ri=p.prototype;ri[dr]=!0,ri[Sr]=ni.entries,ri.__toJS=ni.toObject,ri.__toStringMapper=function(e,t){return t+": "+Zn(e)},Jn(d,{toKeyedSeq:function(){return new at(this,!1)},filter:function(e,t){return At(this,vt(this,e,t,!1))},findIndex:function(e,t){var n=this.findEntry(e,t);return n?n[0]:-1},indexOf:function(e){var t=this.toKeyedSeq().keyOf(e);return void 0===t?-1:t},lastIndexOf:function(e){return this.toSeq().reverse().indexOf(e)},reverse:function(){return At(this,dt(this,!1))},slice:function(e,t){return At(this,yt(this,e,t,!1))},splice:function(e,t){var n=arguments.length;if(t=Math.max(0|t,0),0===n||2===n&&!t)return this;e=f(e,this.size);var r=this.slice(0,e);return At(this,1===n?r:r.concat(i(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var n=this.toKeyedSeq().findLastKey(e,t);return void 0===n?-1:n},first:function(){return this.get(0)},flatten:function(e){return At(this,St(this,e,!1))},get:function(e,t){return e=o(this,e),0>e||this.size===1/0||void 0!==this.size&&e>this.size?t:this.find(function(t,n){return n===e},void 0,t)},has:function(e){return e=o(this,e),e>=0&&(void 0!==this.size?this.size===1/0||e<this.size:-1!==this.indexOf(e))},interpose:function(e){return At(this,Tt(this,e))},interleave:function(){var e=[this].concat(i(arguments)),t=Lt(this.toSeq(),M.of,e),n=t.flatten(!0);return t.size&&(n.size=t.size*e.length),At(this,n)},last:function(){return this.get(-1)},skipWhile:function(e,t){return At(this,wt(this,e,t,!1))},zip:function(){var e=[this].concat(i(arguments));return At(this,Lt(this,er,e))},zipWith:function(e){var t=i(arguments);return t[0]=this,At(this,Lt(this,e,t))}}),d.prototype[vr]=!0,d.prototype[mr]=!0,Jn(v,{get:function(e,t){return this.has(e)?e:t},contains:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}}),v.prototype.has=ni.contains,Jn(O,p.prototype),Jn(M,d.prototype),Jn(_,v.prototype),Jn(V,p.prototype),Jn($,d.prototype),Jn(J,v.prototype);var ii={Iterable:h,Seq:A,Collection:X,Map:jt,OrderedMap:Tn,List:cn,Stack:An,Set:Dn,OrderedSet:Fn,Record:Un,Range:Vn,Repeat:$n,is:K,fromJS:Q};return ii}),define("event-emitter",["lodash-amd/modern/arrays/pull","immutable/dist/immutable"],function(e,t){function n(){this._listeners={}}return n.prototype.on=function(e,n){var r=this._listeners[e]||t.Set();this._listeners[e]=r.add(n)},n.prototype.off=function(e,n){var r=this._listeners[e]||t.Set();r=n?r["delete"](n):r.clear()},n.prototype.trigger=function(e,n){for(var r=e.split(":");r.length;){var i=r.join(":"),s=this._listeners[i]||t.Set();s.forEach(function(e){e.apply(null,n)}),r.splice(r.length-1,1)}},n}),define("lodash-amd/modern/objects/defaults",["./keys","../internals/objectTypes"],function(e,t){var n=function(n,r,i){var s,o=n,u=o;if(!o)return u;for(var a=arguments,f=0,l="number"==typeof i?2:a.length;++f<l;)if(o=a[f],o&&t[typeof o])for(var c=-1,h=t[typeof o]&&e(o),p=h?h.length:0;++c<p;)s=h[c],"undefined"==typeof u[s]&&(u[s]=o[s]);return u};return n}),define("config",["lodash-amd/modern/objects/defaults"],function(e){function t(t){var n=t||{};return n.defaultPlugins&&(n.defaultPlugins=n.defaultPlugins.filter(i(u.defaultPlugins))),n.defaultFormatters&&(n.defaultFormatters=n.defaultFormatters.filter(i(u.defaultFormatters))),Object.freeze(e(n,u))}function n(e){return function(t,n){return t===e?-1:n===e?1:0}}function r(e){return function(t){return-1!==(e?s:o).indexOf(t)}}function i(e){return function(t){return-1!==e.indexOf(t)}}var s=["setRootPElement","enforcePElements","ensureSelectableContainers"],o=["inlineElementsMode"],u={allowBlockElements:!0,debug:!1,undo:{manager:!1,enabled:!0,limit:100,interval:250},defaultCommandPatches:["bold","indent","insertHTML","insertList","outdent","createLink"],defaultPlugins:s.concat(o),defaultFormatters:["escapeHtmlCharactersFormatter","replaceNbspCharsFormatter"]};return{defaultOptions:u,checkOptions:t,sortByPlugin:n,filterByBlockLevelMode:r,filterByPluginExists:i}}),define("scribe",["./plugins/core/plugins","./plugins/core/commands","./plugins/core/formatters","./plugins/core/events","./plugins/core/patches","./api","./transaction-manager","./undo-manager","./event-emitter","./element","./node","immutable/dist/immutable","./config"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function p(p,g){a.call(this),this.el=p,this.commands={},this.options=h.checkOptions(g),this.commandPatches={},this._plainTextFormatterFactory=new d,this._htmlFormatterFactory=new v,this.api=new s(this),this.node=l,this.element=f,this.Immutable=c;var y=o(this);this.transactionManager=new y,this.undoManager=!1,this.options.undo.enabled&&(this.undoManager=this.options.undo.manager?this.options.undo.manager:new u(this.options.undo.limit,this.el),this._merge=!1,this._forceMerge=!1,this._mergeTimer=0,this._lastItem={content:""}),this.setHTML(this.getHTML()),this.el.setAttribute("contenteditable",!0),this.el.addEventListener("input",function(){this.transactionManager.run()}.bind(this),!1);var b=c.OrderedSet(this.options.defaultPlugins).sort(h.sortByPlugin("setRootPElement")).filter(h.filterByBlockLevelMode(this.allowsBlockElements())).map(function(t){return e[t]}),w=c.List(this.options.defaultFormatters).filter(function(e){return!!n[e]}).map(function(e){return n[e]}),E=c.List.of(i.events),S=c.List(this.options.defaultCommandPatches).map(function(e){return i.commands[e]}),x=c.List.of("indent","insertList","outdent","redo","subscript","superscript","undo").map(function(e){return t[e]}),T=c.List().concat(b,w,E,S,x);T.forEach(function(e){this.use(e())}.bind(this)),this.use(r())}function d(){this.formatters=c.List()}function v(){this.formatters={sanitize:c.List(),normalize:c.List(),"export":c.List()}}return p.prototype=Object.create(a.prototype),p.prototype.use=function(e){return e(this),this},p.prototype.setHTML=function(e,t){this._lastItem.content=e,t&&(this._skipFormatters=!0),this.el.innerHTML!==e&&(this.el.innerHTML=e)},p.prototype.getHTML=function(){return this.el.innerHTML},p.prototype.getContent=function(){return this._htmlFormatterFactory.formatForExport(this.getHTML().replace(/<br>$/,""))},p.prototype.getTextContent=function(){return this.el.textContent},p.prototype.pushHistory=function(){var e=this;if(e.options.undo.enabled){var t=e._lastItem.content.replace(/<em class="scribe-marker">/g,"").replace(/<\/em>/g,"");if(e.getHTML()!==t){var n=new e.api.Selection;n.placeMarkers();var r=e.getHTML();n.removeMarkers();var i=e.undoManager.item(e.undoManager.position);return(e._merge||e._forceMerge)&&i&&e._lastItem==i[0]?e._lastItem.content=r:(e._lastItem={previousItem:e._lastItem,content:r,scribe:e,execute:function(){},undo:function(){this.scribe.restoreFromHistory(this.previousItem)},redo:function(){this.scribe.restoreFromHistory(this)}},e.undoManager.transact(e._lastItem,!1)),clearTimeout(e._mergeTimer),e._merge=!0,e._mergeTimer=setTimeout(function(){e._merge=!1},e.options.undo.interval),!0}}return!1},p.prototype.getCommand=function(e){return this.commands[e]||this.commandPatches[e]||new this.api.Command(e)},p.prototype.restoreFromHistory=function(e){this._lastItem=e,this.setHTML(e.content,!0);var t=new this.api.Selection;t.selectMarkers(),this.trigger("content-changed")},p.prototype.allowsBlockElements=function(){return this.options.allowBlockElements},p.prototype.setContent=function(e){this.allowsBlockElements()||(e+="<br>"),this.setHTML(e),this.trigger("content-changed")},p.prototype.insertPlainText=function(e){this.insertHTML("<p>"+this._plainTextFormatterFactory.format(e)+"</p>")},p.prototype.insertHTML=function(e){this.getCommand("insertHTML").execute(this._htmlFormatterFactory.format(e))},p.prototype.isDebugModeEnabled=function(){return this.options.debug},p.prototype.registerHTMLFormatter=function(e,t){this._htmlFormatterFactory.formatters[e]=this._htmlFormatterFactory.formatters[e].push(t)},p.prototype.registerPlainTextFormatter=function(e){this._plainTextFormatterFactory.formatters=this._plainTextFormatterFactory.formatters.push(e)},d.prototype.format=function(e){var t=this.formatters.reduce(function(e,t){return t(e)},e);return t},v.prototype=Object.create(d.prototype),v.prototype.constructor=v,v.prototype.format=function(e){var t=this.formatters.sanitize.concat(this.formatters.normalize),n=t.reduce(function(e,t){return t(e)},e);return n},v.prototype.formatForExport=function(e){return this.formatters["export"].reduce(function(e,t){return t(e)},e)},p});